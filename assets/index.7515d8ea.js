var Ts=Object.defineProperty;var Es=(t,e,s)=>e in t?Ts(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var g=(t,e,s)=>(Es(t,typeof e!="symbol"?e+"":e,s),s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function s(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=s(r);fetch(r.href,a)}})();const Os="modulepreload",js=function(t){return"/multisplode/"+t},re={},Ce=function(e,s,i){if(!s||s.length===0)return e();const r=document.getElementsByTagName("link");return Promise.all(s.map(a=>{if(a=js(a),a in re)return;re[a]=!0;const n=a.endsWith(".css"),l=n?'[rel="stylesheet"]':"";if(!!i)for(let u=r.length-1;u>=0;u--){const f=r[u];if(f.href===a&&(!n||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${l}`))return;const c=document.createElement("link");if(c.rel=n?"stylesheet":Os,n||(c.as="script",c.crossOrigin=""),c.href=a,document.head.appendChild(c),n)return new Promise((u,f)=>{c.addEventListener("load",u),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>e())};var Bs=Object.defineProperty,Ds=(t,e,s)=>e in t?Bs(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,St=(t,e,s)=>(Ds(t,typeof e!="symbol"?e+"":e,s),s),Tt=class{static toArray(t){return Array.prototype.slice.call(t)}static inArray(t,e,s){return!t||typeof t!="object"?-1:t.indexOf(e,s)}},d=class{static getType(t){let e=typeof t;return e!=="object"?e:this.isArray(t)?"array":e}static isUndefined(t){return typeof t>"u"}static isObject(t){return t&&typeof t=="object"&&this.isArray(t)===!1}static isFunction(t){return typeof t=="function"}static isString(t){return typeof t=="string"}static isArray(t){return Array.isArray(t)}},A={create(t){return Object.create(t)},extendObject(t,e){if(typeof t>"u"||typeof e>"u")return!1;for(var s in t)this.hasOwnProp(t,s)&&typeof e[s]>"u"&&(e[s]=t[s]);return e},clone(t){return t?JSON.parse(JSON.stringify(t)):{}},getClassObject(t){return typeof t=="function"?t.prototype:t},extendClass(t,e){let s=this.getClassObject(t),i=this.getClassObject(e);if(typeof s!="object"||typeof i!="object")return!1;let r=Object.create(s);for(var a in i)r[a]=i[a];return r},hasOwnProp(t,e){return Object.prototype.hasOwnProperty.call(t,e)},isPlainObject(t){return t&&Object.prototype.toString.call(t)==="[object Object]"},isEmpty(t){if(d.isObject(t)===!1)return!0;for(var e in t)if(this.hasOwnProp(t,e))return!1;return!0}},Et={types:{},add(t,e){this.types[t]=e},get(t){return this.types[t]||!1},remove(t){delete this.types[t]}},Is=class{constructor(){this.types=new Map}add(t,e){this.types.has(t)||this.types.set(t,[]),this.types.get(t).push(e)}get(t){return this.types.get(t)||!1}removeByCallBack(t,e){typeof t=="function"&&t(e)}removeType(t){if(!this.types.has(t))return;let e=this.types.get(t);if(!e.length)return;let s,i=Et.get(t);if(i){for(var r=0,a=e.length;r<a;r++)s=e[r],s&&(e[r]=null,this.removeByCallBack(i,s));this.types.delete(t)}}remove(t){if(t){this.removeType(t);return}this.types.forEach((e,s)=>{!s||this.removeType(s)}),this.types.clear()}},P=class{static addType(t,e){Et.add(t,e)}static removeType(t){Et.remove(t)}static getTrackingId(t){return t.trackingId||(t.trackingId=`dt${this.trackingCount++}`)}static add(t,e,s){let i=this.getTrackingId(t);this.find(i).add(e,s)}static get(t,e){let s=t.trackingId,i=this.trackers.get(s);return i?e?i.get(e):i:!1}static find(t){return this.trackers.has(t)||this.trackers.set(t,new Is),this.trackers.get(t)}static isEmpty(t){return!t||typeof t!="object"?!0:t.size===0}static remove(t,e){let s=t.trackingId;if(!s||!this.trackers.has(s))return;let i=this.trackers.get(s);if(!e){i.remove(),this.trackers.delete(s);return}i.remove(e),this.isEmpty(i.types)&&this.trackers.delete(s)}};St(P,"trackers",new Map),St(P,"trackingCount",0);var Ot=t=>{let e=0;for(let[s,i]of Object.entries(t))e++,typeof t[s]=="object"&&(e+=Ot(t[s]));return e},Ae=(t,e)=>{let s=!1;if(typeof t!="object"||typeof e!="object")return s;for(let[i,r]of Object.entries(t)){if(!A.hasOwnProp(e,i))break;let a=e[i];if(typeof r!=typeof a)break;if(typeof r=="object"){if(s=Ae(r,a),s!==!0)break}else if(r===a)s=!0;else break}return s},Rs=(t,e)=>{let s=Ot(t),i=Ot(e);return s!==i?!1:Ae(t,e)},$s=(t,e)=>{let s=typeof t;return s!==typeof e?!1:s==="object"?Rs(t,e):t===e},y={getEvents(t){return d.isObject(t)===!1?[]:P.get(t,"events")},create(t,e,s,i=!1,r=!1,a=null){return r=r===!0,{event:t,obj:e,fn:s,capture:i,swapped:r,originalFn:a}},on(t,e,s,i){return Array.isArray(t)?t.forEach(r=>this.add(r,e,s,i)):this.add(t,e,s,i),this},off(t,e,s,i){return Array.isArray(t)?t.forEach(r=>this.remove(r,e,s,i)):this.remove(t,e,s,i),this},add(t,e,s,i=!1,r=!1,a=null){if(d.isObject(e)===!1)return this;let n=this.create(t,e,s,i,r,a);return P.add(e,"events",n),e.addEventListener(t,s,i),this},remove(t,e,s,i=!1){let r=this.getEvent(t,e,s,i);return r===!1?this:(typeof r=="object"&&this.removeEvent(r),this)},removeEvent(t){return typeof t=="object"&&t.obj.removeEventListener(t.event,t.fn,t.capture),this},getEvent(t,e,s,i){if(typeof e!="object")return!1;let r=this.getEvents(e);if(!r||r.length<1)return!1;let a=this.create(t,e,s,i);return this.search(a,r)},search(t,e){let s,i=this.isSwappable(t.event);for(var r=0,a=e.length;r<a;r++)if(s=e[r],!(s.event!==t.event||s.obj!==t.obj)&&(s.fn===t.fn||i===!0&&s.originalFn===t.fn))return s;return!1},removeEvents(t){return d.isObject(t)===!1?this:(P.remove(t,"events"),this)},swap:["DOMMouseScroll","wheel","mousewheel","mousemove","popstate"],addSwapped(t){this.swap.push(t)},isSwappable(t){return this.swap.includes(t)}};P.addType("events",t=>{y.removeEvent(t)});var Ns={events:y,addListener(t,e,s,i){return this.events.add(t,e,s,i),this},on(t,e,s,i){let r=this.events;return Array.isArray(t)?t.forEach(a=>{r.add(a,e,s,i)}):r.add(t,e,s,i),this},off(t,e,s,i){let r=this.events;return Array.isArray(t)?t.forEach(a=>{r.remove(a,e,s,i)}):r.remove(t,e,s,i),this},removeListener(t,e,s,i){return this.events.remove(t,e,s,i),this},_createEvent(t,e,s,i){let r;switch(e){case"HTMLEvents":r=new Event(t);break;case"MouseEvents":r=new MouseEvent(t,s);break;default:r=new CustomEvent(t,i);break}return r},createEvent(t,e,s,i){if(d.isObject(e)===!1)return!1;let r={pointerX:0,pointerY:0,button:0,view:window,detail:1,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,bubbles:!0,cancelable:!0,relatedTarget:null};d.isObject(s)&&(r=Object.assign(r,s));let a=this._getEventType(t);return this._createEvent(t,a,r,i)},_getEventType(t){let e={HTMLEvents:/^(?:load|unload|abort|error|select|change|submit|reset|focus|blur|resize|scroll)$/,MouseEvents:/^(?:click|dblclick|mouse(?:down|up|over|move|out))$/},s="CustomEvent";for(let[i,r]of Object.entries(e))if(t.match(r)){s=i;break}return s},trigger(t,e,s){if(d.isObject(e)===!1)return this;let i=typeof t=="string"?this.createEvent(t,e,null,s):t;return e.dispatchEvent(i),this},mouseWheelEventType:null,getWheelEventType(){let t=()=>{let e="wheel";return"onmousewheel"in self?e="mousewheel":"DOMMouseScroll"in self&&(e="DOMMouseScroll"),e};return this.mouseWheelEventType||(this.mouseWheelEventType=t())},onMouseWheel(t,e,s,i=!1){typeof e>"u"&&(e=window);let r=n=>{let l=Math.max(-1,Math.min(1,-n.deltaY||n.wheelDelta||-n.detail));typeof t=="function"&&t(l,n),s===!0&&n.preventDefault()},a=this.getWheelEventType();return this.events.add(a,e,r,i,!0,t),this},offMouseWheel(t,e,s=!1){typeof e>"u"&&(e=window);let i=this.getWheelEventType();return this.off(i,e,t,s),this},preventDefault(t){return typeof t.preventDefault=="function"?t.preventDefault():t.returnValue=!1,this},stopPropagation(t){return typeof t.stopPropagation=="function"?t.stopPropagation():t.cancelBubble=!0,this}},jt=class{constructor(){this.version="3.0.76",this.errors=[],this.dataTracker=P}augment(t){return d.isObject(t)?(Object.entries(t).forEach(([e,s])=>{this.constructor.prototype[e]=s}),this):this}override(t,e,s,i){return(t[e]=s).apply(t,Tt.toArray(i))}getLastError(){let t=this.errors;return t.length?t.pop():!1}addError(t){this.errors.push(t)}getProperty(t,e,s){if(d.isObject(t)===!1)return"";let i=t[e];return typeof i<"u"?i:typeof s<"u"?s:""}createCallBack(t,e,s=[],i=!1){return typeof e!="function"?!1:(...r)=>(i===!0&&(s=s.concat(r)),e.apply(t,s))}bind(t,e){return e.bind(t)}};jt.prototype.extend=function(){return jt.prototype}();var V=new jt;V.augment({...A,...Ns,...d,equals:$s});var H=class{static parseQueryString(t,e){typeof t!="string"&&(t=window.location.search);let s={},i=/([^?=&]+)(=([^&]*))?/g;return t.replace(i,function(r,a,n,l){s[a]=e!==!1?decodeURIComponent(l):l}),s}static camelCase(t){if(typeof t!="string")return"";let e=/(-|\s|_)+\w{1}/g;return t.replace(e,s=>s[1].toUpperCase())}static uncamelCase(t,e="-"){if(typeof t!="string")return"";let s=/([A-Z]{1,})/g;return t.replace(s,i=>e+i.toLowerCase()).toLowerCase()}},ae={url:"",responseType:"json",method:"POST",fixedParams:"",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},beforeSend:[],async:!0,crossDomain:!1,withCredentials:!1,completed:null,failed:null,aborted:null,progress:null};V.augment({xhrSettings:ae,addFixedParams(t){this.xhrSettings.fixedParams=t},beforeSend(t){this.xhrSettings.beforeSend.push(t)},ajaxSettings(t){typeof t=="object"&&(this.xhrSettings=A.extendClass(V.xhrSettings,t))},resetAjaxSettings(){this.xhrSettings=ae}});var Le=(...t)=>new _s(t).xhr,_s=class{constructor(t){this.settings=null,this.xhr=null,this.setup(t)}setup(t){this.getXhrSettings(t);let e=this.xhr=this.createXHR();if(e===!1)return!1;let{method:s,url:i,async:r}=this.settings;e.open(s,i,r),this.setupHeaders(),this.addXhrEvents(),this.beforeSend(),e.send(this.getParams())}beforeSend(){let t=V.xhrSettings.beforeSend;if(t.length<1)return;let e=this.xhr,s=this.settings;for(var i=0,r=t.length;i<r;i++){var a=t[i];a&&a(e,s)}}objectToString(t){let e=[];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.push(s+"="+encodeURIComponent(t[s]));return e.join("&")}setupParams(t,e){let s=typeof t;if(!e)return!(t instanceof FormData)&&s==="object"&&(t=this.objectToString(t)),t;let i=typeof e;if(s==="string")return i!=="string"&&(e=this.objectToString(e)),t+=(t===""?"?":"&")+e,t;if(i==="string"&&(e=H.parseQueryString(e,!1)),t instanceof FormData)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.append(r,e[r]);else s==="object"&&(t=A.clone(t),t=Object.assign(e,t),t=this.objectToString(t));return t}getParams(){let t=this.settings,e=t.fixedParams,s=t.params;return s?s=this.setupParams(s,e):e&&(s=this.setupParams(e)),s}getXhrSettings(t){let e=this.settings=Object.create(V.xhrSettings);if(t.length>=2&&typeof t[0]!="object")for(var s=0,i=t.length;s<i;s++){var r=t[s];switch(s){case 0:e.url=r;break;case 1:e.params=r;break;case 2:e.completed=r,e.failed=r;break;case 3:e.responseType=r||"json";break;case 4:e.method=r?r.toUpperCase():"POST";break;case 5:e.async=typeof r<"u"?r:!0;break}}else e=this.settings=A.extendClass(this.settings,t[0]),typeof e.completed=="function"&&(typeof e.failed!="function"&&(e.failed=e.completed),typeof e.aborted!="function"&&(e.aborted=e.failed))}createXHR(){let t=this.settings,e=new XMLHttpRequest;return e.responseType=t.responseType,t.withCredentials===!0&&(e.withCredentials=!0),e}setupHeaders(){let t=this.settings;if(!t&&typeof t.headers!="object")return;let e=t.headers;for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&this.xhr.setRequestHeader(s,e[s])}update(t,e){let s=this.xhr,i=()=>{y.removeEvents(s.upload),y.removeEvents(s)},r=this.settings;if(!r)return!1;switch(e||t.type){case"load":if(typeof r.completed=="function"){let a=this.getResponseData();r.completed(a,this.xhr)}i();break;case"error":typeof r.failed=="function"&&r.failed(!1,this.xhr),i();break;case"progress":typeof r.progress=="function"&&r.progress(t);break;case"abort":typeof r.aborted=="function"&&r.aborted(!1,this.xhr),i();break}}getResponseData(){let t=this.xhr,e=t.responseType;return!e||e==="text"?t.responseText:t.response}addXhrEvents(){if(!this.settings)return;let t=this.xhr,e=this.update.bind(this);y.on(["load","error","abort"],t,e),y.on("progress",t.upload,e)}},Ms=class{constructor(){this.connections=new Map}add(t,e,s){return this.find(t).set(e,s),s}get(t,e){let s=this.connections.get(t);return s&&s.get(e)||!1}find(t){let e=this.connections.get(t);if(e)return e;let s=new Map;return this.connections.set(t,s),s}remove(t,e){let s=this.connections.get(t);if(!s)return;let i;if(e)i=s.get(e),i&&(i.unsubscribe(),s.delete(e)),s.size===0&&this.connections.delete(t);else{for(let r of s)i=s.get(r),i&&i.unsubscribe();this.connections.delete(t)}}},Te=class{constructor(){this.msg=null,this.token=null}setToken(t){this.token=t}},zs=class extends Te{constructor(t){super(),this.data=t}subscribe(t,e){this.msg=t,this.token=this.data.on(t,e)}unsubscribe(){this.data.off(this.msg,this.token)}},Ee=class{unsubscribe(){}},Fs=class extends Ee{constructor(){super(),this.source=null}addSource(t){return this.source=new zs(t)}unsubscribe(){this.source.unsubscribe(),this.source=null}},Oe=class extends Te{constructor(t){super(),this.pubSub=t}subscribe(t){this.msg=t;let e=this.callBack.bind(this);this.token=this.pubSub.on(t,e)}unsubscribe(){this.pubSub.off(this.msg,this.token)}callBack(){}},Ws=class extends Oe{constructor(t,e,s){super(s),this.data=t,this.prop=e}set(t){this.data.set(this.prop,t)}get(){return this.data.get(this.prop)}callBack(t,e){this.data!==e&&this.data.set(this.prop,t,e)}},E=class{static getById(t){return typeof t!="string"?!1:document.getElementById(t)||!1}static getByName(t){if(typeof t!="string")return!1;let e=document.getElementsByName(t);return e?Tt.toArray(e):!1}static getBySelector(t,e){if(typeof t!="string")return!1;if(e=e||!1,e===!0)return document.querySelector(t)||!1;let s=document.querySelectorAll(t);return s?s.length===1?s[0]:Tt.toArray(s):!1}static html(t,e){return d.isObject(t)===!1?!1:d.isUndefined(e)===!1?(t.innerHTML=e,this):t.innerHTML}static setCss(t,e,s){return d.isObject(t)===!1||d.isUndefined(e)?this:(e=H.uncamelCase(e),t.style[e]=s,this)}static getCss(t,e){if(!t||typeof e>"u")return!1;e=H.uncamelCase(e);let s=t.style[e];if(s!=="")return s;let i=null,r=t.currentStyle;if(r&&(i=r[e]))return i;let a=window.getComputedStyle(t,null);return a?a[e]:s}static css(t,e,s){return typeof s<"u"?(this.setCss(t,e,s),this):this.getCss(t,e)}static removeAttr(t,e){return d.isObject(t)&&t.removeAttribute(e),this}static setAttr(t,e,s){t.setAttribute(e,s)}static getAttr(t,e){return t.getAttribute(e)}static attr(t,e,s){return d.isObject(t)===!1?!1:typeof s<"u"?(this.setAttr(t,e,s),this):this.getAttr(t,e)}static _checkDataPrefix(t){return typeof t!="string"||(t=H.uncamelCase(t),t.substring(0,5)!=="data-"&&(t="data-"+t)),t}static removeDataPrefix(t){return typeof t=="string"&&t.substring(0,5)==="data-"&&(t=t.substring(5)),t}static setData(t,e,s){e=this.removeDataPrefix(e),e=H.camelCase(e),t.dataset[e]=s}static getData(t,e){return e=H.camelCase(this.removeDataPrefix(e)),t.dataset[e]}static data(t,e,s){return d.isObject(t)===!1?!1:typeof s<"u"?(this.setData(t,e,s),this):this.getData(t,e)}static find(t,e){return!t||typeof e!="string"?[]:t.querySelectorAll(e)}static show(t){if(d.isObject(t)===!1)return this;let e=this.data(t,"style-display"),s=typeof e=="string"?e:"";return this.css(t,"display",s),this}static hide(t){if(d.isObject(t)===!1)return this;let e=this.css(t,"display");return e!=="none"&&e&&this.data(t,"style-display",e),this.css(t,"display","none"),this}static toggle(t){return d.isObject(t)===!1?this:(this.css(t,"display")!=="none"?this.hide(t):this.show(t),this)}static getSize(t){return d.isObject(t)===!1?!1:{width:this.getWidth(t),height:this.getHeight(t)}}static getWidth(t){return d.isObject(t)?t.offsetWidth:!1}static getHeight(t){return d.isObject(t)?t.offsetHeight:!1}static getScrollPosition(t){let e=0,s=0;switch(typeof t){case"undefined":t=document.documentElement,e=t.scrollLeft,s=t.scrollTop;break;case"object":e=t.scrollLeft,s=t.scrollTop;break}return d.isObject(t)===!1?!1:{left:e-(t.clientLeft||0),top:s-(t.clientTop||0)}}static getScrollTop(t){return this.getScrollPosition(t).top}static getScrollLeft(t){return this.getScrollPosition(t).left}static getWindowSize(){let t=window,e=document,s=e.documentElement,i=e.getElementsByTagName("body")[0],r=t.innerWidth||s.clientWidth||i.clientWidth,a=t.innerHeight||s.clientHeight||i.clientHeight;return{width:r,height:a}}static getDocumentSize(){let t=document,e=t.body,s=t.documentElement,i=Math.max(e.scrollHeight,e.offsetHeight,s.clientHeight,s.scrollHeight,s.offsetHeight);return{width:Math.max(e.scrollWidth,e.offsetWidth,s.clientWidth,s.scrollWidth,s.offsetWidth),height:i}}static getDocumentHeight(){return this.getDocumentSize().height}static position(t,e=1){let s={x:0,y:0};if(d.isObject(t)===!1)return s;let i=0;for(;t&&(e===0||i<e);)i++,s.x+=t.offsetLeft+t.clientLeft,s.y+=t.offsetTop+t.clientTop,t=t.offsetParent;return s}static addClass(t,e){if(d.isObject(t)===!1||e==="")return this;if(typeof e=="string"){let r=e.split(" ");for(var s=0,i=r.length;s<i;s++)t.classList.add(e)}return this}static removeClass(t,e){return d.isObject(t)===!1||e===""?this:(typeof e>"u"?t.className="":t.classList.remove(e),this)}static hasClass(t,e){return d.isObject(t)===!1||e===""?!1:t.classList.contains(e)}static toggleClass(t,e){return d.isObject(t)===!1?this:(t.classList.toggle(e),this)}},Hs=(t,e,s)=>{E.setAttr(t,e,s)},Us=(t,e,s)=>{t.checked=t.value==s},Xs=(t,e,s)=>{s=s==1,je(t,e,s)},je=(t,e,s)=>{t[e]=s},qs=(t,e)=>E.getAttr(t,e),Vs=(t,e)=>t[e],Ys=class extends Oe{constructor(t,e,s,i){super(i),this.element=t,this.attr=this.getAttrBind(e),this.addSetMethod(t,this.attr),this.filter=typeof s=="string"?this.setupFilter(s):s}addSetMethod(t,e){if(e.substring(4,1)==="-")return this.setValue=Hs,this.getValue=qs,this;this.getValue=Vs;let s=t.type;if(s)switch(s){case"checkbox":this.setValue=Xs;return;case"radio":this.setValue=Us;return}return this.setValue=je,this}getAttrBind(t){if(t)return t;let e="textContent",s=this.element;if(!s||typeof s!="object")return e;let i=s.tagName.toLowerCase();if(i==="input"||i==="textarea"||i==="select"){let r=s.type;if(!r)return e="value",e;switch(r){case"checkbox":e="checked";break;case"file":e="files";break;default:e="value"}}return e}setupFilter(t){let e=/(\[\[[^\]]+\]\])/;return s=>t.replace(e,s)}set(t){let e=this.element;return!e||typeof e!="object"?this:(this.filter&&(t=this.filter(t)),this.setValue(e,this.attr,t),this)}get(){let t=this.element;return!t||typeof t!="object"?"":this.getValue(t,this.attr)}callBack(t,e){return e!==this.element&&this.set(t),this}},Gs=class extends Ee{constructor(t){super(),this.element=null,this.data=null,this.pubSub=t}addElement(t,e,s){return this.element=new Ys(t,e,s,this.pubSub)}addData(t,e){return this.data=new Ws(t,e,this.pubSub)}unsubscribeSource(t){return t&&t.unsubscribe(),this}unsubscribe(){return this.unsubscribeSource(this.element),this.unsubscribeSource(this.data),this.element=null,this.data=null,this}},ne=-1,Be=class{constructor(){this.callBacks=new Map,this.lastToken=-1}get(t){return this.callBacks.has(t)||this.callBacks.set(t,[]),this.callBacks.get(t)}reset(){this.callBacks.clear(),this.lastToken=-1,ne=-1}on(t,e){let s=++ne;return this.get(t).push({token:s,callBack:e}),String(s)}off(t,e){let s=this.callBacks.get(t);if(!s)return;let i=s.findIndex(r=>r.token===e);i!==-1&&s.splice(i,1)}remove(t){this.callBacks.delete(t)}publish(t,...e){let s=this.callBacks.get(t);if(s)for(let{callBack:i}of s)!i||i.apply(this,e)}},Ks=class{constructor(){this.version="1.0.1",this.attr="bindId",this.blockedKeys=[20,37,38,39,40],this.connections=new Ms,this.pubSub=new Be,this.idCount=0,this.setup()}setup(){this.setupEvents()}bind(t,e,s,i){let r=s,a=null;if(s.indexOf(":")!==-1){let c=s.split(":");c.length>1&&(r=c[1],a=c[0])}let n=this.setupConnection(t,e,r,a,i),l=n.element,o=e.get(r);return typeof o<"u"?l.set(o):(o=l.get(),o!==""&&n.data.set(o)),this}setupConnection(t,e,s,i,r){let a=this.getBindId(t),n=new Gs(this.pubSub);n.addData(e,s).subscribe(a);let l=`${e.getDataId()}:${s}`;return n.addElement(t,i,r).subscribe(l),this.addConnection(a,"bind",n),n}addConnection(t,e,s){return this.connections.add(t,e,s),this}setBindId(t){let e="db-"+this.idCount++;return t.dataset&&(t.dataset[this.attr]=e),t[this.attr]=e,e}getBindId(t){return t[this.attr]||this.setBindId(t)}unbind(t){let e=t[this.attr];return e&&this.connections.remove(e),this}watch(t,e,s,i){if(d.isObject(t)===!1)return this;let r=new Fs;r.addSource(e).subscribe(s,i);let a=this.getBindId(t),n=e.getDataId()+":"+s;this.addConnection(a,n,r);let l=e.get(s);return typeof l<"u"&&i(l),this}unwatch(t,e,s){if(d.isObject(t)===!1)return this;let i=t[this.attr];if(i){let r=e.getDataId()+":"+s;this.connections.remove(i,r)}return this}publish(t,e,s){return this.pubSub.publish(t,e,s),this}isDataBound(t){return t&&t[this.attr]||null}isBlocked(t){return t.type!=="keyup"?!1:this.blockedKeys.indexOf(t.keyCode)!==-1}bindHandler(t){if(this.isBlocked(t))return!0;let e=t.target||t.srcElement,s=this.isDataBound(e);if(s!==null){let i=this.connections.get(s,"bind");if(i){let r=i.element.get();this.pubSub.publish(s,r,e)}}t.stopPropagation()}setupEvents(){this.changeHandler=this.bindHandler.bind(this),this.addEvents()}addEvents(){y.on(["change","paste","input"],document,this.changeHandler,!1)}removeEvents(){y.off(["change","paste","input"],document,this.changeHandler,!1)}},N=new Ks,ot=t=>t.data?t.data:t.context&&t.context.data?t.context.data:null,Js={class:"className",text:"textContent",for:"htmlFor",readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",colspan:"colSpan",tabindex:"tabIndex",celpadding:"cellPadding",useMap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},Ft=t=>Js[t]||t,De=t=>typeof t=="string"&&t.substring(0,2)==="on"?t.substring(2):t,et=class{static create(t,e,s,i){let r=document.createElement(t);return this.addAttributes(r,e),i===!0?this.prepend(s,r):this.append(s,r),r}static addAttributes(t,e){if(!e||typeof e!="object")return;let s=e.type;typeof s<"u"&&E.setAttr(t,"type",s);for(let[i,r]of Object.entries(e))i==="innerHTML"?t.innerHTML=r:i.indexOf("-")!==-1?E.setAttr(t,i,r):this.addAttr(t,i,r)}static addHtml(t,e){return typeof e>"u"||e===""?this:(/(?:<[a-z][\s\S]*>)/i.test(e)?t.innerHTML=e:t.textContent=e,this)}static addAttr(t,e,s){if(!(s===""||!e))if(typeof s=="function")e=De(e),y.add(e,t,s);else{let i=Ft(e);t[i]=s}}static createDocFragment(){return document.createDocumentFragment()}static createText(t,e){let s=document.createTextNode(t);return e&&this.append(e,s),s}static createComment(t,e){let s=document.createComment(t);return e&&this.append(e,s),s}static setupSelectOptions(t,e,s){if(!d.isObject(t)||!d.isArray(e))return!1;e.forEach(i=>{let r=new Option(i.label,i.value);t.options.add(r),s!==null&&r.value==s&&(r.selected=!0)})}static removeElementData(t){let e=t.childNodes;if(e){let r=e.length-1;for(var s=r;s>=0;s--){var i=e[s];!i||this.removeElementData(i)}}P.remove(t),t.bindId&&N.unbind(t)}static removeElement(t){let e;return!t||!(e=t.parentNode)?this:(this.removeElementData(t),e.removeChild(t),this)}static removeChild(t){return this.removeElement(t),this}static removeAll(t){if(!d.isObject(t))return this;let e=t.childNodes;for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&this.removeElementData(e[s]);return t.innerHTML="",this}static changeParent(t,e){return e.appendChild(t),this}static append(t,e){return t.appendChild(e),this}static prepend(t,e,s){let i=s||t.firstChild;return t.insertBefore(e,i),this}static clone(t,e=!1){return d.isObject(t)?t.cloneNode(e):!1}},K=class extends et{static create(t,e,s,i){let r=document.createElement(t);return this.addAttributes(r,e,i),s.appendChild(r),r}static addAttributes(t,e,s){!e||e.length<1||e.forEach(i=>{let{key:r,value:a}=i;this.addAttr(t,r,a,s)})}static addAttr(t,e,s,i){if(s===""||!e)return;if(e==="innerHTML"){t.innerHTML=s;return}if(typeof s=="function"){e=De(e),y.add(e,t,function(a){s.call(this,a,i)});return}if(e.substr(4,1)==="-"){E.setAttr(t,e,s);return}let r=Ft(e);t[r]=s}static addContent(t,e){!e||(e.textContent!==null?t.textContent=e.textContent:e.innerHTML&&(t.innerHTML=e.innerHTML))}static append(t,e){t.appendChild(e)}},le=/(\[\[(.*?(?:\[\d+\])?)\]\])/g,gt={isWatching(t){return Array.isArray(t)?typeof t[0]=="string"&&this.hasParams(t[0]):this.hasParams(t)},hasParams(t){return d.isString(t)&&t.includes("[[")},_getWatcherProps(t){let e=/\[\[(.*?)(\[\d+\])?\]\]/g,s=t.match(e);return s===null?null:(e=/(\[\[|\]\])/g,s.map(i=>i.replace(e,"")))},updateAttr(t,e,s){switch(e){case"text":case"textContent":t.textContent=s;break;default:K.addAttr(t,e,s);break}},_getWatcherCallBack(t,e,s,i,r){return()=>{let a=0,n=s.replace(le,function(){let l=r?e[a]:e;a++;let o=l.get(arguments[2]);return typeof o<"u"?o:""});this.updateAttr(t,i,n)}},getValue(t,e){typeof t=="string"&&(t={value:t});let s=t.value;return Array.isArray(s)===!1?[s,ot(e)]:(s.length<2&&s.push(ot(e)),s)},getPropValues(t,e,s){let i=[];for(var r=0,a=e.length;r<a;r++){var n=s?t[r]:t,l=n.get(e[r]);l=typeof l<"u"?l:"",i.push(l)}return i},getCallBack(t,e,s,i,r){let a,n=t.callBack;if(typeof n=="function"){let l=i.match(le)||[],o=l&&l.length>1;a=(c,u)=>{c=o!==!0?c:this.getPropValues(s,l,r),n(c,e,u)}}else{let l=t.attr||"textContent";a=this._getWatcherCallBack(e,s,i,l,r)}return a},addDataWatcher(t,e,s){let i=this.getValue(e,s),r=i[1];if(!r)return;let a=i[0],n=Array.isArray(r),l=this.getCallBack(e,t,r,a,n),o=this._getWatcherProps(a);for(var c=0,u=o.length;c<u;c++){var f=n?r[c]:r;this.addWatcher(t,f,o[c],l)}},setup(t,e,s){if(e){if(Array.isArray(e)){let i=[e[0],e[1]],r=e[2];typeof r=="function"?e={value:i,callBack:r}:e={attr:r,value:[e[0],e[1]]}}this.addDataWatcher(t,e,s)}},addWatcher(t,e,s,i){N.watch(t,e,s,i)}},Qs=t=>typeof t!="string"?t:Ie(t),Ie=t=>[{tag:"text",textContent:t}],Zs=t=>{if(!t)return{props:{},children:[]};let e=t[0];return typeof e=="string"?{props:{},children:Ie(e)}:Array.isArray(e)?gt.isWatching(e)===!1?{props:{},children:e}:{props:{watch:e},children:[]}:{props:e||{},children:Qs(t[1])}},Wt=t=>(...e)=>{let{props:s,children:i}=Zs(e);return t(s,i)},Re=t=>{let e={};if(!d.isObject(t))return e;let s=A.clone(t);return Object.keys(s).forEach(i=>{let r=s[i];typeof r!="function"&&(e[i]=r)}),e};function oe(t,e){let s=isNaN(Number(e)),i=s?e:`[${e}]`;return t===""?i:s?`${t}.${i}`:`${t}${i}`}function $e(t,e="",s=""){return{get(i,r,a){let n=i[r];if(e===""&&r in i)return typeof n=="function"?n.bind(i):n;let l=i[s]||i;if(n=Reflect.get(l,r,a),A.isPlainObject(n)||Array.isArray(n)){let o=oe(e,r);return new Proxy(n,$e(t,o,s))}return n},set(i,r,a,n){if(e===""&&r in i)return i[r]=a,!0;let l=oe(e,r);return t.set(l,a),!0}}}var ti=(t,e="stage")=>new Proxy(t,$e(t,"",e)),ei=0,Ht=class{constructor(t){this.dirty=!1,this.links={},this._init(),this.setup(),this.dataTypeId="bd",this.eventSub=new Be;let e=Re(t);return this.set(e),ti(this)}setup(){this.stage={}}_init(){let t=++ei;this._dataNumber=t,this._id="dt-"+t,this._dataId=this._id+":"}getDataId(){return this._id}remove(){}on(t,e){let s=t+":change";return this.eventSub.on(s,e)}off(t,e){let s=t+":change";this.eventSub.off(s,e)}_setAttr(t,e,s=this,i=!1){let r=this.stage[t];e!==r&&(this.stage[t]=e,this._publish(t,e,s,r))}_publish(t,e,s,i){let r=t+":change";this.eventSub.publish(r,e,s),s=s||this,N.publish(this._dataId+t,e,s)}set(...t){if(typeof t[0]!="object")return this._setAttr(...t),this;let[e,s,i]=t;return Object.entries(e).forEach(([r,a])=>{typeof a!="function"&&this._setAttr(r,a,s,i)}),this}getModelData(){return this.stage}_deleteAttr(t,e){delete t[e]}toggle(t){if(!(typeof t>"u"))return this.set(t,!this.get(t)),this}increment(t){if(typeof t>"u")return;let e=this.get(t);return this.set(t,++e),this}decrement(t){if(typeof t>"u")return;let e=this.get(t);return this.set(t,--e),this}concat(t,e){if(typeof t>"u")return;let s=this.get(t);return this.set(t,s+e),this}ifNull(t,e){return this.get(t)===null&&this.set(t,e),this}setKey(t){return this.key=t,this}resume(t){let e=this.key;if(!e)return this;let s,i=localStorage.getItem(e);return i===null?t&&(s=t):s=JSON.parse(i),s?(this.set(s),this):this}store(){let t=this.key;if(!t)return!1;let e=this.get();if(!e)return!1;let s=JSON.stringify(e);return localStorage.setItem(t,s),!0}delete(t){if(typeof t<"u"){this._deleteAttr(this.stage,t);return}this.setup()}_getAttr(t,e){return t[e]}get(t){return typeof t<"u"?this._getAttr(this.stage,t):this.getModelData()}link(t,e,s){if(arguments.length===1&&t.isData===!0&&(e=t.get()),typeof e!="object")return this.remoteLink(t,e,s);let i=[];return Object.entries(e).forEach(([r])=>{i.push(this.remoteLink(t,r))}),i}remoteLink(t,e,s){let i=s||e,r=t.get(e);typeof r<"u"&&this.get(e)!==r&&this.set(e,r);let a=t.on(e,(l,o)=>{if(o===this)return!1;this.set(i,l,t)});this.addLink(a,t);let n=this.on(i,(l,o)=>{if(o===t)return!1;t.set(e,l,this)});return t.addLink(n,this),a}addLink(t,e){this.links[t]=e}unlink(t){if(t){this.removeLink(t);return}let e=this.links;A.isEmpty(e)||(Object.entries(e).forEach(([s,i])=>{this.removeLink(i,!1)}),this.links={})}removeLink(t,e=!0){let s=this.links[t];s&&s.off(t),e!==!1&&delete this.links[t]}};Ht.prototype.isData=!0;var z={deepDataPattern:/(\w+)|(?:\[(\d)\))/g,hasDeepData(t){return t.indexOf(".")!==-1||t.indexOf("[")!==-1},getSegments(t){let e=this.deepDataPattern;return t.match(e)}},yt=class extends Ht{setup(){this.attributes={},this.stage={}}_updateAttr(t,e,s){if(!z.hasDeepData(e)){t[e]=s;return}let i,r=z.getSegments(e),a=r.length,n=a-1;for(var l=0;l<a;l++){if(i=r[l],l===n){t[i]=s;break}t[i]===void 0&&(t[i]=isNaN(i)?{}:[]),t=t[i]}}_setAttr(t,e,s,i){typeof e!="object"&&e===this.get(t)||(!s&&i!==!0?this._updateAttr(this.attributes,t,e):this.dirty===!1&&(this.dirty=!0),this._updateAttr(this.stage,t,e),s=s||this,this._publish(t,e,s))}linkAttr(t,e){let s=t.get(e);if(s)for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&this.link(t,e+"."+i,i)}scope(t,e){let s=this.get(t);if(!s)return!1;e=e||this.constructor;let i=new e(s);return i.linkAttr(this,t),i}splice(t,e){return this.delete(t+"["+e+"]"),this.refresh(t),this}push(t,e){let s=this.get(t);return Array.isArray(s)===!1&&(s=[]),s.push(e),this.set(t,s),this}unshift(t,e){let s=this.get(t);return Array.isArray(s)===!1&&(s=[]),s.unshift(e),this.set(t,s),this}shift(t){let e=this.get(t);if(Array.isArray(e)===!1)return null;let s=e.shift();return this.set(t,e),s}pop(t){let e=this.get(t);if(Array.isArray(e)===!1)return null;let s=e.pop();return this.set(t,e),s}refresh(t){return this.set(t,this.get(t)),this}_publish(t,e,s){this.publish(t,e,s)}publishDeep(t,e,s){if(!z.hasDeepData(t)){this.publish(t,e,s);return}let i,r=z.getSegments(t),a=r.length,n=a-1,l="",o=this.stage;for(var c=0;c<a;c++){i=r[c],o=o[i],c>0?isNaN(i)&&(l+="."+i):l=i;var u;if(c===n)u=e;else{var f=r[c+1];if(isNaN(f)===!1){l+="["+f+"]";continue}var L={};L[f]=o[f],u=L}this.publish(l,u,s)}}publish(t,e,s){if(t=t||"",this._publishAttr(t,e,s),!e||typeof e!="object")return;let i,r;if(Array.isArray(e)){let l=e.length;for(var a=0;a<l;a++)r=e[a],i=t+"["+a+"]",this._checkPublish(i,r,s)}else for(var n in e)!Object.prototype.hasOwnProperty.call(e,n)||(r=e[n],i=t+"."+n,this._checkPublish(i,r,s))}_checkPublish(t,e,s){!e||typeof e!="object"?this._publishAttr(t,e,s):this.publish(t,e,s)}_publishAttr(t,e,s){N.publish(this._dataId+t,e,s);let i=t+":change";this.eventSub.publish(i,e,s)}mergeStage(){this.attributes=A.clone(this.stage),this.dirty=!1}getModelData(){return this.mergeStage(),this.attributes}revert(){this.set(this.attributes),this.dirty=!1}_deleteAttr(t,e){z.hasDeepData(e)||delete t[e];let s=z.getSegments(e),i=s.length,r=i-1;for(var a=0;a<i;a++){var n=s[a],l=t[n];if(l===void 0)break;if(a===r){if(Array.isArray(t)){t.splice(n,1);break}delete t[n];break}t=l}}_getAttr(t,e){if(!z.hasDeepData(e))return t[e];let s=z.getSegments(e),i=s.length,r=i-1;for(var a=0;a<i;a++){var n=s[a],l=t[n];if(l===void 0)break;if(t=l,a===r)return t}}},si={"\n":"\\n","\r":"\\n","	":"\\t"},ii=(t,e)=>{typeof t!="string"&&(t=String(t));let s=e?/[\n\r\t]/g:/\t/g;return t.replace(s,i=>si[i])},he=(t,e)=>{if(typeof t!="string")return t;t=ii(t,e),t=encodeURIComponent(t);let s=/%22/g;return t.replace(s,'"')},Ne=(t,e)=>{let s=typeof t;return s==="undefined"?t:s!=="object"?(t=he(t),t):(Object.entries(t).forEach(([i,r])=>{r!==null&&(t[i]=typeof r=="string"?Ne(r,e):he(r,e))}),t)};function ri(t){return typeof t<"u"&&t.length>0?JSON.parse(t):!1}function _e(t){return typeof t<"u"?JSON.stringify(t):null}var Me=class{static prepareJsonUrl(t,e=!1){let s=typeof t=="object"?A.clone(t):t,i=Ne(s,e);return _e(i)}static xmlParse(t){return typeof t>"u"?!1:new DOMParser().parseFromString(t,"text/xml")}};St(Me,"json",{encode:_e,decode:ri});var ai=class{constructor(t){this.model=t,this.objectType=this.objectType||"item",this.url="",this.validateCallBack=null,this.init()}init(){let t=this.model;t&&t.url&&(this.url=t.url)}isValid(){let t=this.validate();if(t!==!1){let e=this.validateCallBack;typeof e=="function"&&e(t)}return t}validate(){return!0}getDefaultParams(){return""}setupParams(t){let e=this.getDefaultParams();return t=this.addParams(t,e),t}objectToString(t){let e=[];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.push(s+"="+t[s]);return e.join("&")}addParams(t,e){if(t=t||{},typeof t=="string"&&(t=H.parseQueryString(t,!1)),!e)return this._isFormData(t)?t:this.objectToString(t);if(typeof e=="string"&&(e=H.parseQueryString(e,!1)),this._isFormData(t))for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.append(s,e[s]);else t=Object.assign(t,e),t=this.objectToString(t);return t}get(t,e){let s=this.model.get("id"),i="op=get&id="+s,r=this.model;return this._get("",i,t,e,a=>{if(a){let n=this.getObject(a);n&&r.set(n)}})}getObject(t){return t[this.objectType]||t||!1}setupObjectData(){let t=this.model.get();return this.objectType+"="+Me.prepareJsonUrl(t)}setup(t,e){if(!this.isValid())return!1;let s="op=setup&"+this.setupObjectData();return this._put("",s,t,e)}add(t,e){if(!this.isValid())return!1;let s="op=add&"+this.setupObjectData();return this._post("",s,t,e)}update(t,e){if(!this.isValid())return!1;let s="op=update&"+this.setupObjectData();return this._patch("",s,t,e)}delete(t,e){let s=this.model.get("id"),i="op=delete&id="+s;return this._delete("",i,t,e)}all(t,e,s,i,r){r=r||"",s=isNaN(s)?0:s,i=isNaN(i)?50:i;let a="op=all&option="+r+"&start="+s+"&stop="+i;return this._get("",a,t,e)}getUrl(t){let e=this.url;return t?t[0]==="?"?e+t:e+="/"+t:e}setupRequest(t,e,s,i,r){let a={url:this.getUrl(t),method:e,params:s,completed:(n,l)=>{typeof r=="function"&&r(n),this.getResponse(n,i,l)}};return this._isFormData(s)&&(a.headers={}),Le(a)}_isFormData(t){return t instanceof FormData}request(t,e,s,i){return this._request("","POST",t,e,s,i)}_get(t,e,s,i,r){return e=this.setupParams(e),e=this.addParams(e,s),t=t||"",e&&(t+="?"+e),this.setupRequest(t,"GET","",i,r)}_post(t,e,s,i,r){return this._request(t,"POST",e,s,i,r)}_put(t,e,s,i,r){return this._request(t,"PUT",e,s,i,r)}_patch(t,e,s,i,r){return this._request(t,"PATCH",e,s,i,r)}_delete(t,e,s,i,r){return this._request(t,"DELETE",e,s,i,r)}_request(t,e,s,i,r,a){return s=this.setupParams(s),s=this.addParams(s,i),this.setupRequest(t,e,s,r,a)}getResponse(t,e,s){typeof e=="function"&&e(t,s)}static extend(t){if(!t)return!1;let e=this;class s extends e{constructor(r){super(r)}}return Object.assign(s.prototype,t),s}},ni=t=>{let e={};if(!d.isObject(t)||!t.defaults)return e;let{defaults:s}=t;return Object.keys(s).forEach(i=>{let r=s[i];typeof r!="function"&&(e[i]=r)}),delete t.defaults,e},li=t=>{if(!t||typeof t.xhr!="object")return{};let e={...t.xhr};return delete t.xhr,e},oi=0,ze=class extends yt{constructor(t){let e=super(t);return this.initialize(),e}setup(){this.attributes={},this.stage={},this.xhr=null}initialize(){}static extend(t={}){let e=this,s=li(t),i=this.prototype.service.extend(s),r=ni(t);class a extends e{constructor(o){let c={...r,...Re(o)};super(c);g(this,"dataTypeId",`bm${oi++}`);this.xhr=new i(this)}}return Object.assign(a.prototype,t),a.prototype.service=i,a}};ze.prototype.service=ai;var Ut=class extends Ht{_publish(t,e,s,i){let r=t+":change";this.eventSub.publish(r,e,s),s=s||this,N.publish(this._dataId+t,e,s)}},hi=class extends Ut{constructor(t){super(),this.id=t}setup(){this.stage={},this.id=null}addAction(t,e){typeof e<"u"&&this.set(t,e)}getState(t){return this.get(t)}removeAction(t,e){if(e){this.off(t,e);return}let s=this.stage;typeof s[t]<"u"&&delete s[t]}},J=class{static restore(t,e){this.targets.set(t,e)}static getTarget(t){return this.targets.has(t)||this.targets.set(t,new hi(t)),this.targets.get(t)}static getActionState(t,e){return this.getTarget(t).get(e)}static add(t,e,s){let i=this.getTarget(t);return e&&i.addAction(e,s),i}static addAction(t,e,s){return this.add(t,e,s)}static removeAction(t,e,s){this.off(t,e,s)}static on(t,e,s){let i=this.getTarget(t);return e?i.on(e,s):null}static off(t,e,s){this.remove(t,e,s)}static remove(t,e,s){let i=this.targets,r=i.get(t);if(r){if(e){r.off(e,s);return}this.targets.delete(t)}}static set(t,e,s){this.getTarget(t).set(e,s)}};St(J,"targets",new Map);var ci=class{constructor(){this.events=[]}addEvents(t){t.length<1||t.forEach(e=>{this.on(...e)})}on(t,e,s,i){y.on(t,e,s,i),this.events.push({event:t,obj:e,callBack:s,capture:i})}off(t,e,s,i){y.off(t,e,s,i);let r,a=this.events;for(var n=0,l=a.length;n<l;n++)if(r=a[n],r.event===t&&r.obj===e){a.splice(n,1);break}}set(){this.events.forEach(t=>{y.on(t.event,t.obj,t.callBack,t.capture)})}unset(){this.events.forEach(t=>{y.off(t.event,t.obj,t.callBack,t.capture)})}reset(){this.unset(),this.events=[]}},ui=class{constructor(t,e){this.remoteStates=[];let s=this.convertStates(e);this.addStatesToTarget(t,s)}addStates(t,e){let s=this.convertStates(e);this.addStatesToTarget(t,s)}createState(t,e,s,i){return{action:t,state:e,callBack:s,targetId:i,token:null}}convertStates(t){let e=[];for(var s in t)if(Object.prototype.hasOwnProperty.call(t,s)){if(s==="remotes"){this.setupRemoteStates(t[s],e);continue}var i=null,r=null,a=t[s];a&&typeof a=="object"&&(r=a.callBack,i=a.id||a.targetId,a=a.state),e.push(this.createState(s,a,r,i))}return e}setupRemoteStates(t,e){let s;for(var i=0,r=t.length;i<r;i++)if(s=t[i],!!s){for(var a in s)if(!(!Object.prototype.hasOwnProperty.call(s,a)||a==="id")){var n=null,l=s[a],o=l!==null?l:void 0;o&&typeof o=="object"&&(n=o.callBack,o=o.state),e.push(this.createState(a,o,n,s.id))}}}removeRemoteStates(){let t=this.remoteStates;t&&this.removeActions(t)}removeActions(t){if(!(t.length<1))for(var e=0,s=t.length;e<s;e++){var i=t[e];J.remove(i.targetId,i.action,i.token)}}restore(t){J.restore(t.id);let e=this.remoteStates;if(e)for(var s=0,i=e.length;s<i;s++){var r=e[s];r.token=this.bindRemoteState(t,r.action,r.targetId)}}bindRemoteState(t,e,s){let i=J.getTarget(s);return t.link(i,e)}addStatesToTarget(t,e){let s=this.remoteStates;for(var i=0,r=e.length;i<r;i++){var a=e[i],n=this.addAction(t,a);a.targetId&&(a.token=n,s.push(a))}s.length<1&&(this.remoteStates=null)}addAction(t,e){let s,i=e.action,r=e.targetId;r&&(s=this.bindRemoteState(t,i,r)),typeof e.state<"u"&&t.addAction(i,e.state);let a=e.callBack;return typeof a=="function"&&t.on(i,a),s}},di=t=>typeof t!="string"?t:Fe(t),Fe=t=>[{tag:"text",textContent:t}],pi=t=>{if(!t)return{props:{},children:[]};let e=t[0];return typeof e=="string"?{props:{},children:Fe(e)}:Array.isArray(e)?{props:{},children:e}:{props:e||{},children:di(t[1])}};P.addType("components",t=>{if(!t)return;let e=t.component;e&&e.rendered===!0&&e.prepareDestroy()});var fi=0,We=class{constructor(...t){var i;this.isUnit=!0,this.data=null,this.persist=!1,this.children=null,this.nest=null,this.state=null,this.panel=null,this.parent=null,this.init();let{props:e,children:s}=pi(t);this.setupProps(e),(i=this.children)!=null||(this.children=s),this.onCreated(),this.rendered=!1,this.container=null}init(){this.id="cp-"+fi++}setupProps(t){if(!(!t||typeof t!="object"))for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(this[e]=t[e])}getParentContext(){return this.parent?this.parent.getContext():null}setupContext(){let t=this.getParentContext(),e=this.setContext(t);if(e){this.context=e;return}this.context=t,this.setupAddingContext()}setupAddingContext(){let t=this.context,e=this.addContext(t);if(!e)return;let s=e[0];!s||(this.addingContext=!0,this.contextBranchName=s,this.addContextBranch(s,e[1]))}addContextBranch(t,e){var s;(s=this.context)!=null||(this.context={}),this.context[t]=e}setContext(t){return null}addContext(t){return null}removeContext(){!this.addingContext||this.removeContextBranch(this.contextBranchName)}removeContextBranch(t){!t||delete this.context[t]}getContext(){return this.context}onCreated(){}render(){return{}}_cacheRoot(t){return t&&(t.id||(t.id=this.getId()),t.cache="panel",t)}_createLayout(){return this.persist?this._layout||(this._layout=this.render()):this.render()}prepareLayout(){let t=this._createLayout();return this._cacheRoot(t)}afterBuild(){P.add(this.panel,"components",{component:this}),this.rendered=!0,this.afterLayout()}afterLayout(){this.afterSetup()}if(t,e){return t?e||t:null}map(t,e){let s=[];if(!t||t.length<1)return s;for(var i=0,r=t.length;i<r;i++){let a=e(t[i],i);s.push(a)}return s}removeAll(t){return et.removeAll(t)}getId(t){let e=this.id;return typeof t=="string"&&(e+="-"+t),e}initialize(){this.setupContext(),this.beforeSetup()}beforeSetup(){}afterSetup(){}setup(t){this.container=t,this.initialize()}remove(){this.prepareDestroy(),this.removeContext();let t=this.panel||this.id;et.removeElement(t)}prepareDestroy(){this.rendered=!1,this.beforeDestroy()}beforeDestroy(){}destroy(){this.remove()}},B=class extends We{constructor(...t){super(...t),this.isComponent=!0,this.stateTargetId=null,this._setupData()}setData(){return null}_setupData(){if(this.data)return;let t=this.setData();t&&(this.data=t)}initialize(){this.setupContext(),this.addStates(),this.beforeSetup()}afterLayout(){this.addEvents(),this.afterSetup()}setupStateTarget(t){let e=t||this.stateTargetId||this.id;this.state=J.getTarget(e)}setupStates(){return{}}addStates(){let t=this.state;if(t){this.stateHelper.restore(t);return}let e=this.setupStates();A.isEmpty(e)||(this.setupStateTarget(),this.stateHelper=new ui(this.state,e))}removeStates(){let t=this.state;!t||(this.stateHelper.removeRemoteStates(),t.remove())}setupEventHelper(){this.events||(this.events=new ci)}setupEvents(){return[]}addEvents(){let t=this.setupEvents();t.length<1||(this.setupEventHelper(),this.events.addEvents(t))}removeEvents(){let t=this.events;t&&t.reset()}prepareDestroy(){this.rendered=!1,this.beforeDestroy(),this.removeEvents(),this.removeStates(),this.removeContext(),this.data&&this.persist===!1&&this.data.unlink()}},gi={created:"onCreated",state:"setupStates",events:"setupEvents",before:"beforeSetup",render:"render",after:"afterSetup",destroy:"beforeDestroy"},mi=t=>typeof t=="function"?t:()=>t,vi=t=>{let e={};return t&&Object.entries(t).forEach(([s,i])=>{let r=gi[s]||s;e[r]=mi(i)}),e},ce=(t,e)=>{class s extends t{}return Object.assign(s.prototype,e),s},Xt=t=>{if(!t)return null;let e,s=typeof t;return s==="object"&&t.render?(e=vi(t),ce(B,e)):(e={render:s==="function"?t:()=>t},ce(We,e))},yi=(t,e)=>({name:t,callBack:e}),Bt={keys:[],items:{},add(t,e){return this.keys.push(t),this.items[t]=yi(t,e),this},get(t){return this.items[t]||null},all(){return this.keys}},ue=(t,e)=>({attr:t,directive:e}),pt=(t,e)=>({key:t,value:e}),bi=(t,e,s,i)=>({tag:t,attr:e,directives:s,children:i}),He=class{static getTag(t){return t.tag||"div"}static setupChildren(t){t.nest&&(t.children=t.nest,delete t.nest)}static setElementContent(t,e,s,i){return t==="text"?(i.push({tag:"text",textContent:e}),!0):t==="html"||t==="innerHTML"?(s.push(pt("innerHTML",e)),!0):!1}static setTextAsWatcher(t,e,s){let i={attr:Ft(e),value:s};t.push(ue(pt(e,i),Bt.get("watch")))}static setButtonType(t,e,s){if(t==="button"){let i=e.type||"button";s.push(pt("type",i))}}static parse(t,e){let s=[],i=[],r=this.getTag(t);this.setButtonType(r,t,s),this.setupChildren(t);let a=[];var n,l;for(var o in t){if(!A.hasOwnProp(t,o)||o==="tag"||(n=t[o],n==null))continue;if((l=Bt.get(o))!==null){i.push(ue(pt(o,n),l));continue}let c=typeof n;if(c==="object"){if(o==="children"){a=a.concat(n);continue}if(gt.isWatching(n)){this.setTextAsWatcher(i,o,n);continue}a.push(n);continue}if(c==="function"){let u=n;n=function(f){u.call(this,f,e)}}if(gt.isWatching(n)){this.setTextAsWatcher(i,o,n);continue}this.setElementContent(o,n,s,a)||s.push(pt(o,n))}return bi(r,s,i,a)}},Ue=class{createNode(t,e,s){}},wi=class extends Ue{createNode(t,e,s){let i=t.tag;if(i==="text"){let r=t.attr[0],a=r?r.value:"";return K.createText(a,e)}else if(i==="comment"){let r=t.attr[0],a=r?r.value:"";return K.createComment(a,e)}return K.create(i,t.attr,e,s)}},ki=class extends Ue{createNode(t,e,s){let i=t.tag;if(i==="text"){let r=t.attr[0];r&&r.value}else if(i==="comment"){let r=t.attr[0];r&&r.value}}},Si=class{static browserIsSupported(){return window}static setup(){return this.browserIsSupported()?new wi:new ki}},Pi=Si.setup(),D=class{static render(t,e,s){if(!t)return null;if(typeof t=="object"&&t.isUnit===!0)return this.createComponent(t,e,s),t;let i=Xt(t),r=new i;return this.createComponent(r,e,s),r}static build(t,e,s){let i=K.createDocFragment();return(Array.isArray(t)?t:[t]).forEach(r=>this.buildElement(r,i,s)),e&&typeof e=="object"&&e.appendChild(i),i}static rebuild(t,e,s){return K.removeAll(e),this.build(t,e,s)}static buildElement(t,e,s){if(t){if(t.isUnit===!0){this.createComponent(t,e,s);return}this.createElement(t,e,s)}}static createElement(t,e,s){let i=He.parse(t,s),r=this.createNode(i,e,s);this.cache(r,t.cache,s),i.children.forEach(n=>{n!==null&&this.buildElement(n,r,s)});let a=i.directives;a&&a.length&&this.setDirectives(r,a,s)}static setDirectives(t,e,s){e.forEach(i=>{this.handleDirective(t,i,s)})}static handleDirective(t,e,s){e.directive.callBack(t,e.attr.value,s)}static cache(t,e,s){s&&e&&(s[e]=t)}static createComponent(t,e,s){let i=t;i.parent=s,s&&s.persist===!0&&i.persist!==!1&&(i.persist=!0),i.cache&&s&&(s[i.cache]=i),i.setup(e);let r=i.prepareLayout();this.build(r,i.container,i),i.afterBuild(),t.component&&typeof t.onCreated=="function"&&t.onCreated(i)}static createNode(t,e,s){return Pi.createNode(t,e,s)}};V.augment({buildLayout(t,e,s){D.build(t,e,s)}});var qt=[],xi=t=>qt.indexOf(t)!==-1,Ci=t=>({tag:"script",src:t.src,async:!1,load(e){qt.push(t.src);let s=t.load;s&&s()}}),Ai=t=>({tag:"link",rel:"stylesheet",type:"text/css",href:t.src,load(e){qt.push(t.src);let s=t.load;s&&s()}}),Li=class{constructor(t){this.percent=0,this.loaded=0,this.total=0,this.callBack=t||null}add(t){this.total++;let e,s=this.update.bind(this);t.indexOf(".css")!==-1?e=Ai({load:s,src:t}):e=Ci({load:s,src:t}),D.build(e,document.head)}addFiles(t){!t||t.forEach(e=>{xi(e)||this.add(e)})}update(){if(this.updateProgress()<100)return;let t=this.callBack;t&&t()}updateProgress(){return++this.loaded,this.percent=Math.floor(this.loaded/this.total*100)}},Ti=(t,e)=>{Ce(()=>import(t),[]).then(s=>{e&&e(s)})},Ei=t=>{var e;return t?typeof((e=t==null?void 0:t.prototype)==null?void 0:e.constructor)=="function":!1},Oi=(t,e,s)=>{let i=D.build(t,null,s),r=i.firstChild;return e.after(i),r},ji=t=>({tag:"comment",textContent:"import placeholder",onCreated:t.onCreated}),Bi=Xt({render(){return ji({onCreated:t=>{if(this.src){if(this.depends){new Li(()=>{this.loadAndRender(t)}).addFiles(this.depends);return}this.loadAndRender(t)}}})},getLayout(t){let e=t.default;if(!e)return null;let s=this.callBack;return s?e=s(e):Ei(e)?(e=new e,e.route=this.route,this.persist&&(e.persist=!0)):e=e(),this.layout=e},loadAndRender(t){Ti(this.src,e=>{this.loaded=!0;let s=this.layout||this.getLayout(e);this.layoutRoot=Oi(s,t,this.parent)})},shouldUpdate(t){return this.updateLayout===!0?!0:this.updateLayout=t&&t.isUnit&&typeof t.update=="function"},updateModuleLayout(t){let e=this.layout;this.shouldUpdate(e)&&e.update(t)},update(t){this.loaded===!0&&this.updateModuleLayout(t)},beforeDestroy(){!this.layoutRoot||et.removeElement(this.layoutRoot)}}),Di=t=>new Bi(t),Vt=(t,e,s,i)=>{let r,a,n;if(Array.isArray(s[0])){s.forEach(l=>{!l||Vt(t,e,l,i)});return}if(s.length<3?[r,a]=s:[e,r,a]=s,!(!e||!r)){switch(typeof a){case"object":n=l=>{$i(t,a,l)};break;case"function":n=l=>{Ii(t,a,r,l,i)};break}N.watch(t,e,r,n)}},Ii=(t,e,s,i,r)=>{let a=e(i,t,r);switch(typeof a){case"object":if(r&&a&&a.isUnit===!0&&r.persist===!0&&r.state){let n=s+":"+i,l=r.state,o=l.get(n);typeof o<"u"&&(a=o),l.set(n,a)}Ri(a,t,r);break;case"string":et.addHtml(t,a);break}},Ri=(t,e,s)=>{D.rebuild(t,e,s)},$i=(t,e,s)=>{for(let[i,r]of Object.entries(e))!i||(r===s?E.addClass(t,i):E.removeClass(t,i))},Xe=(t,e,s)=>{let i=ot(s);Vt(t,i,e,s)},Ni=(t,e,s)=>{!e||e&&E.setAttr(t,"role",e)},_i=t=>(e,s)=>{let i=s?"true":"false";E.setAttr(e,t,i)},Mi=(t,e,s)=>{if(!e)return;let i=e.role;i&&(E.setAttr(t,"role",i),e.role=null),Object.entries(e).forEach(([r,a])=>{if(a===null)return;let n=`aria-${r}`;Array.isArray(a)?(a.push(_i(n)),Xe(t,a,s)):E.setAttr(t,n,a)})};P.addType("context",t=>{if(!t)return!1;t.parent.removeContextBranch(t.branch)});var Yt=t=>t?t.getContext():null,zi=(t,e,s)=>{if(typeof e!="function")return;let i=Yt(s),r=e(i);if(!r)return;let a=He.parse(r,s);K.addAttributes(t,a.attr,s),D.setDirectives(t,a.directives,s)},Fi=(t,e,s)=>{if(typeof e!="function")return;let i=Yt(s);e(i)},Wi=(t,e,s)=>{if(typeof e!="function"||!s)return;let i=Yt(s),r=e(i);!r||s.addContextBranch(r[0],r[1])},Hi=(t,e,s)=>{},Ui=(t,e,s)=>{!e||!s||e(s,t)},Xi=(t,e,s)=>{!e||!s||e(s.data,t)},qi=(t,e,s)=>{!e||!s||e(s.state,t)},Vi=(t,e,s)=>{if(!(!e||!s)&&s.stateHelper){let i=s.state,r=e(i);s.stateHelper.addStates(r)}},Yi=(t,e,s)=>{let i,r,a;if(typeof e=="string"){if(i=ot(s),!i)return;r=e}else if(Array.isArray(e)){if(typeof e[0]!="object"){let n=ot(s);if(!n)return;e.unshift(n)}[i,r,a]=e}N.bind(t,i,r,a)},Gi=(t,e,s)=>{let i,r,a,n;if(e.length<3){let o=ot(s);if(!o)return;i=o,[r,a,n]=e}else[i,r,a,n]=e;let l=n!==!1;N.watch(t,i,r,o=>{if(et.removeAll(t),!o||o.length<1)return;let c=[];return o.forEach((u,f)=>{let L=l?i.scope(r+"["+f+"]"):null,I=a(o[f],f,L);I!==null&&c.push(I)}),D.build(c,t,s)})},Ki=(t,e,s)=>{let i=e[0];if(!i||i.length<1)return;let r=e[1],a=[];i.forEach((n,l)=>{if(!n)return;let o=r(n,l);o!==null&&a.push(o)}),D.build(a,t,s)},Ji=(t,e,s)=>{e(t)};P.addType("destroyed",t=>{if(!t)return!1;t.callBack(t.ele)});var Qi=(t,e,s)=>{Zi(t,e)},Zi=(t,e)=>{P.add(t,"destroyed",{ele:t,callBack:e})},tr=(t,e,s)=>{Vt(t,s.state,e,s)},er=(t,e,s)=>{if(e)if(Array.isArray(e)&&typeof e[0]!="string")for(var i=0,r=e.length;i<r;i++)gt.setup(t,e[i],s);else gt.setup(t,e,s)},sr=0,qe=class{constructor(t){this.router=t,this.locationId="base-app-router-"+sr++,this.callBack=this.check.bind(this)}setup(){return this.addEvent(),this}check(t){}addEvent(){return this}},ir=class extends qe{addEvent(){return y.on("popstate",window,this.callBack),this}removeEvent(){return y.off("popstate",window,this.callBack),this}check(t){let e=t.state;if(!e||e.location!==this.locationId)return!1;t.preventDefault(),t.stopPropagation(),this.router.checkActiveRoutes(e.uri)}createState(t,e={}){return{location:this.locationId,...e,uri:t}}addState(t,e,s=!1){let i=window.history,r=i.state;if(r&&r.uri===t)return this;let a=this.createState(t,e);return i[s===!1?"pushState":"replaceState"](a,null,t),this}},rr=class extends qe{addEvent(){return y.on("hashchange",window,this.callBack),this}removeEvent(){return y.off("hashchange",window,this.callBack),this}check(t){this.router.checkActiveRoutes(t.newURL)}addState(t,e,s){return window.location.hash=t,this}},ar=class{static browserIsSupported(){return"history"in window&&"pushState"in window.history}static setup(t){return this.browserIsSupported()?new ir(t).setup():new rr(t).setup()}},nr=class{constructor(t,e){this.route=t,this.template=e.component,this.component=null,this.hasTemplate=!1,this.setup=!1,this.container=e.container,this.persist=e.persist,this.parent=e.parent,this.setupTemplate()}focus(t){this.setup===!1&&this.create(),this.update(t)}setupTemplate(){let t=this.template;if(typeof t=="string"&&(t=this.template=window[t],!t))return;let e=typeof t;e==="function"?this.initializeComponent():e==="object"&&this.initializeTemplateObject(),this.hasTemplate=!0}initializeComponent(){this.component=new this.template({route:this.route,persist:this.persist,parent:this.parent})}initializeTemplateObject(){this.template.isUnit||(this.template=Xt(this.template));let t=this.template;this.persist=t.persist!==!1,Object.assign(t,{route:this.route,persist:this.persist,parent:this.parent}),this.component=t}create(){if(!this.hasTemplate)return;this.setup=!0;let t=this.component;(!this.persist||!t)&&(t=this.component=this.template),D.render(t,this.container,this.parent)}remove(){if(this.setup!==!0)return;this.setup=!1;let t=this.component;!t||(typeof t.destroy=="function"&&t.destroy(),this.persist===!1&&(this.component=null))}update(t){let e=this.component;!e||typeof e.update=="function"&&e.update(t)}},lr=t=>{if(!t.length)return null;let e={};return t.forEach(s=>{e[s]=null}),e},or=t=>{let e=[];if(!t)return e;let s=/[*?]/g;t=t.replace(s,"");let i=/:(.[^./?&($]+)\?*/g,r=t.match(i);return r===null||r.forEach(a=>{a&&(a=a.replace(":",""),e.push(a))}),e},hr=t=>t.replace(/\//g,"/"),cr=t=>t.replace(/(\/):[^/(]*?\?/g,e=>e.replace(/\//g,"(?:$|/)")),ur=t=>(t=t.replace(/(\?\/+\*?)/g,"?/*"),t.replace(/(:[^/?&($]+)/g,e=>e.indexOf(".")<0?"([^/|?]+)":"([^/|?]+.*)")),dr=t=>t.replace(/(\*)/g,".*"),pr=(t,e)=>t+=e[e.length-1]==="*"?"":"$",fr=t=>{if(!t)return"";let e=hr(t);return e=cr(e),e=ur(e),e=dr(e),e=pr(e,t),e},gr=0,mr=class extends Ut{constructor(t,e){let s=t.baseUri,i=or(s),r=lr(i),a=super(r);return this.uri=s,this.paramKeys=i,this.titleCallBack=e,this.setupRoute(t),this.set("active",!1),a}setup(){this.stage={},this.id=null,this.uri=null,this.uriQuery=null,this.controller=null,this.paramKeys=null,this.titleCallBack=null,this.path=null,this.referralPath=null,this.params=null,this.callBack=null,this.title=null}setupRoute(t){this.id=t.id||"bs-rte-"+gr++,this.path=null,this.referralPath=null;let e=fr(this.uri);this.uriQuery=new RegExp("^"+e),this.params=null,this.setupComponentHelper(t),this.callBack=t.callBack,this.title=t.title}setTitle(t){this.titleCallBack(this,t)}deactivate(){this.set("active",!1);let t=this.controller;t&&t.remove()}getLayout(t){if(t.component)return t.component;let e=t.import;return e?(typeof e=="string"&&(e={src:e}),Di(e)):null}setupComponentHelper(t){let e=this.getLayout(t);if(!e)return;let{container:s,persist:i=!1,parent:r}=t,a={component:e,container:s,persist:i,parent:r};this.controller=new nr(this,a)}resume(t){let e=this.controller;e&&(e.container=t)}setPath(t,e){this.path=t,this.referralPath=e}select(){this.set("active",!0);let t=this.stage,e=this.callBack;typeof e=="function"&&e(t);let s=this.controller;s&&s.focus(t);let i=this.path;if(!i)return;let r=i.split("#")[1];!r||this.scrollToId(r)}scrollToId(t){if(!t)return;let e=document.getElementById(t);!e||e.scrollIntoView(!0)}match(t){let e=!1,s=t.match(this.uriQuery);return s===null?(this.resetParams(),e):(Array.isArray(s)&&(s.shift(),e=s,this.setParams(s)),e)}resetParams(){this.stage={}}setParams(t){if(!Array.isArray(t))return;let e=this.paramKeys;if(!e)return;let s={};e.forEach((i,r)=>{typeof i<"u"&&(s[i]=t[r])}),this.set(s)}getParams(){return this.stage}},vr=t=>{let e=/\w\S*/;return t.replace(e,s=>s.charAt(0).toUpperCase()+s.substring(1).toLowerCase())},yr=(t,e)=>{if(t.indexOf(":")===-1)return t;let s=e.stage;for(let[i,r]of Object.entries(s)){let a=new RegExp(":"+i,"gi");t=t.replace(a,r)}return t},br=(t,e,s)=>e&&(typeof e=="function"&&(e=e(t.stage)),e=yr(e,t),e=vr(e),s!==""&&(e+=" - "+s),e),wr={removeSlashes(t){return typeof t!="string"?"":(t.substring(0,1)==="/"&&(t=t.substring(1)),t.substring(-1)==="/"&&(t=t.substring(0,t.length-1)),t)}};P.addType("routes",t=>{if(!t)return!1;let e=t.route;e&&bt.removeRoute(e)});P.addType("switch",t=>{if(!t)return!1;let e=t.id;bt.removeSwitch(e)});var kr=class{constructor(){this.version="1.0.2",this.baseURI="/",this.title="",this.lastPath=null,this.path=null,this.history=null,this.callBackLink=null,this.location=window.location,this.routes=[],this.switches={},this.switchCount=0,this.data=new yt({path:""})}setupHistory(){this.history=ar.setup(this)}createRoute(t){let e=t.uri||"*";return t.baseUri=this.createURI(e),new mr(t,this.updateTitle.bind(this))}add(t){if(typeof t!="object"){let s=arguments;t={uri:s[0],component:s[1],callBack:s[2],title:s[3],id:s[4],container:s[5]}}let e=this.createRoute(t);return this.addRoute(e),e}addRoute(t){this.routes.push(t),this.checkRoute(t,this.getPath())}resume(t,e){t.resume(e),this.addRoute(t)}getBasePath(){if(!this.basePath){let t=this.baseURI||"";t[t.length-1]!=="/"&&(t+="/"),this.basePath=t}return this.basePath}createURI(t){return this.getBasePath()+wr.removeSlashes(t)}getRoute(t){let e=this.routes,s=e.length;if(s>0)for(var i=0;i<s;i++){var r=e[i];if(r.uri===t)return r}return!1}getRouteById(t){let e=this.routes,s=e.length;if(s>0)for(var i=0;i<s;i++){var r=e[i];if(r.id===t)return r}return!1}removeRoute(t){let e=this.routes,s=e.indexOf(t);s>-1&&e.splice(s,1)}addSwitch(t){let e=this.switchCount++,s=this.getSwitchGroup(e);return t.forEach(i=>{let r=this.createRoute(i);s.push(r)}),this.checkGroup(s,this.getPath()),e}resumeSwitch(t,e){let s=this.switchCount++,i=this.getSwitchGroup(s);return t.forEach(r=>{let a=r.component.route;a.resume(e),i.push(a)}),this.checkGroup(i,this.getPath()),s}getSwitchGroup(t){return this.switches[t]=[]}removeSwitch(t){let e=this.switches;e[t]&&delete e[t]}remove(t){t=this.createURI(t);let e=this.getRoute(t);return e!==!1&&this.removeRoute(e),this}setup(t,e){this.baseURI=t||"/",this.updateBaseTag(this.baseURI),this.title=typeof e<"u"?e:"",this.setupHistory(),this.data.path=this.getPath(),this.callBackLink=this.checkLink.bind(this),y.on("click",document,this.callBackLink);let s=this.getEndPoint();return this.navigate(s,null,!0),this}updateBaseTag(t){let e=document.getElementsByTagName("base");e.length&&(e[0].href=t)}getParentLink(t){let e=t.parentNode;for(;e!==null;){if(e.nodeName.toLowerCase()==="a")return e;e=e.parentNode}return!1}checkLink(t){if(t.ctrlKey===!0)return!0;let e=t.target||t.srcElement;if(e.nodeName.toLowerCase()!=="a"&&(e=this.getParentLink(e),e===!1)||e.target==="_blank"||E.data(e,"cancel-route"))return!0;let s=e.getAttribute("href");if(typeof s<"u"){let i=this.baseURI,r=i!=="/"?s.replace(i,""):s;return this.navigate(r),t.preventDefault(),t.stopPropagation(),!1}}reset(){return this.routes=[],this.switches=[],this.switchCount=0,this}activate(){return this.checkActiveRoutes(),this}navigate(t,e,s){return t=this.createURI(t),this.history.addState(t,e,s),this.activate(),this}updatePath(){let t=this.getPath();this.data.path=t}updateTitle(t){if(!t||!t.title)return this;let e=t.title;document.title=br(t,e,this.title)}checkActiveRoutes(t){this.lastPath=this.path,t=t||this.getPath(),this.path=t;let e=this.routes,s=e.length,i;for(var r=0;r<s;r++)i=e[r],!(typeof i>"u")&&this.checkRoute(i,t);this.checkSwitches(t),this.updatePath()}checkSwitches(t){let e=this.switches;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var i=e[s];this.checkGroup(i,t)}}checkGroup(t,e){let s=!1,i,r,a,n,l=!1;for(var o=0,c=t.length;o<c;o++)if(i=t[o],!(typeof i>"u")){if(o===0&&(r=i),!a&&i.get("active")&&(a=i),s!==!1){l&&i.deactivate();continue}s=i.match(e),s!==!1&&(n=i,i.controller&&(this.select(i),l=!0))}if(n===void 0){this.select(r),a&&r!==a&&a.deactivate();return}a?l&&n!==a&&a.deactivate():r&&l===!1&&this.select(r)}checkRoute(t,e){let s=this.check(t,e);return s!==!1?this.select(t):t.deactivate(),s}check(t,e){return t?(e=e||this.getPath(),t.match(e)!==!1):!1}select(t){!t||(t.setPath(this.path,this.lastPath),t.select(),this.updateTitle(t))}getEndPoint(){return this.getPath().replace(this.baseURI,"")||"/"}destroy(){y.off("click",document,this.callBackLink)}getPath(){let t=this.location,e=this.path=t.pathname;return this.history.type==="hash"?t.hash.replace("#",""):e+t.search+t.hash}},bt=new kr,Sr=(t,e,s)=>{!e||(Array.isArray(e)?e.forEach(i=>{de(t,i,s)}):de(t,e,s))},de=(t,e,s)=>{e.container=t,e.parent=s;let i=bt.add(e);Pr(t,i)},Pr=(t,e)=>{P.add(t,"routes",{route:e})},xr=(t,e,s)=>{e[0],e.forEach(r=>{r.container=t,r.parent=s});let i=bt.addSwitch(e);Cr(t,i)},Cr=(t,e)=>{P.add(t,"switch",{id:e})};Bt.add("cache",Hi).add("onCreated",Ji).add("onDestroyed",Qi).add("bind",Yi).add("onSet",Xe).add("onState",tr).add("watch",er).add("useParent",Ui).add("useData",Xi).add("useState",qi).add("addState",Vi).add("map",Ki).add("for",Gi).add("useContext",Fi).add("addContext",Wi).add("context",zi).add("role",Ni).add("aria",Mi).add("route",Sr).add("switch",xr);V.augment({Ajax:Le,Html:et,dataBinder:N,Data:yt,SimpleData:Ut,Model:ze,State:J,Builder:D,router:bt,Component:B});var Ar=Object.defineProperty,Lr=(t,e,s)=>e in t?Ar(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Pt=(t,e,s)=>(Lr(t,typeof e!="symbol"?e+"":e,s),s),Dt=class{static toArray(t){return Array.prototype.slice.call(t)}static inArray(t,e,s){return!t||typeof t!="object"?-1:t.indexOf(e,s)}},p=class{static getType(t){let e=typeof t;return e!=="object"?e:this.isArray(t)?"array":e}static isUndefined(t){return typeof t>"u"}static isObject(t){return t&&typeof t=="object"&&this.isArray(t)===!1}static isFunction(t){return typeof t=="function"}static isString(t){return typeof t=="string"}static isArray(t){return Array.isArray(t)}},O={create(t){return Object.create(t)},extendObject(t,e){if(typeof t>"u"||typeof e>"u")return!1;for(var s in t)this.hasOwnProp(t,s)&&typeof e[s]>"u"&&(e[s]=t[s]);return e},clone(t){return t?JSON.parse(JSON.stringify(t)):{}},getClassObject(t){return typeof t=="function"?t.prototype:t},extendClass(t,e){let s=this.getClassObject(t),i=this.getClassObject(e);if(typeof s!="object"||typeof i!="object")return!1;let r=Object.create(s);for(var a in i)r[a]=i[a];return r},hasOwnProp(t,e){return Object.prototype.hasOwnProperty.call(t,e)},isPlainObject(t){return t&&Object.prototype.toString.call(t)==="[object Object]"},isEmpty(t){if(p.isObject(t)===!1)return!0;for(var e in t)if(this.hasOwnProp(t,e))return!1;return!0}},It={types:{},add(t,e){this.types[t]=e},get(t){return this.types[t]||!1},remove(t){delete this.types[t]}},Tr=class{constructor(){this.types=new Map}add(t,e){this.types.has(t)||this.types.set(t,[]),this.types.get(t).push(e)}get(t){return this.types.get(t)||!1}removeByCallBack(t,e){typeof t=="function"&&t(e)}removeType(t){if(!this.types.has(t))return;let e=this.types.get(t);if(!e.length)return;let s,i=It.get(t);if(i){for(var r=0,a=e.length;r<a;r++)s=e[r],s&&(e[r]=null,this.removeByCallBack(i,s));this.types.delete(t)}}remove(t){if(t){this.removeType(t);return}this.types.forEach((e,s)=>{!s||this.removeType(s)}),this.types.clear()}},x=class{static addType(t,e){It.add(t,e)}static removeType(t){It.remove(t)}static getTrackingId(t){return t.trackingId||(t.trackingId=`dt${this.trackingCount++}`)}static add(t,e,s){let i=this.getTrackingId(t);this.find(i).add(e,s)}static get(t,e){let s=t.trackingId,i=this.trackers.get(s);return i?e?i.get(e):i:!1}static find(t){return this.trackers.has(t)||this.trackers.set(t,new Tr),this.trackers.get(t)}static isEmpty(t){return!t||typeof t!="object"?!0:t.size===0}static remove(t,e){let s=t.trackingId;if(!s||!this.trackers.has(s))return;let i=this.trackers.get(s);if(!e){i.remove(),this.trackers.delete(s);return}i.remove(e),this.isEmpty(i.types)&&this.trackers.delete(s)}};Pt(x,"trackers",new Map),Pt(x,"trackingCount",0);var Rt=t=>{let e=0;for(let[s,i]of Object.entries(t))e++,typeof t[s]=="object"&&(e+=Rt(t[s]));return e},Ve=(t,e)=>{let s=!1;if(typeof t!="object"||typeof e!="object")return s;for(let[i,r]of Object.entries(t)){if(!O.hasOwnProp(e,i))break;let a=e[i];if(typeof r!=typeof a)break;if(typeof r=="object"){if(s=Ve(r,a),s!==!0)break}else if(r===a)s=!0;else break}return s},Er=(t,e)=>{let s=Rt(t),i=Rt(e);return s!==i?!1:Ve(t,e)},Or=(t,e)=>{let s=typeof t;return s!==typeof e?!1:s==="object"?Er(t,e):t===e},b={getEvents(t){return p.isObject(t)===!1?[]:x.get(t,"events")},create(t,e,s,i=!1,r=!1,a=null){return r=r===!0,{event:t,obj:e,fn:s,capture:i,swapped:r,originalFn:a}},on(t,e,s,i){return Array.isArray(t)?t.forEach(r=>this.add(r,e,s,i)):this.add(t,e,s,i),this},off(t,e,s,i){return Array.isArray(t)?t.forEach(r=>this.remove(r,e,s,i)):this.remove(t,e,s,i),this},add(t,e,s,i=!1,r=!1,a=null){if(p.isObject(e)===!1)return this;let n=this.create(t,e,s,i,r,a);return x.add(e,"events",n),e.addEventListener(t,s,i),this},remove(t,e,s,i=!1){let r=this.getEvent(t,e,s,i);return r===!1?this:(typeof r=="object"&&this.removeEvent(r),this)},removeEvent(t){return typeof t=="object"&&t.obj.removeEventListener(t.event,t.fn,t.capture),this},getEvent(t,e,s,i){if(typeof e!="object")return!1;let r=this.getEvents(e);if(!r||r.length<1)return!1;let a=this.create(t,e,s,i);return this.search(a,r)},search(t,e){let s,i=this.isSwappable(t.event);for(var r=0,a=e.length;r<a;r++)if(s=e[r],!(s.event!==t.event||s.obj!==t.obj)&&(s.fn===t.fn||i===!0&&s.originalFn===t.fn))return s;return!1},removeEvents(t){return p.isObject(t)===!1?this:(x.remove(t,"events"),this)},swap:["DOMMouseScroll","wheel","mousewheel","mousemove","popstate"],addSwapped(t){this.swap.push(t)},isSwappable(t){return this.swap.includes(t)}};x.addType("events",t=>{b.removeEvent(t)});var jr={events:b,addListener(t,e,s,i){return this.events.add(t,e,s,i),this},on(t,e,s,i){let r=this.events;return Array.isArray(t)?t.forEach(a=>{r.add(a,e,s,i)}):r.add(t,e,s,i),this},off(t,e,s,i){let r=this.events;return Array.isArray(t)?t.forEach(a=>{r.remove(a,e,s,i)}):r.remove(t,e,s,i),this},removeListener(t,e,s,i){return this.events.remove(t,e,s,i),this},_createEvent(t,e,s,i){let r;switch(e){case"HTMLEvents":r=new Event(t);break;case"MouseEvents":r=new MouseEvent(t,s);break;default:r=new CustomEvent(t,i);break}return r},createEvent(t,e,s,i){if(p.isObject(e)===!1)return!1;let r={pointerX:0,pointerY:0,button:0,view:window,detail:1,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,bubbles:!0,cancelable:!0,relatedTarget:null};p.isObject(s)&&(r=Object.assign(r,s));let a=this._getEventType(t);return this._createEvent(t,a,r,i)},_getEventType(t){let e={HTMLEvents:/^(?:load|unload|abort|error|select|change|submit|reset|focus|blur|resize|scroll)$/,MouseEvents:/^(?:click|dblclick|mouse(?:down|up|over|move|out))$/},s="CustomEvent";for(let[i,r]of Object.entries(e))if(t.match(r)){s=i;break}return s},trigger(t,e,s){if(p.isObject(e)===!1)return this;let i=typeof t=="string"?this.createEvent(t,e,null,s):t;return e.dispatchEvent(i),this},mouseWheelEventType:null,getWheelEventType(){let t=()=>{let e="wheel";return"onmousewheel"in self?e="mousewheel":"DOMMouseScroll"in self&&(e="DOMMouseScroll"),e};return this.mouseWheelEventType||(this.mouseWheelEventType=t())},onMouseWheel(t,e,s,i=!1){typeof e>"u"&&(e=window);let r=n=>{let l=Math.max(-1,Math.min(1,-n.deltaY||n.wheelDelta||-n.detail));typeof t=="function"&&t(l,n),s===!0&&n.preventDefault()},a=this.getWheelEventType();return this.events.add(a,e,r,i,!0,t),this},offMouseWheel(t,e,s=!1){typeof e>"u"&&(e=window);let i=this.getWheelEventType();return this.off(i,e,t,s),this},preventDefault(t){return typeof t.preventDefault=="function"?t.preventDefault():t.returnValue=!1,this},stopPropagation(t){return typeof t.stopPropagation=="function"?t.stopPropagation():t.cancelBubble=!0,this}},$t=class{constructor(){this.version="3.0.76",this.errors=[],this.dataTracker=x}augment(t){return p.isObject(t)?(Object.entries(t).forEach(([e,s])=>{this.constructor.prototype[e]=s}),this):this}override(t,e,s,i){return(t[e]=s).apply(t,Dt.toArray(i))}getLastError(){let t=this.errors;return t.length?t.pop():!1}addError(t){this.errors.push(t)}getProperty(t,e,s){if(p.isObject(t)===!1)return"";let i=t[e];return typeof i<"u"?i:typeof s<"u"?s:""}createCallBack(t,e,s=[],i=!1){return typeof e!="function"?!1:(...r)=>(i===!0&&(s=s.concat(r)),e.apply(t,s))}bind(t,e){return e.bind(t)}};$t.prototype.extend=function(){return $t.prototype}();var st=new $t;st.augment({...O,...jr,...p,equals:Or});var U=class{static parseQueryString(t,e){typeof t!="string"&&(t=window.location.search);let s={},i=/([^?=&]+)(=([^&]*))?/g;return t.replace(i,function(r,a,n,l){s[a]=e!==!1?decodeURIComponent(l):l}),s}static camelCase(t){if(typeof t!="string")return"";let e=/(-|\s|_)+\w{1}/g;return t.replace(e,s=>s[1].toUpperCase())}static uncamelCase(t,e="-"){if(typeof t!="string")return"";let s=/([A-Z]{1,})/g;return t.replace(s,i=>e+i.toLowerCase()).toLowerCase()}},pe={url:"",responseType:"json",method:"POST",fixedParams:"",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},beforeSend:[],async:!0,crossDomain:!1,withCredentials:!1,completed:null,failed:null,aborted:null,progress:null};st.augment({xhrSettings:pe,addFixedParams(t){this.xhrSettings.fixedParams=t},beforeSend(t){this.xhrSettings.beforeSend.push(t)},ajaxSettings(t){typeof t=="object"&&(this.xhrSettings=O.extendClass(st.xhrSettings,t))},resetAjaxSettings(){this.xhrSettings=pe}});var Ye=(...t)=>new Br(t).xhr,Br=class{constructor(t){this.settings=null,this.xhr=null,this.setup(t)}setup(t){this.getXhrSettings(t);let e=this.xhr=this.createXHR();if(e===!1)return!1;let{method:s,url:i,async:r}=this.settings;e.open(s,i,r),this.setupHeaders(),this.addXhrEvents(),this.beforeSend(),e.send(this.getParams())}beforeSend(){let t=st.xhrSettings.beforeSend;if(t.length<1)return;let e=this.xhr,s=this.settings;for(var i=0,r=t.length;i<r;i++){var a=t[i];a&&a(e,s)}}objectToString(t){let e=[];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.push(s+"="+encodeURIComponent(t[s]));return e.join("&")}setupParams(t,e){let s=typeof t;if(!e)return!(t instanceof FormData)&&s==="object"&&(t=this.objectToString(t)),t;let i=typeof e;if(s==="string")return i!=="string"&&(e=this.objectToString(e)),t+=(t===""?"?":"&")+e,t;if(i==="string"&&(e=U.parseQueryString(e,!1)),t instanceof FormData)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.append(r,e[r]);else s==="object"&&(t=O.clone(t),t=Object.assign(e,t),t=this.objectToString(t));return t}getParams(){let t=this.settings,e=t.fixedParams,s=t.params;return s?s=this.setupParams(s,e):e&&(s=this.setupParams(e)),s}getXhrSettings(t){let e=this.settings=Object.create(st.xhrSettings);if(t.length>=2&&typeof t[0]!="object")for(var s=0,i=t.length;s<i;s++){var r=t[s];switch(s){case 0:e.url=r;break;case 1:e.params=r;break;case 2:e.completed=r,e.failed=r;break;case 3:e.responseType=r||"json";break;case 4:e.method=r?r.toUpperCase():"POST";break;case 5:e.async=typeof r<"u"?r:!0;break}}else e=this.settings=O.extendClass(this.settings,t[0]),typeof e.completed=="function"&&(typeof e.failed!="function"&&(e.failed=e.completed),typeof e.aborted!="function"&&(e.aborted=e.failed))}createXHR(){let t=this.settings,e=new XMLHttpRequest;return e.responseType=t.responseType,t.withCredentials===!0&&(e.withCredentials=!0),e}setupHeaders(){let t=this.settings;if(!t&&typeof t.headers!="object")return;let e=t.headers;for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&this.xhr.setRequestHeader(s,e[s])}update(t,e){let s=this.xhr,i=()=>{b.removeEvents(s.upload),b.removeEvents(s)},r=this.settings;if(!r)return!1;switch(e||t.type){case"load":if(typeof r.completed=="function"){let a=this.getResponseData();r.completed(a,this.xhr)}i();break;case"error":typeof r.failed=="function"&&r.failed(!1,this.xhr),i();break;case"progress":typeof r.progress=="function"&&r.progress(t);break;case"abort":typeof r.aborted=="function"&&r.aborted(!1,this.xhr),i();break}}getResponseData(){let t=this.xhr,e=t.responseType;return!e||e==="text"?t.responseText:t.response}addXhrEvents(){if(!this.settings)return;let t=this.xhr,e=this.update.bind(this);b.on(["load","error","abort"],t,e),b.on("progress",t.upload,e)}},Dr=class{constructor(){this.connections=new Map}add(t,e,s){return this.find(t).set(e,s),s}get(t,e){let s=this.connections.get(t);return s&&s.get(e)||!1}find(t){let e=this.connections.get(t);if(e)return e;let s=new Map;return this.connections.set(t,s),s}remove(t,e){let s=this.connections.get(t);if(!s)return;let i;if(e)i=s.get(e),i&&(i.unsubscribe(),s.delete(e)),s.size===0&&this.connections.delete(t);else{for(let r of s)i=s.get(r),i&&i.unsubscribe();this.connections.delete(t)}}},Ge=class{constructor(){this.msg=null,this.token=null}setToken(t){this.token=t}},Ir=class extends Ge{constructor(t){super(),this.data=t}subscribe(t,e){this.msg=t,this.token=this.data.on(t,e)}unsubscribe(){this.data.off(this.msg,this.token)}},Ke=class{unsubscribe(){}},Rr=class extends Ke{constructor(){super(),this.source=null}addSource(t){return this.source=new Ir(t)}unsubscribe(){this.source.unsubscribe(),this.source=null}},Je=class extends Ge{constructor(t){super(),this.pubSub=t}subscribe(t){this.msg=t;let e=this.callBack.bind(this);this.token=this.pubSub.on(t,e)}unsubscribe(){this.pubSub.off(this.msg,this.token)}callBack(){}},$r=class extends Je{constructor(t,e,s){super(s),this.data=t,this.prop=e}set(t){this.data.set(this.prop,t)}get(){return this.data.get(this.prop)}callBack(t,e){this.data!==e&&this.data.set(this.prop,t,e)}},j=class{static getById(t){return typeof t!="string"?!1:document.getElementById(t)||!1}static getByName(t){if(typeof t!="string")return!1;let e=document.getElementsByName(t);return e?Dt.toArray(e):!1}static getBySelector(t,e){if(typeof t!="string")return!1;if(e=e||!1,e===!0)return document.querySelector(t)||!1;let s=document.querySelectorAll(t);return s?s.length===1?s[0]:Dt.toArray(s):!1}static html(t,e){return p.isObject(t)===!1?!1:p.isUndefined(e)===!1?(t.innerHTML=e,this):t.innerHTML}static setCss(t,e,s){return p.isObject(t)===!1||p.isUndefined(e)?this:(e=U.uncamelCase(e),t.style[e]=s,this)}static getCss(t,e){if(!t||typeof e>"u")return!1;e=U.uncamelCase(e);let s=t.style[e];if(s!=="")return s;let i=null,r=t.currentStyle;if(r&&(i=r[e]))return i;let a=window.getComputedStyle(t,null);return a?a[e]:s}static css(t,e,s){return typeof s<"u"?(this.setCss(t,e,s),this):this.getCss(t,e)}static removeAttr(t,e){return p.isObject(t)&&t.removeAttribute(e),this}static setAttr(t,e,s){t.setAttribute(e,s)}static getAttr(t,e){return t.getAttribute(e)}static attr(t,e,s){return p.isObject(t)===!1?!1:typeof s<"u"?(this.setAttr(t,e,s),this):this.getAttr(t,e)}static _checkDataPrefix(t){return typeof t!="string"||(t=U.uncamelCase(t),t.substring(0,5)!=="data-"&&(t="data-"+t)),t}static removeDataPrefix(t){return typeof t=="string"&&t.substring(0,5)==="data-"&&(t=t.substring(5)),t}static setData(t,e,s){e=this.removeDataPrefix(e),e=U.camelCase(e),t.dataset[e]=s}static getData(t,e){return e=U.camelCase(this.removeDataPrefix(e)),t.dataset[e]}static data(t,e,s){return p.isObject(t)===!1?!1:typeof s<"u"?(this.setData(t,e,s),this):this.getData(t,e)}static find(t,e){return!t||typeof e!="string"?[]:t.querySelectorAll(e)}static show(t){if(p.isObject(t)===!1)return this;let e=this.data(t,"style-display"),s=typeof e=="string"?e:"";return this.css(t,"display",s),this}static hide(t){if(p.isObject(t)===!1)return this;let e=this.css(t,"display");return e!=="none"&&e&&this.data(t,"style-display",e),this.css(t,"display","none"),this}static toggle(t){return p.isObject(t)===!1?this:(this.css(t,"display")!=="none"?this.hide(t):this.show(t),this)}static getSize(t){return p.isObject(t)===!1?!1:{width:this.getWidth(t),height:this.getHeight(t)}}static getWidth(t){return p.isObject(t)?t.offsetWidth:!1}static getHeight(t){return p.isObject(t)?t.offsetHeight:!1}static getScrollPosition(t){let e=0,s=0;switch(typeof t){case"undefined":t=document.documentElement,e=t.scrollLeft,s=t.scrollTop;break;case"object":e=t.scrollLeft,s=t.scrollTop;break}return p.isObject(t)===!1?!1:{left:e-(t.clientLeft||0),top:s-(t.clientTop||0)}}static getScrollTop(t){return this.getScrollPosition(t).top}static getScrollLeft(t){return this.getScrollPosition(t).left}static getWindowSize(){let t=window,e=document,s=e.documentElement,i=e.getElementsByTagName("body")[0],r=t.innerWidth||s.clientWidth||i.clientWidth,a=t.innerHeight||s.clientHeight||i.clientHeight;return{width:r,height:a}}static getDocumentSize(){let t=document,e=t.body,s=t.documentElement,i=Math.max(e.scrollHeight,e.offsetHeight,s.clientHeight,s.scrollHeight,s.offsetHeight);return{width:Math.max(e.scrollWidth,e.offsetWidth,s.clientWidth,s.scrollWidth,s.offsetWidth),height:i}}static getDocumentHeight(){return this.getDocumentSize().height}static position(t,e=1){let s={x:0,y:0};if(p.isObject(t)===!1)return s;let i=0;for(;t&&(e===0||i<e);)i++,s.x+=t.offsetLeft+t.clientLeft,s.y+=t.offsetTop+t.clientTop,t=t.offsetParent;return s}static addClass(t,e){if(p.isObject(t)===!1||e==="")return this;if(typeof e=="string"){let r=e.split(" ");for(var s=0,i=r.length;s<i;s++)t.classList.add(e)}return this}static removeClass(t,e){return p.isObject(t)===!1||e===""?this:(typeof e>"u"?t.className="":t.classList.remove(e),this)}static hasClass(t,e){return p.isObject(t)===!1||e===""?!1:t.classList.contains(e)}static toggleClass(t,e){return p.isObject(t)===!1?this:(t.classList.toggle(e),this)}},Nr=(t,e,s)=>{j.setAttr(t,e,s)},_r=(t,e,s)=>{t.checked=t.value==s},Mr=(t,e,s)=>{s=s==1,Qe(t,e,s)},Qe=(t,e,s)=>{t[e]=s},zr=(t,e)=>j.getAttr(t,e),Fr=(t,e)=>t[e],Wr=class extends Je{constructor(t,e,s,i){super(i),this.element=t,this.attr=this.getAttrBind(e),this.addSetMethod(t,this.attr),this.filter=typeof s=="string"?this.setupFilter(s):s}addSetMethod(t,e){if(e.substring(4,1)==="-")return this.setValue=Nr,this.getValue=zr,this;this.getValue=Fr;let s=t.type;if(s)switch(s){case"checkbox":this.setValue=Mr;return;case"radio":this.setValue=_r;return}return this.setValue=Qe,this}getAttrBind(t){if(t)return t;let e="textContent",s=this.element;if(!s||typeof s!="object")return e;let i=s.tagName.toLowerCase();if(i==="input"||i==="textarea"||i==="select"){let r=s.type;if(!r)return e="value",e;switch(r){case"checkbox":e="checked";break;case"file":e="files";break;default:e="value"}}return e}setupFilter(t){let e=/(\[\[[^\]]+\]\])/;return s=>t.replace(e,s)}set(t){let e=this.element;return!e||typeof e!="object"?this:(this.filter&&(t=this.filter(t)),this.setValue(e,this.attr,t),this)}get(){let t=this.element;return!t||typeof t!="object"?"":this.getValue(t,this.attr)}callBack(t,e){return e!==this.element&&this.set(t),this}},Hr=class extends Ke{constructor(t){super(),this.element=null,this.data=null,this.pubSub=t}addElement(t,e,s){return this.element=new Wr(t,e,s,this.pubSub)}addData(t,e){return this.data=new $r(t,e,this.pubSub)}unsubscribeSource(t){return t&&t.unsubscribe(),this}unsubscribe(){return this.unsubscribeSource(this.element),this.unsubscribeSource(this.data),this.element=null,this.data=null,this}},fe=-1,Ze=class{constructor(){this.callBacks=new Map,this.lastToken=-1}get(t){return this.callBacks.has(t)||this.callBacks.set(t,[]),this.callBacks.get(t)}reset(){this.callBacks.clear(),this.lastToken=-1,fe=-1}on(t,e){let s=++fe;return this.get(t).push({token:s,callBack:e}),String(s)}off(t,e){let s=this.callBacks.get(t);if(!s)return;let i=s.findIndex(r=>r.token===e);i!==-1&&s.splice(i,1)}remove(t){this.callBacks.delete(t)}publish(t,...e){let s=this.callBacks.get(t);if(s)for(let{callBack:i}of s)!i||i.apply(this,e)}},Ur=class{constructor(){this.version="1.0.1",this.attr="bindId",this.blockedKeys=[20,37,38,39,40],this.connections=new Dr,this.pubSub=new Ze,this.idCount=0,this.setup()}setup(){this.setupEvents()}bind(t,e,s,i){let r=s,a=null;if(s.indexOf(":")!==-1){let c=s.split(":");c.length>1&&(r=c[1],a=c[0])}let n=this.setupConnection(t,e,r,a,i),l=n.element,o=e.get(r);return typeof o<"u"?l.set(o):(o=l.get(),o!==""&&n.data.set(o)),this}setupConnection(t,e,s,i,r){let a=this.getBindId(t),n=new Hr(this.pubSub);n.addData(e,s).subscribe(a);let l=`${e.getDataId()}:${s}`;return n.addElement(t,i,r).subscribe(l),this.addConnection(a,"bind",n),n}addConnection(t,e,s){return this.connections.add(t,e,s),this}setBindId(t){let e="db-"+this.idCount++;return t.dataset&&(t.dataset[this.attr]=e),t[this.attr]=e,e}getBindId(t){return t[this.attr]||this.setBindId(t)}unbind(t){let e=t[this.attr];return e&&this.connections.remove(e),this}watch(t,e,s,i){if(p.isObject(t)===!1)return this;let r=new Rr;r.addSource(e).subscribe(s,i);let a=this.getBindId(t),n=e.getDataId()+":"+s;this.addConnection(a,n,r);let l=e.get(s);return typeof l<"u"&&i(l),this}unwatch(t,e,s){if(p.isObject(t)===!1)return this;let i=t[this.attr];if(i){let r=e.getDataId()+":"+s;this.connections.remove(i,r)}return this}publish(t,e,s){return this.pubSub.publish(t,e,s),this}isDataBound(t){return t&&t[this.attr]||null}isBlocked(t){return t.type!=="keyup"?!1:this.blockedKeys.indexOf(t.keyCode)!==-1}bindHandler(t){if(this.isBlocked(t))return!0;let e=t.target||t.srcElement,s=this.isDataBound(e);if(s!==null){let i=this.connections.get(s,"bind");if(i){let r=i.element.get();this.pubSub.publish(s,r,e)}}t.stopPropagation()}setupEvents(){this.changeHandler=this.bindHandler.bind(this),this.addEvents()}addEvents(){b.on(["change","paste","input"],document,this.changeHandler,!1)}removeEvents(){b.off(["change","paste","input"],document,this.changeHandler,!1)}},_=new Ur,ht=t=>t.data?t.data:t.context&&t.context.data?t.context.data:null,Xr={class:"className",text:"textContent",for:"htmlFor",readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",colspan:"colSpan",tabindex:"tabIndex",celpadding:"cellPadding",useMap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},Gt=t=>Xr[t]||t,ts=t=>typeof t=="string"&&t.substring(0,2)==="on"?t.substring(2):t,it=class{static create(t,e,s,i){let r=document.createElement(t);return this.addAttributes(r,e),i===!0?this.prepend(s,r):this.append(s,r),r}static addAttributes(t,e){if(!e||typeof e!="object")return;let s=e.type;typeof s<"u"&&j.setAttr(t,"type",s);for(let[i,r]of Object.entries(e))i==="innerHTML"?t.innerHTML=r:i.indexOf("-")!==-1?j.setAttr(t,i,r):this.addAttr(t,i,r)}static addHtml(t,e){return typeof e>"u"||e===""?this:(/(?:<[a-z][\s\S]*>)/i.test(e)?t.innerHTML=e:t.textContent=e,this)}static addAttr(t,e,s){if(!(s===""||!e))if(typeof s=="function")e=ts(e),b.add(e,t,s);else{let i=Gt(e);t[i]=s}}static createDocFragment(){return document.createDocumentFragment()}static createText(t,e){let s=document.createTextNode(t);return e&&this.append(e,s),s}static createComment(t,e){let s=document.createComment(t);return e&&this.append(e,s),s}static setupSelectOptions(t,e,s){if(!p.isObject(t)||!p.isArray(e))return!1;e.forEach(i=>{let r=new Option(i.label,i.value);t.options.add(r),s!==null&&r.value==s&&(r.selected=!0)})}static removeElementData(t){let e=t.childNodes;if(e){let r=e.length-1;for(var s=r;s>=0;s--){var i=e[s];!i||this.removeElementData(i)}}x.remove(t),t.bindId&&_.unbind(t)}static removeElement(t){let e;return!t||!(e=t.parentNode)?this:(this.removeElementData(t),e.removeChild(t),this)}static removeChild(t){return this.removeElement(t),this}static removeAll(t){if(!p.isObject(t))return this;let e=t.childNodes;for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&this.removeElementData(e[s]);return t.innerHTML="",this}static changeParent(t,e){return e.appendChild(t),this}static append(t,e){return t.appendChild(e),this}static prepend(t,e,s){let i=s||t.firstChild;return t.insertBefore(e,i),this}static clone(t,e=!1){return p.isObject(t)?t.cloneNode(e):!1}},Q=class extends it{static create(t,e,s,i){let r=document.createElement(t);return this.addAttributes(r,e,i),s.appendChild(r),r}static addAttributes(t,e,s){!e||e.length<1||e.forEach(i=>{let{key:r,value:a}=i;this.addAttr(t,r,a,s)})}static addAttr(t,e,s,i){if(s===""||!e)return;if(e==="innerHTML"){t.innerHTML=s;return}if(typeof s=="function"){e=ts(e),b.add(e,t,function(a){s.call(this,a,i)});return}if(e.substr(4,1)==="-"){j.setAttr(t,e,s);return}let r=Gt(e);t[r]=s}static addContent(t,e){!e||(e.textContent!==null?t.textContent=e.textContent:e.innerHTML&&(t.innerHTML=e.innerHTML))}static append(t,e){t.appendChild(e)}},ge=/(\[\[(.*?(?:\[\d+\])?)\]\])/g,mt={isWatching(t){return Array.isArray(t)?typeof t[0]=="string"&&this.hasParams(t[0]):this.hasParams(t)},hasParams(t){return p.isString(t)&&t.includes("[[")},_getWatcherProps(t){let e=/\[\[(.*?)(\[\d+\])?\]\]/g,s=t.match(e);return s===null?null:(e=/(\[\[|\]\])/g,s.map(i=>i.replace(e,"")))},updateAttr(t,e,s){switch(e){case"text":case"textContent":t.textContent=s;break;default:Q.addAttr(t,e,s);break}},_getWatcherCallBack(t,e,s,i,r){return()=>{let a=0,n=s.replace(ge,function(){let l=r?e[a]:e;a++;let o=l.get(arguments[2]);return typeof o<"u"?o:""});this.updateAttr(t,i,n)}},getValue(t,e){typeof t=="string"&&(t={value:t});let s=t.value;return Array.isArray(s)===!1?[s,ht(e)]:(s.length<2&&s.push(ht(e)),s)},getPropValues(t,e,s){let i=[];for(var r=0,a=e.length;r<a;r++){var n=s?t[r]:t,l=n.get(e[r]);l=typeof l<"u"?l:"",i.push(l)}return i},getCallBack(t,e,s,i,r){let a,n=t.callBack;if(typeof n=="function"){let l=i.match(ge)||[],o=l&&l.length>1;a=(c,u)=>{c=o!==!0?c:this.getPropValues(s,l,r),n(c,e,u)}}else{let l=t.attr||"textContent";a=this._getWatcherCallBack(e,s,i,l,r)}return a},addDataWatcher(t,e,s){let i=this.getValue(e,s),r=i[1];if(!r)return;let a=i[0],n=Array.isArray(r),l=this.getCallBack(e,t,r,a,n),o=this._getWatcherProps(a);for(var c=0,u=o.length;c<u;c++){var f=n?r[c]:r;this.addWatcher(t,f,o[c],l)}},setup(t,e,s){if(e){if(Array.isArray(e)){let i=[e[0],e[1]],r=e[2];typeof r=="function"?e={value:i,callBack:r}:e={attr:r,value:[e[0],e[1]]}}this.addDataWatcher(t,e,s)}},addWatcher(t,e,s,i){_.watch(t,e,s,i)}},qr=t=>typeof t!="string"?t:es(t),es=t=>[{tag:"text",textContent:t}],Vr=t=>{if(!t)return{props:{},children:[]};let e=t[0];return typeof e=="string"?{props:{},children:es(e)}:Array.isArray(e)?mt.isWatching(e)===!1?{props:{},children:e}:{props:{watch:e},children:[]}:{props:e||{},children:qr(t[1])}},v=t=>(...e)=>{let{props:s,children:i}=Vr(e);return t(s,i)},ss=t=>{let e={};if(!p.isObject(t))return e;let s=O.clone(t);return Object.keys(s).forEach(i=>{let r=s[i];typeof r!="function"&&(e[i]=r)}),e};function me(t,e){let s=isNaN(Number(e)),i=s?e:`[${e}]`;return t===""?i:s?`${t}.${i}`:`${t}${i}`}function is(t,e="",s=""){return{get(i,r,a){let n=i[r];if(e===""&&r in i)return typeof n=="function"?n.bind(i):n;let l=i[s]||i;if(n=Reflect.get(l,r,a),O.isPlainObject(n)||Array.isArray(n)){let o=me(e,r);return new Proxy(n,is(t,o,s))}return n},set(i,r,a,n){if(e===""&&r in i)return i[r]=a,!0;let l=me(e,r);return t.set(l,a),!0}}}var Yr=(t,e="stage")=>new Proxy(t,is(t,"",e)),Gr=0,Kt=class{constructor(t){this.dirty=!1,this.links={},this._init(),this.setup(),this.dataTypeId="bd",this.eventSub=new Ze;let e=ss(t);return this.set(e),Yr(this)}setup(){this.stage={}}_init(){let t=++Gr;this._dataNumber=t,this._id="dt-"+t,this._dataId=this._id+":"}getDataId(){return this._id}remove(){}on(t,e){let s=t+":change";return this.eventSub.on(s,e)}off(t,e){let s=t+":change";this.eventSub.off(s,e)}_setAttr(t,e,s=this,i=!1){let r=this.stage[t];e!==r&&(this.stage[t]=e,this._publish(t,e,s,r))}_publish(t,e,s,i){let r=t+":change";this.eventSub.publish(r,e,s),s=s||this,_.publish(this._dataId+t,e,s)}set(...t){if(typeof t[0]!="object")return this._setAttr(...t),this;let[e,s,i]=t;return Object.entries(e).forEach(([r,a])=>{typeof a!="function"&&this._setAttr(r,a,s,i)}),this}getModelData(){return this.stage}_deleteAttr(t,e){delete t[e]}toggle(t){if(!(typeof t>"u"))return this.set(t,!this.get(t)),this}increment(t){if(typeof t>"u")return;let e=this.get(t);return this.set(t,++e),this}decrement(t){if(typeof t>"u")return;let e=this.get(t);return this.set(t,--e),this}concat(t,e){if(typeof t>"u")return;let s=this.get(t);return this.set(t,s+e),this}ifNull(t,e){return this.get(t)===null&&this.set(t,e),this}setKey(t){return this.key=t,this}resume(t){let e=this.key;if(!e)return this;let s,i=localStorage.getItem(e);return i===null?t&&(s=t):s=JSON.parse(i),s?(this.set(s),this):this}store(){let t=this.key;if(!t)return!1;let e=this.get();if(!e)return!1;let s=JSON.stringify(e);return localStorage.setItem(t,s),!0}delete(t){if(typeof t<"u"){this._deleteAttr(this.stage,t);return}this.setup()}_getAttr(t,e){return t[e]}get(t){return typeof t<"u"?this._getAttr(this.stage,t):this.getModelData()}link(t,e,s){if(arguments.length===1&&t.isData===!0&&(e=t.get()),typeof e!="object")return this.remoteLink(t,e,s);let i=[];return Object.entries(e).forEach(([r])=>{i.push(this.remoteLink(t,r))}),i}remoteLink(t,e,s){let i=s||e,r=t.get(e);typeof r<"u"&&this.get(e)!==r&&this.set(e,r);let a=t.on(e,(l,o)=>{if(o===this)return!1;this.set(i,l,t)});this.addLink(a,t);let n=this.on(i,(l,o)=>{if(o===t)return!1;t.set(e,l,this)});return t.addLink(n,this),a}addLink(t,e){this.links[t]=e}unlink(t){if(t){this.removeLink(t);return}let e=this.links;O.isEmpty(e)||(Object.entries(e).forEach(([s,i])=>{this.removeLink(i,!1)}),this.links={})}removeLink(t,e=!0){let s=this.links[t];s&&s.off(t),e!==!1&&delete this.links[t]}};Kt.prototype.isData=!0;var F={deepDataPattern:/(\w+)|(?:\[(\d)\))/g,hasDeepData(t){return t.indexOf(".")!==-1||t.indexOf("[")!==-1},getSegments(t){let e=this.deepDataPattern;return t.match(e)}},Jt=class extends Kt{setup(){this.attributes={},this.stage={}}_updateAttr(t,e,s){if(!F.hasDeepData(e)){t[e]=s;return}let i,r=F.getSegments(e),a=r.length,n=a-1;for(var l=0;l<a;l++){if(i=r[l],l===n){t[i]=s;break}t[i]===void 0&&(t[i]=isNaN(i)?{}:[]),t=t[i]}}_setAttr(t,e,s,i){typeof e!="object"&&e===this.get(t)||(!s&&i!==!0?this._updateAttr(this.attributes,t,e):this.dirty===!1&&(this.dirty=!0),this._updateAttr(this.stage,t,e),s=s||this,this._publish(t,e,s))}linkAttr(t,e){let s=t.get(e);if(s)for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&this.link(t,e+"."+i,i)}scope(t,e){let s=this.get(t);if(!s)return!1;e=e||this.constructor;let i=new e(s);return i.linkAttr(this,t),i}splice(t,e){return this.delete(t+"["+e+"]"),this.refresh(t),this}push(t,e){let s=this.get(t);return Array.isArray(s)===!1&&(s=[]),s.push(e),this.set(t,s),this}unshift(t,e){let s=this.get(t);return Array.isArray(s)===!1&&(s=[]),s.unshift(e),this.set(t,s),this}shift(t){let e=this.get(t);if(Array.isArray(e)===!1)return null;let s=e.shift();return this.set(t,e),s}pop(t){let e=this.get(t);if(Array.isArray(e)===!1)return null;let s=e.pop();return this.set(t,e),s}refresh(t){return this.set(t,this.get(t)),this}_publish(t,e,s){this.publish(t,e,s)}publishDeep(t,e,s){if(!F.hasDeepData(t)){this.publish(t,e,s);return}let i,r=F.getSegments(t),a=r.length,n=a-1,l="",o=this.stage;for(var c=0;c<a;c++){i=r[c],o=o[i],c>0?isNaN(i)&&(l+="."+i):l=i;var u;if(c===n)u=e;else{var f=r[c+1];if(isNaN(f)===!1){l+="["+f+"]";continue}var L={};L[f]=o[f],u=L}this.publish(l,u,s)}}publish(t,e,s){if(t=t||"",this._publishAttr(t,e,s),!e||typeof e!="object")return;let i,r;if(Array.isArray(e)){let l=e.length;for(var a=0;a<l;a++)r=e[a],i=t+"["+a+"]",this._checkPublish(i,r,s)}else for(var n in e)!Object.prototype.hasOwnProperty.call(e,n)||(r=e[n],i=t+"."+n,this._checkPublish(i,r,s))}_checkPublish(t,e,s){!e||typeof e!="object"?this._publishAttr(t,e,s):this.publish(t,e,s)}_publishAttr(t,e,s){_.publish(this._dataId+t,e,s);let i=t+":change";this.eventSub.publish(i,e,s)}mergeStage(){this.attributes=O.clone(this.stage),this.dirty=!1}getModelData(){return this.mergeStage(),this.attributes}revert(){this.set(this.attributes),this.dirty=!1}_deleteAttr(t,e){F.hasDeepData(e)||delete t[e];let s=F.getSegments(e),i=s.length,r=i-1;for(var a=0;a<i;a++){var n=s[a],l=t[n];if(l===void 0)break;if(a===r){if(Array.isArray(t)){t.splice(n,1);break}delete t[n];break}t=l}}_getAttr(t,e){if(!F.hasDeepData(e))return t[e];let s=F.getSegments(e),i=s.length,r=i-1;for(var a=0;a<i;a++){var n=s[a],l=t[n];if(l===void 0)break;if(t=l,a===r)return t}}},Kr={"\n":"\\n","\r":"\\n","	":"\\t"},Jr=(t,e)=>{typeof t!="string"&&(t=String(t));let s=e?/[\n\r\t]/g:/\t/g;return t.replace(s,i=>Kr[i])},ve=(t,e)=>{if(typeof t!="string")return t;t=Jr(t,e),t=encodeURIComponent(t);let s=/%22/g;return t.replace(s,'"')},rs=(t,e)=>{let s=typeof t;return s==="undefined"?t:s!=="object"?(t=ve(t),t):(Object.entries(t).forEach(([i,r])=>{r!==null&&(t[i]=typeof r=="string"?rs(r,e):ve(r,e))}),t)};function Qr(t){return typeof t<"u"&&t.length>0?JSON.parse(t):!1}function as(t){return typeof t<"u"?JSON.stringify(t):null}var ns=class{static prepareJsonUrl(t,e=!1){let s=typeof t=="object"?O.clone(t):t,i=rs(s,e);return as(i)}static xmlParse(t){return typeof t>"u"?!1:new DOMParser().parseFromString(t,"text/xml")}};Pt(ns,"json",{encode:as,decode:Qr});var Zr=class{constructor(t){this.model=t,this.objectType=this.objectType||"item",this.url="",this.validateCallBack=null,this.init()}init(){let t=this.model;t&&t.url&&(this.url=t.url)}isValid(){let t=this.validate();if(t!==!1){let e=this.validateCallBack;typeof e=="function"&&e(t)}return t}validate(){return!0}getDefaultParams(){return""}setupParams(t){let e=this.getDefaultParams();return t=this.addParams(t,e),t}objectToString(t){let e=[];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.push(s+"="+t[s]);return e.join("&")}addParams(t,e){if(t=t||{},typeof t=="string"&&(t=U.parseQueryString(t,!1)),!e)return this._isFormData(t)?t:this.objectToString(t);if(typeof e=="string"&&(e=U.parseQueryString(e,!1)),this._isFormData(t))for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.append(s,e[s]);else t=Object.assign(t,e),t=this.objectToString(t);return t}get(t,e){let s=this.model.get("id"),i="op=get&id="+s,r=this.model;return this._get("",i,t,e,a=>{if(a){let n=this.getObject(a);n&&r.set(n)}})}getObject(t){return t[this.objectType]||t||!1}setupObjectData(){let t=this.model.get();return this.objectType+"="+ns.prepareJsonUrl(t)}setup(t,e){if(!this.isValid())return!1;let s="op=setup&"+this.setupObjectData();return this._put("",s,t,e)}add(t,e){if(!this.isValid())return!1;let s="op=add&"+this.setupObjectData();return this._post("",s,t,e)}update(t,e){if(!this.isValid())return!1;let s="op=update&"+this.setupObjectData();return this._patch("",s,t,e)}delete(t,e){let s=this.model.get("id"),i="op=delete&id="+s;return this._delete("",i,t,e)}all(t,e,s,i,r){r=r||"",s=isNaN(s)?0:s,i=isNaN(i)?50:i;let a="op=all&option="+r+"&start="+s+"&stop="+i;return this._get("",a,t,e)}getUrl(t){let e=this.url;return t?t[0]==="?"?e+t:e+="/"+t:e}setupRequest(t,e,s,i,r){let a={url:this.getUrl(t),method:e,params:s,completed:(n,l)=>{typeof r=="function"&&r(n),this.getResponse(n,i,l)}};return this._isFormData(s)&&(a.headers={}),Ye(a)}_isFormData(t){return t instanceof FormData}request(t,e,s,i){return this._request("","POST",t,e,s,i)}_get(t,e,s,i,r){return e=this.setupParams(e),e=this.addParams(e,s),t=t||"",e&&(t+="?"+e),this.setupRequest(t,"GET","",i,r)}_post(t,e,s,i,r){return this._request(t,"POST",e,s,i,r)}_put(t,e,s,i,r){return this._request(t,"PUT",e,s,i,r)}_patch(t,e,s,i,r){return this._request(t,"PATCH",e,s,i,r)}_delete(t,e,s,i,r){return this._request(t,"DELETE",e,s,i,r)}_request(t,e,s,i,r,a){return s=this.setupParams(s),s=this.addParams(s,i),this.setupRequest(t,e,s,r,a)}getResponse(t,e,s){typeof e=="function"&&e(t,s)}static extend(t){if(!t)return!1;let e=this;class s extends e{constructor(r){super(r)}}return Object.assign(s.prototype,t),s}},ta=t=>{let e={};if(!p.isObject(t)||!t.defaults)return e;let{defaults:s}=t;return Object.keys(s).forEach(i=>{let r=s[i];typeof r!="function"&&(e[i]=r)}),delete t.defaults,e},ea=t=>{if(!t||typeof t.xhr!="object")return{};let e={...t.xhr};return delete t.xhr,e},sa=0,ls=class extends Jt{constructor(t){let e=super(t);return this.initialize(),e}setup(){this.attributes={},this.stage={},this.xhr=null}initialize(){}static extend(t={}){let e=this,s=ea(t),i=this.prototype.service.extend(s),r=ta(t);class a extends e{constructor(o){let c={...r,...ss(o)};super(c);g(this,"dataTypeId",`bm${sa++}`);this.xhr=new i(this)}}return Object.assign(a.prototype,t),a.prototype.service=i,a}};ls.prototype.service=Zr;var Qt=class extends Kt{_publish(t,e,s,i){let r=t+":change";this.eventSub.publish(r,e,s),s=s||this,_.publish(this._dataId+t,e,s)}},ia=class extends Qt{constructor(t){super(),this.id=t}setup(){this.stage={},this.id=null}addAction(t,e){typeof e<"u"&&this.set(t,e)}getState(t){return this.get(t)}removeAction(t,e){if(e){this.off(t,e);return}let s=this.stage;typeof s[t]<"u"&&delete s[t]}},lt=class{static restore(t,e){this.targets.set(t,e)}static getTarget(t){return this.targets.has(t)||this.targets.set(t,new ia(t)),this.targets.get(t)}static getActionState(t,e){return this.getTarget(t).get(e)}static add(t,e,s){let i=this.getTarget(t);return e&&i.addAction(e,s),i}static addAction(t,e,s){return this.add(t,e,s)}static removeAction(t,e,s){this.off(t,e,s)}static on(t,e,s){let i=this.getTarget(t);return e?i.on(e,s):null}static off(t,e,s){this.remove(t,e,s)}static remove(t,e,s){let i=this.targets,r=i.get(t);if(r){if(e){r.off(e,s);return}this.targets.delete(t)}}static set(t,e,s){this.getTarget(t).set(e,s)}};Pt(lt,"targets",new Map);var ra=class{constructor(){this.events=[]}addEvents(t){t.length<1||t.forEach(e=>{this.on(...e)})}on(t,e,s,i){b.on(t,e,s,i),this.events.push({event:t,obj:e,callBack:s,capture:i})}off(t,e,s,i){b.off(t,e,s,i);let r,a=this.events;for(var n=0,l=a.length;n<l;n++)if(r=a[n],r.event===t&&r.obj===e){a.splice(n,1);break}}set(){this.events.forEach(t=>{b.on(t.event,t.obj,t.callBack,t.capture)})}unset(){this.events.forEach(t=>{b.off(t.event,t.obj,t.callBack,t.capture)})}reset(){this.unset(),this.events=[]}},aa=class{constructor(t,e){this.remoteStates=[];let s=this.convertStates(e);this.addStatesToTarget(t,s)}addStates(t,e){let s=this.convertStates(e);this.addStatesToTarget(t,s)}createState(t,e,s,i){return{action:t,state:e,callBack:s,targetId:i,token:null}}convertStates(t){let e=[];for(var s in t)if(Object.prototype.hasOwnProperty.call(t,s)){if(s==="remotes"){this.setupRemoteStates(t[s],e);continue}var i=null,r=null,a=t[s];a&&typeof a=="object"&&(r=a.callBack,i=a.id||a.targetId,a=a.state),e.push(this.createState(s,a,r,i))}return e}setupRemoteStates(t,e){let s;for(var i=0,r=t.length;i<r;i++)if(s=t[i],!!s){for(var a in s)if(!(!Object.prototype.hasOwnProperty.call(s,a)||a==="id")){var n=null,l=s[a],o=l!==null?l:void 0;o&&typeof o=="object"&&(n=o.callBack,o=o.state),e.push(this.createState(a,o,n,s.id))}}}removeRemoteStates(){let t=this.remoteStates;t&&this.removeActions(t)}removeActions(t){if(!(t.length<1))for(var e=0,s=t.length;e<s;e++){var i=t[e];lt.remove(i.targetId,i.action,i.token)}}restore(t){lt.restore(t.id);let e=this.remoteStates;if(e)for(var s=0,i=e.length;s<i;s++){var r=e[s];r.token=this.bindRemoteState(t,r.action,r.targetId)}}bindRemoteState(t,e,s){let i=lt.getTarget(s);return t.link(i,e)}addStatesToTarget(t,e){let s=this.remoteStates;for(var i=0,r=e.length;i<r;i++){var a=e[i],n=this.addAction(t,a);a.targetId&&(a.token=n,s.push(a))}s.length<1&&(this.remoteStates=null)}addAction(t,e){let s,i=e.action,r=e.targetId;r&&(s=this.bindRemoteState(t,i,r)),typeof e.state<"u"&&t.addAction(i,e.state);let a=e.callBack;return typeof a=="function"&&t.on(i,a),s}},na=t=>typeof t!="string"?t:os(t),os=t=>[{tag:"text",textContent:t}],la=t=>{if(!t)return{props:{},children:[]};let e=t[0];return typeof e=="string"?{props:{},children:os(e)}:Array.isArray(e)?{props:{},children:e}:{props:e||{},children:na(t[1])}};x.addType("components",t=>{if(!t)return;let e=t.component;e&&e.rendered===!0&&e.prepareDestroy()});var oa=0,hs=class{constructor(...t){var i;this.isUnit=!0,this.data=null,this.persist=!1,this.children=null,this.nest=null,this.state=null,this.panel=null,this.parent=null,this.init();let{props:e,children:s}=la(t);this.setupProps(e),(i=this.children)!=null||(this.children=s),this.onCreated(),this.rendered=!1,this.container=null}init(){this.id="cp-"+oa++}setupProps(t){if(!(!t||typeof t!="object"))for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(this[e]=t[e])}getParentContext(){return this.parent?this.parent.getContext():null}setupContext(){let t=this.getParentContext(),e=this.setContext(t);if(e){this.context=e;return}this.context=t,this.setupAddingContext()}setupAddingContext(){let t=this.context,e=this.addContext(t);if(!e)return;let s=e[0];!s||(this.addingContext=!0,this.contextBranchName=s,this.addContextBranch(s,e[1]))}addContextBranch(t,e){var s;(s=this.context)!=null||(this.context={}),this.context[t]=e}setContext(t){return null}addContext(t){return null}removeContext(){!this.addingContext||this.removeContextBranch(this.contextBranchName)}removeContextBranch(t){!t||delete this.context[t]}getContext(){return this.context}onCreated(){}render(){return{}}_cacheRoot(t){return t&&(t.id||(t.id=this.getId()),t.cache="panel",t)}_createLayout(){return this.persist?this._layout||(this._layout=this.render()):this.render()}prepareLayout(){let t=this._createLayout();return this._cacheRoot(t)}afterBuild(){x.add(this.panel,"components",{component:this}),this.rendered=!0,this.afterLayout()}afterLayout(){this.afterSetup()}if(t,e){return t?e||t:null}map(t,e){let s=[];if(!t||t.length<1)return s;for(var i=0,r=t.length;i<r;i++){let a=e(t[i],i);s.push(a)}return s}removeAll(t){return it.removeAll(t)}getId(t){let e=this.id;return typeof t=="string"&&(e+="-"+t),e}initialize(){this.setupContext(),this.beforeSetup()}beforeSetup(){}afterSetup(){}setup(t){this.container=t,this.initialize()}remove(){this.prepareDestroy(),this.removeContext();let t=this.panel||this.id;it.removeElement(t)}prepareDestroy(){this.rendered=!1,this.beforeDestroy()}beforeDestroy(){}destroy(){this.remove()}},cs=class extends hs{constructor(...t){super(...t),this.isComponent=!0,this.stateTargetId=null}initialize(){this.setupContext(),this.addStates(),this.beforeSetup()}afterLayout(){this.addEvents(),this.afterSetup()}setupStateTarget(t){let e=t||this.stateTargetId||this.id;this.state=lt.getTarget(e)}setupStates(){return{}}addStates(){let t=this.state;if(t){this.stateHelper.restore(t);return}let e=this.setupStates();O.isEmpty(e)||(this.setupStateTarget(),this.stateHelper=new aa(this.state,e))}removeStates(){let t=this.state;!t||(this.stateHelper.removeRemoteStates(),t.remove())}setupEventHelper(){this.events||(this.events=new ra)}setupEvents(){return[]}addEvents(){let t=this.setupEvents();t.length<1||(this.setupEventHelper(),this.events.addEvents(t))}removeEvents(){let t=this.events;t&&t.reset()}prepareDestroy(){this.rendered=!1,this.beforeDestroy(),this.removeEvents(),this.removeStates(),this.removeContext(),this.data&&this.persist===!1&&this.data.unlink()}},ha={created:"onCreated",state:"setupStates",events:"setupEvents",before:"beforeSetup",render:"render",after:"afterSetup",destroy:"beforeDestroy"},ca=t=>typeof t=="function"?t:()=>t,ua=t=>{let e={};return t&&Object.entries(t).forEach(([s,i])=>{let r=ha[s]||s;e[r]=ca(i)}),e},ye=(t,e)=>{class s extends t{}return Object.assign(s.prototype,e),s},Zt=t=>{if(!t)return null;let e,s=typeof t;return s==="object"&&t.render?(e=ua(t),ye(cs,e)):(e={render:s==="function"?t:()=>t},ye(hs,e))},da=(t,e)=>({name:t,callBack:e}),Nt={keys:[],items:{},add(t,e){return this.keys.push(t),this.items[t]=da(t,e),this},get(t){return this.items[t]||null},all(){return this.keys}},be=(t,e)=>({attr:t,directive:e}),ft=(t,e)=>({key:t,value:e}),pa=(t,e,s,i)=>({tag:t,attr:e,directives:s,children:i}),us=class{static getTag(t){return t.tag||"div"}static setupChildren(t){t.nest&&(t.children=t.nest,delete t.nest)}static setElementContent(t,e,s,i){return t==="text"?(i.push({tag:"text",textContent:e}),!0):t==="html"||t==="innerHTML"?(s.push(ft("innerHTML",e)),!0):!1}static setTextAsWatcher(t,e,s){let i={attr:Gt(e),value:s};t.push(be(ft(e,i),Nt.get("watch")))}static setButtonType(t,e,s){if(t==="button"){let i=e.type||"button";s.push(ft("type",i))}}static parse(t,e){let s=[],i=[],r=this.getTag(t);this.setButtonType(r,t,s),this.setupChildren(t);let a=[];var n,l;for(var o in t){if(!O.hasOwnProp(t,o)||o==="tag"||(n=t[o],n==null))continue;if((l=Nt.get(o))!==null){i.push(be(ft(o,n),l));continue}let c=typeof n;if(c==="object"){if(o==="children"){a=a.concat(n);continue}if(mt.isWatching(n)){this.setTextAsWatcher(i,o,n);continue}a.push(n);continue}if(c==="function"){let u=n;n=function(f){u.call(this,f,e)}}if(mt.isWatching(n)){this.setTextAsWatcher(i,o,n);continue}this.setElementContent(o,n,s,a)||s.push(ft(o,n))}return pa(r,s,i,a)}},ds=class{createNode(t,e,s){}},fa=class extends ds{createNode(t,e,s){let i=t.tag;if(i==="text"){let r=t.attr[0],a=r?r.value:"";return Q.createText(a,e)}else if(i==="comment"){let r=t.attr[0],a=r?r.value:"";return Q.createComment(a,e)}return Q.create(i,t.attr,e,s)}},ga=class extends ds{createNode(t,e,s){let i=t.tag;if(i==="text"){let r=t.attr[0];r&&r.value}else if(i==="comment"){let r=t.attr[0];r&&r.value}}},ma=class{static browserIsSupported(){return window}static setup(){return this.browserIsSupported()?new fa:new ga}},va=ma.setup(),M=class{static render(t,e,s){if(!t)return null;if(typeof t=="object"&&t.isUnit===!0)return this.createComponent(t,e,s),t;let i=Zt(t),r=new i;return this.createComponent(r,e,s),r}static build(t,e,s){let i=Q.createDocFragment();return(Array.isArray(t)?t:[t]).forEach(r=>this.buildElement(r,i,s)),e&&typeof e=="object"&&e.appendChild(i),i}static rebuild(t,e,s){return Q.removeAll(e),this.build(t,e,s)}static buildElement(t,e,s){if(t){if(t.isUnit===!0){this.createComponent(t,e,s);return}this.createElement(t,e,s)}}static createElement(t,e,s){let i=us.parse(t,s),r=this.createNode(i,e,s);this.cache(r,t.cache,s),i.children.forEach(n=>{n!==null&&this.buildElement(n,r,s)});let a=i.directives;a&&a.length&&this.setDirectives(r,a,s)}static setDirectives(t,e,s){e.forEach(i=>{this.handleDirective(t,i,s)})}static handleDirective(t,e,s){e.directive.callBack(t,e.attr.value,s)}static cache(t,e,s){s&&e&&(s[e]=t)}static createComponent(t,e,s){let i=t;i.parent=s,s&&s.persist===!0&&i.persist!==!1&&(i.persist=!0),i.cache&&s&&(s[i.cache]=i),i.setup(e);let r=i.prepareLayout();this.build(r,i.container,i),i.afterBuild(),t.component&&typeof t.onCreated=="function"&&t.onCreated(i)}static createNode(t,e,s){return va.createNode(t,e,s)}};st.augment({buildLayout(t,e,s){M.build(t,e,s)}});var te=[],ya=t=>te.indexOf(t)!==-1,ba=t=>({tag:"script",src:t.src,async:!1,load(e){te.push(t.src);let s=t.load;s&&s()}}),wa=t=>({tag:"link",rel:"stylesheet",type:"text/css",href:t.src,load(e){te.push(t.src);let s=t.load;s&&s()}}),ka=class{constructor(t){this.percent=0,this.loaded=0,this.total=0,this.callBack=t||null}add(t){this.total++;let e,s=this.update.bind(this);t.indexOf(".css")!==-1?e=wa({load:s,src:t}):e=ba({load:s,src:t}),M.build(e,document.head)}addFiles(t){!t||t.forEach(e=>{ya(e)||this.add(e)})}update(){if(this.updateProgress()<100)return;let t=this.callBack;t&&t()}updateProgress(){return++this.loaded,this.percent=Math.floor(this.loaded/this.total*100)}},Sa=(t,e)=>{Ce(()=>import(t),[]).then(s=>{e&&e(s)})},Pa=t=>{var e;return t?typeof((e=t==null?void 0:t.prototype)==null?void 0:e.constructor)=="function":!1},xa=(t,e,s)=>{let i=M.build(t,null,s),r=i.firstChild;return e.after(i),r},Ca=t=>({tag:"comment",textContent:"import placeholder",onCreated:t.onCreated}),Aa=Zt({render(){return Ca({onCreated:t=>{if(this.src){if(this.depends){new ka(()=>{this.loadAndRender(t)}).addFiles(this.depends);return}this.loadAndRender(t)}}})},getLayout(t){let e=t.default;if(!e)return null;let s=this.callBack;return s?e=s(e):Pa(e)?(e=new e,e.route=this.route,this.persist&&(e.persist=!0)):e=e(),this.layout=e},loadAndRender(t){Sa(this.src,e=>{this.loaded=!0;let s=this.layout||this.getLayout(e);this.layoutRoot=xa(s,t,this.parent)})},shouldUpdate(t){return this.updateLayout===!0?!0:this.updateLayout=t&&t.isUnit&&typeof t.update=="function"},updateModuleLayout(t){let e=this.layout;this.shouldUpdate(e)&&e.update(t)},update(t){this.loaded===!0&&this.updateModuleLayout(t)},beforeDestroy(){!this.layoutRoot||it.removeElement(this.layoutRoot)}}),La=t=>new Aa(t),ee=(t,e,s,i)=>{let r,a,n;if(Array.isArray(s[0])){s.forEach(l=>{!l||ee(t,e,l,i)});return}if(s.length<3?[r,a]=s:[e,r,a]=s,!(!e||!r)){switch(typeof a){case"object":n=l=>{Oa(t,a,l)};break;case"function":n=l=>{Ta(t,a,r,l,i)};break}_.watch(t,e,r,n)}},Ta=(t,e,s,i,r)=>{let a=e(i,t,r);switch(typeof a){case"object":if(r&&a&&a.isUnit===!0&&r.persist===!0&&r.state){let n=s+":"+i,l=r.state,o=l.get(n);typeof o<"u"&&(a=o),l.set(n,a)}Ea(a,t,r);break;case"string":it.addHtml(t,a);break}},Ea=(t,e,s)=>{M.rebuild(t,e,s)},Oa=(t,e,s)=>{for(let[i,r]of Object.entries(e))!i||(r===s?j.addClass(t,i):j.removeClass(t,i))},ps=(t,e,s)=>{let i=ht(s);ee(t,i,e,s)},ja=(t,e,s)=>{!e||e&&j.setAttr(t,"role",e)},Ba=t=>(e,s)=>{let i=s?"true":"false";j.setAttr(e,t,i)},Da=(t,e,s)=>{if(!e)return;let i=e.role;i&&(j.setAttr(t,"role",i),e.role=null),Object.entries(e).forEach(([r,a])=>{if(a===null)return;let n=`aria-${r}`;Array.isArray(a)?(a.push(Ba(n)),ps(t,a,s)):j.setAttr(t,n,a)})};x.addType("context",t=>{if(!t)return!1;t.parent.removeContextBranch(t.branch)});var se=t=>t?t.getContext():null,Ia=(t,e,s)=>{if(typeof e!="function")return;let i=se(s),r=e(i);if(!r)return;let a=us.parse(r,s);Q.addAttributes(t,a.attr,s),M.setDirectives(t,a.directives,s)},Ra=(t,e,s)=>{if(typeof e!="function")return;let i=se(s);e(i)},$a=(t,e,s)=>{if(typeof e!="function"||!s)return;let i=se(s),r=e(i);!r||s.addContextBranch(r[0],r[1])},Na=(t,e,s)=>{},_a=(t,e,s)=>{!e||!s||e(s,t)},Ma=(t,e,s)=>{!e||!s||e(s.data,t)},za=(t,e,s)=>{!e||!s||e(s.state,t)},Fa=(t,e,s)=>{if(!(!e||!s)&&s.stateHelper){let i=s.state,r=e(i);s.stateHelper.addStates(r)}},Wa=(t,e,s)=>{let i,r,a;if(typeof e=="string"){if(i=ht(s),!i)return;r=e}else if(Array.isArray(e)){if(typeof e[0]!="object"){let n=ht(s);if(!n)return;e.unshift(n)}[i,r,a]=e}_.bind(t,i,r,a)},Ha=(t,e,s)=>{let i,r,a,n;if(e.length<3){let o=ht(s);if(!o)return;i=o,[r,a,n]=e}else[i,r,a,n]=e;let l=n!==!1;_.watch(t,i,r,o=>{if(it.removeAll(t),!o||o.length<1)return;let c=[];return o.forEach((u,f)=>{let L=l?i.scope(r+"["+f+"]"):null,I=a(o[f],f,L);I!==null&&c.push(I)}),M.build(c,t,s)})},Ua=(t,e,s)=>{let i=e[0];if(!i||i.length<1)return;let r=e[1],a=[];i.forEach((n,l)=>{if(!n)return;let o=r(n,l);o!==null&&a.push(o)}),M.build(a,t,s)},Xa=(t,e,s)=>{e(t)};x.addType("destroyed",t=>{if(!t)return!1;t.callBack(t.ele)});var qa=(t,e,s)=>{Va(t,e)},Va=(t,e)=>{x.add(t,"destroyed",{ele:t,callBack:e})},Ya=(t,e,s)=>{ee(t,s.state,e,s)},Ga=(t,e,s)=>{if(e)if(Array.isArray(e)&&typeof e[0]!="string")for(var i=0,r=e.length;i<r;i++)mt.setup(t,e[i],s);else mt.setup(t,e,s)},Ka=0,fs=class{constructor(t){this.router=t,this.locationId="base-app-router-"+Ka++,this.callBack=this.check.bind(this)}setup(){return this.addEvent(),this}check(t){}addEvent(){return this}},Ja=class extends fs{addEvent(){return b.on("popstate",window,this.callBack),this}removeEvent(){return b.off("popstate",window,this.callBack),this}check(t){let e=t.state;if(!e||e.location!==this.locationId)return!1;t.preventDefault(),t.stopPropagation(),this.router.checkActiveRoutes(e.uri)}createState(t,e={}){return{location:this.locationId,...e,uri:t}}addState(t,e,s=!1){let i=window.history,r=i.state;if(r&&r.uri===t)return this;let a=this.createState(t,e);return i[s===!1?"pushState":"replaceState"](a,null,t),this}},Qa=class extends fs{addEvent(){return b.on("hashchange",window,this.callBack),this}removeEvent(){return b.off("hashchange",window,this.callBack),this}check(t){this.router.checkActiveRoutes(t.newURL)}addState(t,e,s){return window.location.hash=t,this}},Za=class{static browserIsSupported(){return"history"in window&&"pushState"in window.history}static setup(t){return this.browserIsSupported()?new Ja(t).setup():new Qa(t).setup()}},tn=class{constructor(t,e){this.route=t,this.template=e.component,this.component=null,this.hasTemplate=!1,this.setup=!1,this.container=e.container,this.persist=e.persist,this.parent=e.parent,this.setupTemplate()}focus(t){this.setup===!1&&this.create(),this.update(t)}setupTemplate(){let t=this.template;if(typeof t=="string"&&(t=this.template=window[t],!t))return;let e=typeof t;e==="function"?this.initializeComponent():e==="object"&&this.initializeTemplateObject(),this.hasTemplate=!0}initializeComponent(){this.component=new this.template({route:this.route,persist:this.persist,parent:this.parent})}initializeTemplateObject(){this.template.isUnit||(this.template=Zt(this.template));let t=this.template;this.persist=t.persist!==!1,Object.assign(t,{route:this.route,persist:this.persist,parent:this.parent}),this.component=t}create(){if(!this.hasTemplate)return;this.setup=!0;let t=this.component;(!this.persist||!t)&&(t=this.component=this.template),M.render(t,this.container,this.parent)}remove(){if(this.setup!==!0)return;this.setup=!1;let t=this.component;!t||(typeof t.destroy=="function"&&t.destroy(),this.persist===!1&&(this.component=null))}update(t){let e=this.component;!e||typeof e.update=="function"&&e.update(t)}},en=t=>{if(!t.length)return null;let e={};return t.forEach(s=>{e[s]=null}),e},sn=t=>{let e=[];if(!t)return e;let s=/[*?]/g;t=t.replace(s,"");let i=/:(.[^./?&($]+)\?*/g,r=t.match(i);return r===null||r.forEach(a=>{a&&(a=a.replace(":",""),e.push(a))}),e},rn=t=>t.replace(/\//g,"/"),an=t=>t.replace(/(\/):[^/(]*?\?/g,e=>e.replace(/\//g,"(?:$|/)")),nn=t=>(t=t.replace(/(\?\/+\*?)/g,"?/*"),t.replace(/(:[^/?&($]+)/g,e=>e.indexOf(".")<0?"([^/|?]+)":"([^/|?]+.*)")),ln=t=>t.replace(/(\*)/g,".*"),on=(t,e)=>t+=e[e.length-1]==="*"?"":"$",hn=t=>{if(!t)return"";let e=rn(t);return e=an(e),e=nn(e),e=ln(e),e=on(e,t),e},cn=0,un=class extends Qt{constructor(t,e){let s=t.baseUri,i=sn(s),r=en(i),a=super(r);return this.uri=s,this.paramKeys=i,this.titleCallBack=e,this.setupRoute(t),this.set("active",!1),a}setup(){this.stage={},this.id=null,this.uri=null,this.uriQuery=null,this.controller=null,this.paramKeys=null,this.titleCallBack=null,this.path=null,this.referralPath=null,this.params=null,this.callBack=null,this.title=null}setupRoute(t){this.id=t.id||"bs-rte-"+cn++,this.path=null,this.referralPath=null;let e=hn(this.uri);this.uriQuery=new RegExp("^"+e),this.params=null,this.setupComponentHelper(t),this.callBack=t.callBack,this.title=t.title}setTitle(t){this.titleCallBack(this,t)}deactivate(){this.set("active",!1);let t=this.controller;t&&t.remove()}getLayout(t){if(t.component)return t.component;let e=t.import;return e?(typeof e=="string"&&(e={src:e}),La(e)):null}setupComponentHelper(t){let e=this.getLayout(t);if(!e)return;let{container:s,persist:i=!1,parent:r}=t,a={component:e,container:s,persist:i,parent:r};this.controller=new tn(this,a)}resume(t){let e=this.controller;e&&(e.container=t)}setPath(t,e){this.path=t,this.referralPath=e}select(){this.set("active",!0);let t=this.stage,e=this.callBack;typeof e=="function"&&e(t);let s=this.controller;s&&s.focus(t);let i=this.path;if(!i)return;let r=i.split("#")[1];!r||this.scrollToId(r)}scrollToId(t){if(!t)return;let e=document.getElementById(t);!e||e.scrollIntoView(!0)}match(t){let e=!1,s=t.match(this.uriQuery);return s===null?(this.resetParams(),e):(Array.isArray(s)&&(s.shift(),e=s,this.setParams(s)),e)}resetParams(){this.stage={}}setParams(t){if(!Array.isArray(t))return;let e=this.paramKeys;if(!e)return;let s={};e.forEach((i,r)=>{typeof i<"u"&&(s[i]=t[r])}),this.set(s)}getParams(){return this.stage}},dn=t=>{let e=/\w\S*/;return t.replace(e,s=>s.charAt(0).toUpperCase()+s.substring(1).toLowerCase())},pn=(t,e)=>{if(t.indexOf(":")===-1)return t;let s=e.stage;for(let[i,r]of Object.entries(s)){let a=new RegExp(":"+i,"gi");t=t.replace(a,r)}return t},fn=(t,e,s)=>e&&(typeof e=="function"&&(e=e(t.stage)),e=pn(e,t),e=dn(e),s!==""&&(e+=" - "+s),e),gn={removeSlashes(t){return typeof t!="string"?"":(t.substring(0,1)==="/"&&(t=t.substring(1)),t.substring(-1)==="/"&&(t=t.substring(0,t.length-1)),t)}};x.addType("routes",t=>{if(!t)return!1;let e=t.route;e&&wt.removeRoute(e)});x.addType("switch",t=>{if(!t)return!1;let e=t.id;wt.removeSwitch(e)});var mn=class{constructor(){this.version="1.0.2",this.baseURI="/",this.title="",this.lastPath=null,this.path=null,this.history=null,this.callBackLink=null,this.location=window.location,this.routes=[],this.switches={},this.switchCount=0,this.data=new Jt({path:""})}setupHistory(){this.history=Za.setup(this)}createRoute(t){let e=t.uri||"*";return t.baseUri=this.createURI(e),new un(t,this.updateTitle.bind(this))}add(t){if(typeof t!="object"){let s=arguments;t={uri:s[0],component:s[1],callBack:s[2],title:s[3],id:s[4],container:s[5]}}let e=this.createRoute(t);return this.addRoute(e),e}addRoute(t){this.routes.push(t),this.checkRoute(t,this.getPath())}resume(t,e){t.resume(e),this.addRoute(t)}getBasePath(){if(!this.basePath){let t=this.baseURI||"";t[t.length-1]!=="/"&&(t+="/"),this.basePath=t}return this.basePath}createURI(t){return this.getBasePath()+gn.removeSlashes(t)}getRoute(t){let e=this.routes,s=e.length;if(s>0)for(var i=0;i<s;i++){var r=e[i];if(r.uri===t)return r}return!1}getRouteById(t){let e=this.routes,s=e.length;if(s>0)for(var i=0;i<s;i++){var r=e[i];if(r.id===t)return r}return!1}removeRoute(t){let e=this.routes,s=e.indexOf(t);s>-1&&e.splice(s,1)}addSwitch(t){let e=this.switchCount++,s=this.getSwitchGroup(e);return t.forEach(i=>{let r=this.createRoute(i);s.push(r)}),this.checkGroup(s,this.getPath()),e}resumeSwitch(t,e){let s=this.switchCount++,i=this.getSwitchGroup(s);return t.forEach(r=>{let a=r.component.route;a.resume(e),i.push(a)}),this.checkGroup(i,this.getPath()),s}getSwitchGroup(t){return this.switches[t]=[]}removeSwitch(t){let e=this.switches;e[t]&&delete e[t]}remove(t){t=this.createURI(t);let e=this.getRoute(t);return e!==!1&&this.removeRoute(e),this}setup(t,e){this.baseURI=t||"/",this.updateBaseTag(this.baseURI),this.title=typeof e<"u"?e:"",this.setupHistory(),this.data.path=this.getPath(),this.callBackLink=this.checkLink.bind(this),b.on("click",document,this.callBackLink);let s=this.getEndPoint();return this.navigate(s,null,!0),this}updateBaseTag(t){let e=document.getElementsByTagName("base");e.length&&(e[0].href=t)}getParentLink(t){let e=t.parentNode;for(;e!==null;){if(e.nodeName.toLowerCase()==="a")return e;e=e.parentNode}return!1}checkLink(t){if(t.ctrlKey===!0)return!0;let e=t.target||t.srcElement;if(e.nodeName.toLowerCase()!=="a"&&(e=this.getParentLink(e),e===!1)||e.target==="_blank"||j.data(e,"cancel-route"))return!0;let s=e.getAttribute("href");if(typeof s<"u"){let i=this.baseURI,r=i!=="/"?s.replace(i,""):s;return this.navigate(r),t.preventDefault(),t.stopPropagation(),!1}}reset(){return this.routes=[],this.switches=[],this.switchCount=0,this}activate(){return this.checkActiveRoutes(),this}navigate(t,e,s){return t=this.createURI(t),this.history.addState(t,e,s),this.activate(),this}updatePath(){let t=this.getPath();this.data.path=t}updateTitle(t){if(!t||!t.title)return this;let e=t.title;document.title=fn(t,e,this.title)}checkActiveRoutes(t){this.lastPath=this.path,t=t||this.getPath(),this.path=t;let e=this.routes,s=e.length,i;for(var r=0;r<s;r++)i=e[r],!(typeof i>"u")&&this.checkRoute(i,t);this.checkSwitches(t),this.updatePath()}checkSwitches(t){let e=this.switches;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var i=e[s];this.checkGroup(i,t)}}checkGroup(t,e){let s=!1,i,r,a,n,l=!1;for(var o=0,c=t.length;o<c;o++)if(i=t[o],!(typeof i>"u")){if(o===0&&(r=i),!a&&i.get("active")&&(a=i),s!==!1){l&&i.deactivate();continue}s=i.match(e),s!==!1&&(n=i,i.controller&&(this.select(i),l=!0))}if(n===void 0){this.select(r),a&&r!==a&&a.deactivate();return}a?l&&n!==a&&a.deactivate():r&&l===!1&&this.select(r)}checkRoute(t,e){let s=this.check(t,e);return s!==!1?this.select(t):t.deactivate(),s}check(t,e){return t?(e=e||this.getPath(),t.match(e)!==!1):!1}select(t){!t||(t.setPath(this.path,this.lastPath),t.select(),this.updateTitle(t))}getEndPoint(){return this.getPath().replace(this.baseURI,"")||"/"}destroy(){b.off("click",document,this.callBackLink)}getPath(){let t=this.location,e=this.path=t.pathname;return this.history.type==="hash"?t.hash.replace("#",""):e+t.search+t.hash}},wt=new mn,vn=(t,e,s)=>{!e||(Array.isArray(e)?e.forEach(i=>{we(t,i,s)}):we(t,e,s))},we=(t,e,s)=>{e.container=t,e.parent=s;let i=wt.add(e);yn(t,i)},yn=(t,e)=>{x.add(t,"routes",{route:e})},bn=(t,e,s)=>{e[0],e.forEach(r=>{r.container=t,r.parent=s});let i=wt.addSwitch(e);wn(t,i)},wn=(t,e)=>{x.add(t,"switch",{id:e})};Nt.add("cache",Na).add("onCreated",Xa).add("onDestroyed",qa).add("bind",Wa).add("onSet",ps).add("onState",Ya).add("watch",Ga).add("useParent",_a).add("useData",Ma).add("useState",za).add("addState",Fa).add("map",Ua).add("for",Ha).add("useContext",Ra).add("addContext",$a).add("context",Ia).add("role",ja).add("aria",Da).add("route",vn).add("switch",bn);st.augment({Ajax:Ye,Html:it,dataBinder:_,Data:Jt,SimpleData:Qt,Model:ls,State:lt,Builder:M,router:wt,Component:cs});var w=(t,e)=>({...t,children:e}),h=v((t,e)=>w(t,e)),kn=v((t,e)=>w({...t,tag:"dialog"},e)),R=v((t,e)=>w({...t,tag:"span"},e)),X=v((t,e)=>w({...t,tag:"p"},e)),rt=v((t,e)=>w({...t,tag:"a"},e)),Z=v((t,e)=>w({...t,tag:"button"},e)),gs=v((t,e)=>w({...t,tag:"ul"},e)),ms=v((t,e)=>w({...t,tag:"li"},e)),$=v(t=>w({...t,tag:"img"},null)),tt=v((t,e)=>w({...t,tag:"h2"},e)),Sn=v(t=>w({...t,tag:"input"},null)),G=v((t,e)=>w({...t,tag:"label"},e)),Pn=v(t=>Sn({...t,type:"checkbox"})),k=v((t,e)=>w({...t,tag:"section"},e)),ct=v((t,e)=>w({...t,tag:"article"},e)),T=v((t,e)=>w({...t,tag:"header"},e)),xn=v((t,e)=>w({...t,tag:"footer"},e)),Cn=v((t,e)=>w({...t,tag:"nav"},e)),An=v((t,e)=>w({...t,tag:"main"},e)),Ln=v((t,e)=>w({...t,tag:"audio"},e)),Tn=v((t,e)=>w({...t,tag:"canvas"},e));const C=J.add("settings"),En="settings";C.setKey(En);const On={audio:!1,music:!1,graphics:"medium",song:"play-loop.mp3"};C.resume(On);class jn extends B{render(){return Ln({src:this.getFilePath(),loop:!0})}getFilePath(){return"sound/music/"+this.fileName}change(e){this.fileName!==e&&(this.fileName=e,this.panel.src=this.getFilePath(),this.state.music===!0&&this.start())}afterSetup(){C.music===!0&&this.start()}setupStates(){return{remotes:[{id:"settings",music:{callBack:e=>{!this.panel||(e===!0?this.start():this.stop())}},song:{callBack:e=>{!this.panel||this.change(e)}}}]}}start(){const e=this.panel;e.volume=.6,e.play()}stop(){this.panel.pause()}}const Bn=()=>typeof window.localStorage<"u",kt=Bn(),vs={storage:null,setup(){return kt===!0&&(this.storage=window.localStorage),this},get(t){if(kt===!1)return null;const e=this.storage.getItem(t);if(typeof e<"u")return JSON.parse(e)},set(t,e){kt===!0&&(e=JSON.stringify(e),this.storage.setItem(t,e))},clear(){kt===!0&&this.storage.clear()}}.setup(),S={currentLevel:null,activeLevels:[],controller:null,packs:[],activePack:null,game:null,setGame(t){this.game=t},setupActivePack(){this.packs.length>0&&(this.activePack=this.packs[0],this.activeLevels=this.activePack.setupLevels())},addLevelPack(t){this.packs.push(t)},setup(){this.setupActivePack()},selectPrimaryLevel(){const t=this.getPrimaryLevel();this.setLevel(t)},getPrimaryLevel(){const t=vs.get("lastLevel");return t?this.activeLevels[t.number-1]:this.getFirstUnlockedLevels()},getFirstUnlockedLevels(){const t=this.activeLevels;let e=!1;for(let s=0,i=t.length;s<i;s++){let r=t[s];if(r.locked===!0){if(e)return e}else if(s===i-1)return r;e=r}return t[0]},getLevelByNumber(t){const e=this.activeLevels;for(let s=0,i=e.length;s<i;s++){let r=e[s];if(t===r.level)return r}return!1},selectLevel(t,e){!t||(this.setPreviousLevel(),this.setLevel(t,e))},setLevel(t,e){const s=this.activePack;this.game.setStageLevelController(s.controller),this.currentLevel=t,s.setLevel(t,e)},setPreviousLevel(){this.currentLevel&&this.lastSelectedLevel!==this.currentLevel&&(this.lastSelectedLevel=this.currentLevel)},unlockNextLevel(){const t=this.getNextLevel();t&&t.unlock()},isNextLevelLocked(){const t=this.getNextLevel();return t?t.locked:!0},retryLevel(){this.currentLevel&&(this.currentLevel.reset(),this.selectLevel(this.currentLevel,!0))},getNextLevel(){const t=this.activeLevels;let e=this.currentLevel?t.indexOf(this.currentLevel):0;const s=e<t.length-1?++e:0;return t[s]},selectNextLevel(){const t=this.getNextLevel();t&&this.selectLevel(t)},levelSummary(){this.activePack.levelSummary()},getPreviousLevel(){const t=this.activeLevels;let e=this.currentLevel?t.indexOf(this.currentLevel):0;const s=e>0?--e:t.length-1;return t[s]},selectPreviousLevel(){const t=this.getPreviousLevel();t&&this.selectLevel(t)}},Dn=(t,e)=>ms({class:"option title-text",click:(s,i)=>i.moveToSelectedElement(s.target)},t);class ys extends B{constructor(){super(...arguments);g(this,"posX",0)}onCreated(){this.viewNumber=null,this.optionsArray=[],this.selection=null,this.index=0,this.moveX=0,this.startX=0,this.contact=!1}render(){return T({class:"title-container"},[gs({cache:"navContainer",class:"option-container",...this.getEvents(),map:[this.items,Dn]})])}getEvents(){const s=this.start.bind(this),i=this.move.bind(this),r=this.end.bind(this);return{touchstart:s,mousedown:s,touchmove:i,mousemove:i,touchend:r,mouseup:r,mouseout:r}}setupEvents(){const s=this.resize.bind(this);return[["resize",window,s]]}afterSetup(){this.getOptions(),this.reset(),window.setTimeout(()=>this.resize(),10)}selectPrimaryStep(){const s=this.optionsArray[0];s&&this.moveToSelectedOption(s)}reset(){this.selectPrimaryStep()}getParentWidth(){if(this.panel){const s=this.panel.getBoundingClientRect();this.parentWidth=s.width}}getOptions(){let s=this.navContainer.querySelectorAll(".option");if(!s)return[];s=[].slice.call(s);const i=s.map((r,a)=>({element:r,index:a}));this.optionsArray=i,this.getParentWidth()}moveToSelectedElement(s){if(!s)return;let i=this.getOptionByElement(s);i&&this.moveToSelectedOption(i)}moveToSelectedOption(s){s&&(this.selectOption(s),this.moveToElement(s.element))}moveToSelectedIndex(s){let i=this.optionsArray[s];i&&(this.selectOption(i,!0),this.moveToElement(i.element))}selectOptionByIndex(s){let i=this.optionsArray;for(let r=0,a=i.length;r<a;r++){let n=i[r];r===s&&this.selectOption(n)}return!1}getOptionByElement(s){let i=this.optionsArray;for(let r=0,a=i.length;r<a;r++){let n=i[r];if(n.element===s)return n}return!1}selectPrimaryOption(){let s=this.optionsArray[0];s&&this.selectOption(s)}selectOption(s,i){!s||s.selected===!0||(this.selection=s,s.element.classList.add("selected"),s.selected=!0,this.updateSelectOption(s),typeof this.callBackFn=="function"&&i!==!0&&this.callBackFn(s.index))}updateSelectOption(s){let i=this.optionsArray;for(let r=0,a=i.length;r<a;r++){let n=i[r];n.crumb,n!==s&&(n.element.classList.remove("selected"),n.selected=!1)}}resize(){this.getParentWidth(),this.selection&&this.moveToElement(this.selection.element)}getEventX(s){let i=0;return s&&(s.touches?i=s.touches[0].pageX:i=s.clientX||s.pageX),i}start(s){this.navContainer.classList.add("active"),this.getParentWidth(),this.contact=!0,this.startX=this.getEventX(s)-this.posX,this.move(s)}move(s){if(this.contact===!1)return!1;let i=this.getEventX(s);this.moveX=this.startX-i,this.moveX=this.moveX*-1,this.moveContainer(this.moveX),this.checkSelectedElement()}moveContainer(s){this.posX=s,this.navContainer.style.transform="translate3d("+s+"px,0,0)"}checkSelectedElement(){let s=this.parentWidth/2,i=this.optionsArray;for(let r=0,a=i.length;r<a;r++){let n=i[r];n&&this.contains(n.element,s,10)===!0&&this.selectOption(n)}}moveToElement(s){let i=this.parentWidth/2,r=s.getBoundingClientRect(),a=i-s.offsetLeft-r.width/2;this.moveContainer(a)}getElementOffset(s){let i=s.getBoundingClientRect();return{x:this.posX+s.offsetLeft,y:s.offsetTop,width:i.width,height:i.height}}contains(s,i,r){let a=this.getElementOffset(s);return a.x<=i&&a.x+a.width>=i&&a.y<=r&&a.y+a.height>=r}end(s){if(this.contact===!0){this.navContainer.classList.remove("active"),this.contact=!1,this.parentWidth/2;let i=this.selection.element;this.moveToElement(i)}}}class Ct{static getEventPosition(e){const s={x:0,y:0};if(e){const i=e.touches;if(i){const r=i[0];s.x=r.pageX,s.y=r.pageY}else s.x=e.clientX||e.pageX,s.y=e.clientY||e.pageY}return s}static calculateAngle(){const e=this.startX-this.moveX,s=this.moveY-this.startY,i=Math.atan2(s,e);let r=Math.round(i*180/Math.PI);return r<0&&(r=360-Math.abs(r)),r}static getSwipeDirection(e){let s;return e<=45&&e>=0||e<=360&&e>=315?s="left":e>=135&&e<=225?s="right":e>45&&e<135?s="down":s="up",s}static isLeftRight(){const e=this.calculateAngle(),s=this.getSwipeDirection(e);return s==="left"||s==="right"}}const bs="step",In=(t,e)=>k({class:bs},[t]),Rn=(t,e)=>h({...t,class:"option",onState:["index",{selected:e}],cick:(s,i)=>i.moveToSelectedIndex(e)}),$n=Wt((t,e)=>h({class:"crumb-container"},[h({...t,class:"number-crumb-container"},e)]));class ie extends B{constructor(){super(...arguments);g(this,"canMove",null)}onCreated(){this.viewNumber=null,this.steps=[],this.index=0,this.stepWidth=null,this.minimum=72,this.moveX=0,this.startX=0,this.moveY=0,this.startY=0,this.contact=!1,this.preventTouch=!1,this.preventScroll=!1}render(){return ct({class:"touch-slider step-container"},[h({cache:"slider",class:"step-slider-container",...this.getEvents(),map:[this.items,In]}),$n({map:[this.items,Rn]})])}setupStates(){return{index:this.index}}getEvents(){const s=this.start.bind(this),i=this.move.bind(this),r=this.end.bind(this);return{touchstart:s,mousedown:s,touchmove:i,mousemove:i,touchend:r,mouseup:r,mouseout:r}}setupEvents(){const s=this.getStepWidth.bind(this);return[["resize",window,s]]}afterSetup(){this.getSteps(),this.selectPrimaryStep()}getSteps(){let s=this.slider.querySelectorAll("."+bs);if(!s)return[];s=[].slice.call(s);const i=s.map((r,a)=>({ele:r,index:a}));this.steps=i,this.getStepWidth()}moveToSelectedElement(s){if(!s)return;const i=this.getStepByElement(s);i&&this.moveToSelectedStep(i)}moveToSelectedStep(s){if(!s)return;this.getStepWidth();const i=this.stepWidth*s.index;this.moveContainer("-"+i),this.index=s.index,this.state.index=s.index,this.selectStep(s)}moveToSelectedIndex(s){const i=this.steps[s];if(!i)return;this.getStepWidth();const r=this.stepWidth*i.index;this.moveContainer("-"+r),this.index=i.index,this.state.index=i.index,this.selectStep(i,!0)}selectStepByIndex(s){const i=this.steps;for(let r=0,a=i.length;r<a;r++){const n=i[r];if(r===s)return this.selectStep(n),!0}return!1}getStepByElement(s){const i=this.steps;for(let r=0,a=i.length;r<a;r++){const n=i[r];if(n.ele===s)return n}return!1}selectPrimaryStep(){const s=this.steps[0];s&&this.selectStep(s)}selectStep(s,i){!s||(s.ele.classList.add("active"),this.updateSelectStep(s),typeof this.callBackFn=="function"&&i!==!0&&this.callBackFn(s.index))}updateSelectStep(s){const i=this.steps;for(let r=0,a=i.length;r<a;r++){const n=i[r],l=n.crumb,o=n!==s;o&&n.ele.classList.remove("active"),l&&(l.className=o?"option circle selected":"option circle")}}getStepWidth(){const s=this.steps;if(!s)return;let i;if(this.viewNumber===null)i=s[0].ele.offsetWidth;else{const r=this.slider.offsetWidth;i=this.stepWidth=r/this.viewNumber;let a;for(let n=0,l=s.length;n<l;n++)a=s[n],a&&(a.style.width=i+"px");i=this.stepWidth=r/this.viewNumber}this.stepWidth=i}shouldMove(){return this.canMove===null&&(this.canMove=Ct.isLeftRight()),this.canMove}start(s){this.preventTouch,this.slider.classList.add("active"),this.getStepWidth(),this.contact=!0;const i=Ct.getEventPosition(s);this.startX=i.x,this.startY=i.y,this.move(s)}move(s){if(this.preventTouch!==!1||this.contact===!1)return!1;const i=Ct.getEventPosition(s);let r=i.x;if(this.moveX=this.index*this.stepWidth+(this.startX-r),this.moveY=i.y,Math.abs(this.moveX)<=this.minimum)return!1;this.shouldMove(),this.moveX=this.moveX*-1,this.moveContainer(this.moveX)}moveContainer(s){this.slider.style.transform="translate3d("+s+"px,0,0)"}end(s){if(this.contact===!0){if(this.slider.classList.remove("active"),this.contact=!1,this.moveX<=0){const i=Math.abs(this.index*this.stepWidth-this.moveX);this.moveX=Math.abs(this.moveX),i>this.stepWidth/3&&(this.moveX>this.index*this.stepWidth&&this.index<this.steps.length-1?this.index++:this.moveX<this.index*this.stepWidth&&this.index>0&&this.index--),this.selectStepByIndex(this.index)}this.moveContainer("-"+this.index*this.stepWidth)}this.state.index=this.index,this.canMove=null,this.preventTouch=!1}}class ut extends B{render(){return this.children[0]}update(e){}}function Nn(t){this.parent.nav&&this.parent.nav.moveToSelectedIndex(t)}function _n(t){this.parent.touch&&this.parent.touch.moveToSelectedIndex(t)}const Mn=t=>{let e=t.locked===!1?" unlocked":"";return t===S.currentLevel&&(e+=" selected"),"bttn option circle fadeIn"+e},zn=t=>{const e=Mn(t);return Z({class:e,click:(s,{parent:i})=>!t.locked&&i.game.selectLevel(t)},[h({class:"content"},String(t.number))])},Fn=({game:t})=>new ut({game:t},[ct({class:"control-sub-panel level-select-container overlay-panel"},[k({class:"home-sub-panel level-select-panel"},[h({class:"panel-top-button-container floatUpZBounce"},[rt({class:"bttn circle close",href:"/"},[h({class:"content"},[R(),R()])])]),new ys({cache:"nav",callBackFn:_n,items:["Level Select"]}),h({class:"main-step-container"},[new ie({cache:"touch",callBackFn:Nn,items:[h({class:"content",map:[S.activeLevels,zn]})]})])])])]);class Wn extends B{onCreated(){var e;(e=this.duration)!=null||(this.duration=4e3),this.timer=null}render(){return h({class:`flash-panel dropInBounce ${this.type}`},[xn({class:"button-container"},[Z({class:"bttn circle close",onclick:()=>this.destroy()},[h({class:"content"},[R(),R()])])]),h({class:"icon-container"}),T({class:"title-container"},[h({class:"title left dark"},this.title),h({class:"description center dark"},this.description)])])}afterSetup(){this.timer=setTimeout(()=>this.destroy(),this.duration)}start(e){D.render(this,e)}}const vt=Math.PI*2,Hn=180/Math.PI,Un=Math.PI/180,m={randomFromTo(t,e,s){return s=typeof s<"u"?!0:s,s?Math.floor(Math.random()*(e-t+1)+t):Math.random()*(e-t+1)+t},arc:vt,checkCircluarCollision(t,e,s,i,r,a){const n=t-i,l=e-r;return n*n+l*l<=(s+a)*(s+a)},getOrbitPosition(t,e,s,i){let r=Math;return{x:t+r.cos(s)*i,y:e+r.sin(s)*i}},updateOrbitAngle(t,e,s){return s=typeof s>"u"?!0:s,s?t+e:t-e},getBezierCurve(t,e,s,i,r){let a=r,n=3(e.x-t.x),l=3(s.x-e.x)-n,o=i.x-t.x-n-l,c=3(e.y-t.y),u=3(s.y-e.y),f=i.y-t.y-c-u;o*(a*a*a)+l*(a*a)+n*a+t.x,f*(a*a*a)+u*(a*a)+c*a+t.y},spiral(t,e){return t+e},degreesPI:Hn,getDegrees(t){return t*this.degreesPI},radiansPI:Un,getRadians(t){return t*this.radiansPI},getSlope(t,e,s,i){let r=t-s;return(e-i)/r},getAngle(t,e,s,i){const r=t-s,a=e-i,n=Math.atan2(a,r);return this.getDegrees(n)},getPositionByAngle(t,e){const s=this.getRadians(t);return{x:Math.cos(s)*e,y:Math.sin(s)*e}},getDistance(t,e,s,i){const r=t-s,a=e-i;return Math.sqrt(r*r+a*a)},getNextPosition(t,e,s,i,r){const a=this.getDistance(t,e,s,i),n=this.getMovementBySpeed(a,r);return{x:(s-t)/n,y:(i-e)/n}},distance(t,e){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},getMovementBySpeed(t,e){return t/e},round(t){return~~(.5+t)},floor(t){return~~t}},ws={options:[],messages:{awful:[],bad:[],good:[],close:[],great:[]},reset(){this.options=[]},setup(){const t=this.messages,e=(s,i,r)=>{const a={title:i,text:r};t[s].push(a)};e("awful","Whaaaa?","Let's just pretend this didn't happen..."),e("awful","Umm...","I've stopped watching already. Let's try again"),e("awful","Uhhh...","Houston, we have a problem"),e("awful","Achievement unlocked (not really)","Being this bad has to be rewarded..."),e("awful","Maybe next time...","Just click retry and don't look back"),e("bad","Brah","It's like you weren't even looking at the screen"),e("bad","Bad you did","These are not the scores you are looking for"),e("bad","Someone once told me","Just keep trying. Just keep trying."),e("bad","Yikes","You should try searching for the Konami Code"),e("bad","Like a car in a hotel room...",'You just wonder "How did this happen?"'),e("close","Almost","So close yet so far away!"),e("close","This level is even more difficult than...","That time I tried to be Batman"),e("close","There has got to be","A skip button around here somewhere"),e("close","You will beat it..","Eggs or batter maybe... but this level not likely."),e("good","Done and done!","You must have studied winning in college"),e("good","Another one bites the dust","Keep up the good work!"),e("good","Impressive","Your efforts are rewarded"),e("good","Are you a torch?","Because you are on fire!"),e("good","Crank it up",'Someone must have turned you to "eleven"'),e("good","Ahhh","You complete me"),e("good","You are more dedicated than...","A hobbit with a gold ring!"),e("good","Good job","That'll do, Player. That'll do"),e("good","Tears of joy","You make me so proud sometimes!"),e("great","New high score!","Practice does make perfect"),e("great","Living legend","Nobody will beat that score!"),e("great","Cat like reflexes","You must be a ninja!"),e("great","You are","King of the world!")},getRandomMessage(t){const e=this.messages[t];if(!e)return;const s=e.length,i=m.round(Math.random()*(s-1)),r=e[i];return r.type=t,r},getAll(){return this.options},removeAll(){let t=this.options,e=t.length;if(e)for(let s=0;s<e;s++){let i=t[s];this.remove(i)}},remove(t){const e=this.options,s=e.indexOf(t);s>-1&&(t.remove(),e.splice(s,1))}};ws.setup();const Xn=t=>{let e;if(t.scorePoints>t.highScorePoints&&t.scoreNumber>=t.minimum?e="great":t.scoreNumber>=t.minimum?e="good":t.scoreNumber>=t.minimum-4&&t.scoreNumber<=t.minimum-1?e="close":t.scoreNumber==0?e="awful":t.scoreNumber<=m.round(t.minimum*.25)&&(e="bad"),e)return qn(e)},qn=t=>ws.getRandomMessage(t);class ks{constructor(e,s){this.timer=null,this.duration=e,this.callback=s}setupTimer(){this.timer=window.setTimeout(()=>this.callCallback(),this.duration)}start(){this.stop(),this.setupTimer()}stop(){window.clearTimeout(this.timer)}callCallback(){typeof this.callback=="function"&&this.callback()}}function Vn(){const t=this.game.getCurrentLevel();this.data=t.data,this.data.nextLevel=t.passed||!S.isNextLevelLocked(),this.data.previousLevel=t.number>1}function Yn(){const t=this.game.getCurrentLevel();t.number<S.activeLevels.length&&(t.passed&&S.unlockNextLevel(),this.state.nextLevel=t.passed||S.isNextLevelLocked());const e=Xn(t);e&&new ks(500,()=>{new Wn({type:e.type,title:e.title,description:e.text}).start(this.panel)}).start()}function Gn(){const t=this.game.getCurrentLevel(),{number:e,passed:s,highScorePoints:i,highScoreNumber:r,particles:a,scoreNumber:n,scorePoints:l,minimum:o,quantity:c}=t;return{number:e,passed:s,highScorePoints:i,highScoreNumber:r,particles:a,scoreNumber:n,scorePoints:l,minimum:o,quantity:c,nextLevel:!1,previousLevel:e>1}}const Ss=({game:t})=>new ut({game:t,beforeSetup:Vn,afterSetup:Yn,setupStates:Gn},[h({class:"level-summary-container overlay-panel floatDownZ"},[h({class:"panel-top-button-container"},[rt({class:"bttn circle bttn-home",href:"/"},[h({class:"content"})])]),k({class:"col data-container"},[h({class:"level-summary"},[h({class:"row"},[h({class:"level-number-container pullDown"},[h({class:"level-number title-text"},"[[number]]"),h({class:"level-label title-text"},"Level")]),h({id:"summaryLevelStatus",class:"level-status title-enhance",onSet:["passed",e=>e?"Congrats, You Passed":"Sorry, Try Again"]}),h({class:"destroyed-summary",onSet:["passed",{pass:!0,fail:!1}]},[h({class:"destroyed"},[h({class:"label title-text"},"Particle Total"),h({class:"value"},"[[quantity]]"),h({class:"label title-text"},"Destroyed"),h({class:"value"},"[[scoreNumber]]")])])]),h({class:"row"},[h({class:"score-container"},[h({class:"score-panel"},[h({class:"col"},[h({class:"data underline"},[h({class:"value title-text"},"[[minimum]]"),h({class:"label title-enhance"},"Minimum")])]),h({class:"col"},[h({class:"data circle level-score"},[h({class:"content"},[h({class:"value title-text"},"[[scorePoints]]"),h({class:"label title-enhance"},"Level Score")])])]),h({class:"col"},[h({class:"data high-score underline"},[h({class:"value title-text"},"[[highScorePoints]]"),h({class:"label title-enhance"},"Highest Score")])])])])]),h({class:"row summary-button-container"},[h({class:"summary-buttons"},[h({class:"col"},[k({class:"option-group",id:"previous_level"},[h({class:"bttn circle bttn-prev",onSet:["previousLevel",{hidden:!1}],click:()=>t.previousLevel()},[h({class:"content"})]),h({class:"label title-text"},"Previous")])]),h({class:"col"},[k({class:"option-group",id:"retry_level"},[h({class:"bttn circle bttn-retry",click:()=>t.retryLevel()},[h({class:"content"})]),h({class:"label title-text"},"Retry")])]),h({class:"col"},[k({class:"option-group",id:"next_level"},[h({class:"bttn circle bttn-next",onSet:["nextLevel",{hidden:!1}],click:()=>t.nextLevel()},[h({class:"content"})]),h({class:"label title-text"},"Next")])])])])])])])]);function Kn(){this.game.stopStage()}const Jn=({game:t})=>new ut({game:t,afterSetup:Kn},[h({class:"control-sub-panel pause-container overlay-panel"},[h({class:"pause-panel floatDownZ"},[Z({class:"play circle",click:()=>t.resume()},[h({class:"content"})])]),ct({class:"options-container fadeIn"},[k({class:"option-group"},[rt({class:"bttn circle bttn-home",href:"/"},[h({class:"content"})]),h({class:"label title-text"},"Home")]),k({class:"option-group"},[rt({class:"bttn circle bttn-levels",href:"/levels"},[h({class:"content"})]),h({class:"label title-text"},"Levels")]),k({class:"option-group"},[h({class:"bttn circle bttn-retry",click:()=>t.retryLevel()},[h({class:"content"})]),h({class:"label title-text"},"Retry")])])])]);class Qn{constructor(e,s){this.options=e,this.callBack=s,this.selection=null}get(e){return this.options[e]||!1}getSelectedIndex(){return typeof this.selectedIndex<"u"?this.selectedIndex:0}next(){let e=this.getSelectedIndex();const s=e<this.options.length-1?++e:0;return this.select(s)}previous(){let e=this.getSelectedIndex();const s=e>0?--e:this.options.length-1;return this.select(s)}select(e){const s=this.get(e);return s!==!1&&(this.selection=s,this.selectedIndex=e,this.callBack&&this.callBack(s)),s}selectOption(e){const s=this.options.indexOf(e);return s>-1&&(e=this.select(s)),e}}class Zn extends B{onCreated(){this.iterator=new Qn(this.options,this.change.bind(this)),this.iterator.selectOption(this.data[this.dataProp])}render(){return h({class:"value-container"},[Z({class:"value-button arrow prev",click:this.previous.bind(this)}),Z({class:"value-button",click:this.next.bind(this)},"[["+this.dataProp+"]]"),Z({class:"value-button arrow next",click:this.next.bind(this)})])}change(e){this.data.set(this.dataProp,e),this.data.store()}next(){this.iterator.next()}previous(){this.iterator.previous()}}class ke extends B{render(){const e=this.getId("checkbox");return h({class:"data-toggle-panel"},[Pn({id:e,cache:"checkbox",class:"toggle",change:this.change.bind(this),checked:this.checked}),G({class:"toggle-bttn",htmlFor:e})])}isChecked(e){return this.checkbox.checked}change(){this.checked=this.isChecked(),this.callBack&&this.callBack(this.checked)}toggle(){const e=this.isChecked();this.checkbox.checked=!e}}class tl extends ut{}function el(t){this.parent.nav&&this.parent.nav.moveToSelectedIndex(t)}function sl(t){this.parent.touch&&this.parent.touch.moveToSelectedIndex(t)}const il=()=>new tl([ct({class:"control-sub-panel settings-container overlay-panel open"},[k({class:"home-sub-panel settings-panel"},[h({class:"panel-top-button-container floatUpZBounce"},[rt({class:"bttn circle close",href:"/"},[h({class:"content"},[R(),R()])])]),new ys({cache:"nav",callBackFn:sl,items:["audio","video","about"]}),h({class:"main-step-container"},[new ie({cache:"touch",callBackFn:el,items:[h({class:"content settings-sub-panel audio-container"},[T({class:"title-text"},"Audio"),h({class:"row"},[G({class:"title"},"Music"),h({class:"value-container"},[new ke({checked:C.music,callBack:t=>{C.music=Boolean(t),C.store()}})])]),h({class:"row"},[G({class:"title"},"Sound fx"),h({class:"value-container"},[new ke({checked:C.audio,callBack:t=>{C.audio=Boolean(t),C.store()}})])])]),h({class:"content settings-sub-panel audio-container"},[T({class:"title-text"},"Video"),h({class:"row"},[G({class:"title"},"Graphics"),new Zn({data:C,dataProp:"graphics",options:["low","medium","high"]})])]),h({class:"content settings-sub-panel about-container"},[T({class:"title-text"},"Credits"),h({class:"row"},[G({class:"title"},"Programming"),h({class:"value-container"},"Chris Durfee")]),h({class:"row"},[G({class:"title"},"Graphic Design"),h({class:"value-container"},"Chelsea Durfee")]),h({class:"row"},[G({class:"title"},"Music & Sound"),h({class:"value-container"},"Chris Durfee")])])]})])])])]);function rl(){window.setTimeout(()=>{this.panel.classList.remove("loading")},300)}const al=({game:t})=>new ut({afterSetup:rl},[k({class:"main-home-panel overlay-panel loading"},[h({class:"background background-stars"}),h({class:"panel-top-button-container"},[rt({class:"bttn circle settings",href:"/settings"},[h({class:"content"})])]),ct({class:"home-base-panel"},[h({class:"row logo-container"},[h({class:"background background-mask"}),h({class:"game-name-container"},[$({src:"images/multisplode.svg"})])]),h({class:"row menu-container"},[k({class:"col main-menu-container clear"},[h({class:"game-menu-container"},[h({class:"main-nav-container"},[Cn([gs({class:"clear"},[ms([Z({class:"bttn main-play title-text",click:()=>t.startGame()},"Play")])])])])])])])])])]);class nl extends B{beforeSetup(){const e=this.game.getCurrentLevel();this.data=e.data,this.length=0,this.progress=0}render(){return h({class:"progress-bar",onSet:["scoreNumber",e=>this.update(e,this.data.minimum)],html:`<svg id="level-progress-image" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 83.2 83.6" width="83px" height="83px">
		<style>
		  .progress-bg{opacity:0.2;fill:#FFFFFF;stroke-width:0px;enable-background:new ;} .progress{fill:none;stroke:#FF4881;stroke-width:4;stroke-miterlimit:10;}
		</style>
		<path class="progress-bg" d="M74.7 21L62.2 8.5C50.9-2.8 32.3-2.8 21 8.5L8.5 21c-11.3 11.3-11.3 29.9 0 41.2L21 74.7C32.3 86 50.9 86 62.2 74.7l12.5-12.5C86 50.9 86 32.3 74.7 21zm-3.3 39.1L60.1 71.4c-10.2 10.2-26.9 10.2-37.1 0L11.8 60.1C1.6 49.9 1.6 33.2 11.8 23L23 11.8c10.2-10.2 26.9-10.2 37.1 0L71.4 23c10.2 10.2 10.2 26.9 0 37.1z"/>
		<path id="progress-line" class="progress" d="M60.82 72.582c-10.606 10.605-27.968 10.605-38.572 0L10.603 60.834c-10.605-10.605-10.605-27.967 0-38.57l11.644-11.645C32.852.013 50.214.013 60.817 10.62l11.75 11.643c10.604 10.605 10.604 27.967 0 38.57l-11.748 11.75"/>
	  </svg>`})}afterSetup(){window.setTimeout(()=>{const s=this.element=document.getElementById("progress-line"),i=this.length=s.getTotalLength();s.style.strokeDasharray=i+" "+i,this.changeStrokeOffset(i),window.setTimeout(()=>{this.reset()},150)},10)}modifyTransition(e){this.element.style.transition="stroke-dashoffset "+e+"ms linear"}update(e,s){let i=e/s*100/100;if(i=i<1?i.toFixed(2):1,i===1&&this.progress!==i||i!==this.progress){const r=this.length,a=r-r*i;this.changeStrokeOffset(a),this.progress=i}}changeStrokeOffset(e){!this.element||(this.element.style.strokeDashoffset=e)}reset(){const e=this.length;this.changeStrokeOffset(e);const s=150;this.modifyTransition(s)}beforeDestroy(){this.modifyTransition(0)}}const ll=(t,e,s)=>{const i=t.type||"Shockwave";return h({class:"touch-icon circle "+i.toLowerCase(),onSet:[s,"selected",{inactive:!0}]})};class ol extends B{beforeSetup(){const e=this.game.getCurrentLevel();this.level=e,this.level.setUpdateTouchCallBack(()=>this.select()),this.data=new yt,this.reset()}render(){return k({class:"option-group level-touches"},[h({id:"levelTouches",cache:"levelTouces",class:"value touch-container title-text",for:["touches",ll]}),h({class:"label title-text"},"Touches")])}setupTouches(){const e=this.level.devices,s=[];for(let i in e){const r=e[i];for(let a=0;a<r;a++)this.limit++,s.push({type:i,selected:!1})}return s}select(){let e=!1;if(this.current>=0){const i=this.data.touches[this.current];i.selected===!1&&(e=i,i.selected=!0,this.current--)}return e}reset(){this.limit=0,this.data.set("touches",this.setupTouches()),this.current=this.limit-1}}function hl(){const t=this.game.getCurrentLevel();this.data=t.data}function cl(){const t=this.game.getCurrentLevel();this.panel.classList.add(t.levelClass)}function ul(){this.game.stopStage()}const dl=({game:t})=>new ut({game:t,beforeSetup:hl,afterSetup:cl,beforeDestroy:ul},[k({class:"play-container"},[h({class:"play-panel"},[h({class:"fade-layer"},[Tn({id:"portal",cache:"portal",class:"main-canvas",onCreated(e){t.setCanvas(e);const s=1;window.setTimeout(()=>{t.setupStage(),t.startStage()},s)}})])]),h({class:"play-level-container"},[h({class:"level-guide fadeIn"},[ct({class:"options-container"},[h({class:"top-container"},[k({class:"option-group"},[rt({class:"bttn circle bttn-pause",href:"/play/paused"},[h({class:"content"},[R(),R()])])]),k({class:"option-group level-number"},[h({id:"levelNumber",class:"value title-text"},"[[number]]"),h({class:"label title-text"},"Level")])]),h({class:"lower-container"},[k({class:"option-group level-progress"},[h({id:"levelProgress",class:"value progress title-text"},[h({id:"levelMinimum",class:"progress-number value title-text"},"[[remaining]]"),new nl({game:t})]),h({class:"label title-text"},"Progress")]),new ol({cache:"touches",game:t})])])]),h({id:"fps",class:"fps"})])])]),At=(t,e,s)=>({uri:t,component:e,title:s}),pl=t=>[At("/play/:state?",dl(t),"Play"),At("/level-summary",Ss(t),"Level Summary"),At("/:overlay?",al(t),"Home")],fl=Wt((t,e)=>An({class:"main-game-container",...t},e)),gl=Wt((t,e)=>({class:"main-container",...t,children:e})),ml=t=>fl([gl({cache:"mainBody",switch:pl(t)}),h({class:"overlay-container",route:[{uri:"/settings",component:il()},{uri:"/levels",component:Fn(t)},{uri:"/play/paused",component:Jn(t)},{uri:"/play/level-summary",component:Ss(t)}]}),new jn({cache:"soundFx",class:"sound",fileName:"play-loop.mp3"})]),xt={appName:"Multisplode",size:{width:774,height:493},router:{baseUrl:"/multisplode/",title:"Multisplode"}},Ps=({className:t,click:e,children:s})=>kn({class:`prompt-panel ${t}`,click:e},[h({class:"panel-top-button-container"},[h({class:"bttn circle close",click:(i,r)=>r.close()},[h({class:"content"},[R(),R()])])]),...s]);class dt extends B{constructor(){super(...arguments);g(this,"class","")}render(){const s=i=>{i.target===this.panel&&this.close()};return Ps({class:this.class,click:s,children:[h({class:"touch-slider"},[h({class:"step"},[k(this.children)])])]})}open(){D.render(this,document.body),this.panel.showModal(),typeof this.activateCallBack=="function"&&this.activateCallBack()}close(){this.panel.close(),this.destroy(),typeof this.deactivateCallBack=="function"&&this.deactivateCallBack()}}const vl=t=>new dt({class:"startup-panel",...t},[h({class:"content"},[$({src:"images/four-more.svg",type:"image/svg+xml"}),T({class:"title-enhance"},[tt("Four Is More")]),X("You can now use four explosions at anytime to maximize the destruction.")])]),yl=t=>new dt({class:"startup-panel",...t},[h({class:"content"},[$({src:"images/three-more.svg",type:"image/svg+xml"}),T({class:"title-enhance"},[tt("Three Is More Fun")]),X("You can now use three explosions at anytime to maximize the destruction.")])]),bl=t=>new dt({class:"startup-panel",...t},[h({class:"content"},[$({src:"images/double-trouble.svg",type:"image/svg+xml"}),T({class:"title-enhance"},[tt("Double The Trouble")]),X("You can now use two explosions at anytime to maximize the destruction.")])]),wl=t=>new dt({class:"startup-panel",...t},[h({class:"content"},[$({src:"images/gravity-field.svg",type:"image/svg+xml"}),h({class:"title-enhance"},"Gravity Doesn't Suck"),X("You can now use gravity to your advantage. Gravity fields attract particles and lock them into orbit until the gravity field becomes too weak and the particles are released.")])]),kl=t=>new dt({class:"startup-panel",...t},[h({class:"content"},[$({src:"images/complete-challenge.svg",type:"image/svg+xml"}),T({class:"title-enhance"},[tt("Pulse Particles")]),X("The pulse particle is pure white and packs a punch. It causes 1.5X destruction and double the points.")])]);class Sl extends dt{render(){const e=s=>{s.target===this.panel&&this.close()};return Ps({class:this.class,click:e,children:[new ie({cache:"touch",items:this.children})]})}}const Pl=t=>new Sl({class:"startup-panel",...t},[h({class:"content"},[$({src:"images/destroy-particles.svg",type:"image/svg+xml"}),T({class:"title-enhance"},[tt("Destroy The Particles")]),X("Touch the screen to create an explosion. Particles that hit explosions will also explode creating chains.")]),h({class:"content"},[$({src:"images/complete-challenge.svg",type:"image/svg+xml"}),T({class:"title-enhance"},[tt("Complete The Challenge")]),X("Beat the level minimum to continue. As the levels go on the explosions will get smaller increasing the difficulty.")]),h({class:"content"},[$({src:"images/unlock-explosions.svg",type:"image/svg+xml"}),T({class:"title-enhance"},[tt("Unlock Multiple Explosions")]),X("As the levels progress they will require more than just one explosion to complete the challenge.")])]),xl={StartupPrompt:Pl,AddTwoPrompt:bl,AddThreePrompt:yl,AddFourPrompt:vl,PulseParticlePrompt:kl,GravityFieldPrompt:wl},Cl=t=>{try{const e=xl[t.type];return e(t)}catch(e){console.log(e)}return null},_t={prompts:{},game:null,setGame(t){this.game=t},setup(){const t=()=>this.game.stopDraw(),e=()=>this.game.startDraw();this.add({type:"StartupPrompt",activateCallBack:t,deactivateCallBack:e}),this.add({type:"AddTwoPrompt",activateCallBack:t,deactivateCallBack:e}),this.add({type:"AddThreePrompt",activateCallBack:t,deactivateCallBack:e}),this.add({type:"AddFourPrompt",activateCallBack:t,deactivateCallBack:e}),this.add({type:"PulseParticlePrompt",activateCallBack:t,deactivateCallBack:e}),this.add({type:"GravityFieldPrompt",activateCallBack:t,deactivateCallBack:e})},getPrompt(t){return this.prompts[t]||null},showPrompt(t){const e=this.getPrompt(t);e&&e.open()},reset(){this.prompts=[]},getAll(){return this.prompts},add(t){const e=Cl(t);return e?(this.prompts[t.type]=e,e):!1},remove(t){const e=this.prompts.indexOf(t);e>-1&&this.prompts.splice(e,1)}};class xs{constructor(e,s,i,r,a,n,l,o,c){g(this,"isAtLimit",!1);g(this,"timerUi",null);g(this,"timerUiDelay",150);this.number=e,this.touch=0,this.touchLimit=0,this.devices={},this.setupDevices(s),this.minimum=i,this.afterTouch=r,this.afterTouchReady="no",this.particles=null,this.setupParticleCount(a),this.waveScale=n,this.waveMaxSize=l,this.remaining=this.minimum,this.passed=!1,this.currentNumber=0,this.scoreNumber=0,this.scorePoints=0,this.highScorePoints=0,this.highScoreNumber=0,this.updateTouchCallBack=null,this.promptId=o,this.levelClass=c,this.bestTime="",this.locked=!0,this.setData()}setData(){this.data=new yt,this.setDataValues(),this.data.setKey("level-"+this.number),this.data.resume(),this.data.passed=!1,this.data.remaining=this.minimum}setDataValues(){this.data.set({number:this.number,locked:this.locked,minimum:this.minimum,remaining:this.remaining,scoreNumber:this.scoreNumber,quantity:this.quantity,scorePoints:this.scorePoints,highScorePoints:this.highScorePoints,highScoreNumber:this.highScoreNumber,bestTime:this.bestTime,devices:this.devices})}setup(){this.updateFromData(),this.reset(),this.number===1&&this.unlock()}setupDevices(e){if(typeof e!="object"){this.devices={ShockWave:e},this.touchLimit=e;return}this.touchLimit=0;for(let s=0,i=e.length;s<i;s++){let r=e[s],a="ShockWave";switch(s){case 0:a="ShockWave";break;case 1:a="GravityField";break}this.touchLimit+=r,this.devices[a]=r}}setupParticleCount(e){if(typeof e!="object"){this.quantity=e;return}this.particles=e;let s=0;for(let i in e)A.hasOwnProp(e,i)&&(s+=e[i]);this.quantity=s}reset(){this.touch=0,this.scoreNumber=0,this.scorePoints=0,this.currentNumber=0,this.afterTouchReady="no",this.remaining=this.minimum,this.passed=!1,this.isAtLimit=!1,this.setDataValues(),this.blowEm=!1,this.startDelay=null,this.isAtLimit=!1,this.delay=this.originalDelay}updateTouch(){this.touch++;const e=this.updateTouchCallBack();return this.isAtTouchLimit(),e}setUpdateTouchCallBack(e){this.updateTouchCallBack=e}isAtTouchLimit(){this.touch===this.touchLimit&&(this.isAtLimit=!0)}updateHighScore(){this.scoreNumber>this.highScoreNumber&&(this.highScoreNumber=this.scoreNumber,this.data.highScoreNumber=this.scoreNumber),this.scorePoints>this.highScorePoints&&(this.highScorePoints=this.scorePoints,this.data.highScorePoints=this.scorePoints),this.saveToData()}updateScore(e,s){this.updatePoints(s),this.updateNumber(e),this.updateUiByTimer()}updateUiByTimer(){this.timerUi===null&&(this.timerUi=window.setTimeout(()=>{this.updateRemaining(),this.updatePlayUi(),this.updateHighScore(),this.timerUi=null},this.timerUiDelay))}updateRemaining(){let e=this.minimum-this.scoreNumber;e!==this.currentNumber&&(this.currentNumber=e,e=e>0?e:0,this.data.remaining=e,e===0&&(this.passed=!0,this.data.passed=!0))}updatePoints(e){this.scorePoints+=e}updateNumber(e){this.scoreNumber+=e}updatePlayUi(){this.data.set({scoreNumber:this.scoreNumber,scorePoints:this.scorePoints})}updateBestTime(e){this.bestTime=e,this.data.bestTime=e,this.data.store()}updateFromData(){const e=this.data;e&&(this.locked=e.locked,this.highScorePoints=e.highScorePoints,this.highScoreNumber=e.highScoreNumber,this.bestTime=e.bestTime)}saveToData(){const e={locked:this.locked,highScorePoints:this.highScorePoints,highScoreNumber:this.highScoreNumber};this.data.set(e),this.data.store()}unlock(){this.locked=!1,this.data.locked=!1,this.saveToData()}}class Al{constructor(e){g(this,"controller",null);g(this,"levels",[[1,28,40,40,1,65,"startup-panel","first"]]);this.label="",this.game=e}setupLevels(){let e="";const s=[],i=this.levels;for(let r=0,a=i.length;r<a;r++){let n=i[r],l=typeof n[7]<"u"?n[7]:e;l!==e&&(e=l),s.push(this.createLevel(r+1,n,l))}return s}createLevel(e,s,i){const r=new xs(e,s[0],s[1],s[2],s[3],s[4],s[5],s[6],i);return r.setup(),r}changeLevel(e){this.controller.changeLevel(e)}setLevel(e,s){this.changeLevel(e),this.controller.setLevel(s)}levelSummary(){this.controller.getSummary()}}const at={add(t,e,s){const i=this.createCacheCanvas(e,s),r=i.getContext("2d");return typeof t=="function"&&t(r),i},createCacheCanvas(t,e){const s=document.createElement("canvas");return s.width=t,s.height=e,s}},q=m.arc,Ll=(t,e)=>({x:m.round(t),y:m.round(e)});class Cs{constructor(e,s,i,r){this.position=Ll(e,s),this.size=0,this.fillColor=i,this.audio="sound/collisions/collision-1a.mp3",this.multiplier=r||1,this.type="device",this.explosive=!1,this.cachePath()}checkToRemove(){return!1}cachePath(){const e=this.maxSize,s=this.lineSize=e/10,i=this.totalSize=e*2+s*2;this.half=this.totalSize/2;const r=a=>{const n=i/2;a.beginPath(),a.arc(n,n,e,0,q,!0),a.globalAlpha=.3,a.fillStyle=this.fillColor,a.fill(),a.globalAlpha=.5,a.beginPath(),a.arc(n,n,e*.3,0,q,!0),a.fillStyle=this.fillColor,a.fill(),a.globalAlpha=.7,a.beginPath(),a.arc(n,n,e*.6,0,q,!0),a.fillStyle=this.fillColor,a.fill(),a.globalAlpha=1};this.cache=at.add(r,i,i)}draw(e){const s=this.position.x,i=this.position.y,r=this.size/this.maxSize;e.save(),e.translate(s,i),e.scale(r,r),e.drawImage(this.cache,-this.half,-this.half),e.restore()}}class Tl extends Cs{constructor(e,s,i,r){super(e,s,i,r),this.audio="sound/collisions/collision-1a.mp3",this.gravity=1*this.multiplier,this.startTime=null,this.time=8e3,this.delta=0,this.maxSize=0,this.totalSize=0,this.lineSize=0,this.type="gravityField",this.getMaxSize(),this.cachePath()}checkToRemove(){const e=this.getStartTime();return this.delta=new Date-e,this.delta>=this.time}getStartTime(){return this.startTime=this.startTime||new Date,this.startTime}updateParticlePosition(e){let s=this.position,i=e.position,a=m.distance(i,s)-this.gravity-this.gravity;a=a>this.orbitLimit?a:this.orbitLimit;const n=m.updateOrbitAngle(this.getOrbitAngle(e),e.speed/this.size);s=m.getOrbitPosition(s.x,s.y,n,a),i.x=s.x,i.y=s.y}getOrbitAngle(e){const s=this.position,i=e.position,r=i.x-s.x,a=i.y-s.y;return Math.atan2(a,r)}orbitParticle(e){this.updateParticlePosition(e)}getMaxSize(){const e=S.currentLevel;e&&(this.maxSize=e.waveMaxSize*this.multiplier,this.size=this.maxSize,this.orbitLimit=this.maxSize-this.maxSize/3)}cachePath(){const e=this.maxSize,s=this.lineSize=2,i=this.totalSize=e*2+s*2;this.half=this.totalSize/2;const r=a=>{const n=i/2;a.beginPath(),a.arc(n,n,e,0,q,!0),a.globalAlpha=.3,a.fillStyle=this.fillColor,a.fill(),a.lineWidth=2,a.strokeStyle="#FFF",a.stroke(),a.globalAlpha=.7,a.beginPath(),a.arc(n,n,e*.2,0,q,!0),a.fillStyle=this.fillColor,a.fill(),a.globalAlpha=1};this.cache=at.add(r,i,i)}draw(e){const s=1-this.delta/this.time;e.save(),e.translate(this.position.x,this.position.y),e.globalAlpha=s,e.drawImage(this.cache,-this.half,-this.half),e.restore()}}class El extends Cs{constructor(s,i,r,a){super(s,i,r,a);g(this,"waveScale",0);g(this,"maxSize",0);g(this,"totalSize",0);g(this,"lineSize",0);this.size=0,this.audio="sound/collisions/collision-1a.mp3",this.type="shockWave",this.explosive=!0,this.getWaveScale(),this.cachePath()}updateSize(){this.size+=this.waveScale}checkToRemove(){return this.size>=this.maxSize}getWaveScale(){let s=S.currentLevel;s&&(this.waveScale=s.waveScale,this.maxSize=s.waveMaxSize*this.multiplier)}cachePath(){let s=this.maxSize,i=this.lineSize=s/10,r=this.totalSize=s*2+i*2;this.half=this.totalSize/2;const a=n=>{let l=r/2;n.beginPath(),n.arc(l,l,s,0,q,!0),n.globalAlpha=.3,n.fillStyle=this.fillColor,n.fill(),n.globalAlpha=.5,n.beginPath(),n.arc(l,l,s*.3,0,q,!0),n.fillStyle=this.fillColor,n.fill(),n.globalAlpha=.7,n.beginPath(),n.arc(l,l,s*.6,0,q,!0),n.fillStyle=this.fillColor,n.fill(),n.globalAlpha=1};this.cache=at.add(a,r,r)}draw(s){this.updateSize();const i=this.size/this.maxSize;s.save(),s.translate(this.position.x,this.position.y),s.scale(i,i),s.drawImage(this.cache,-this.half,-this.half),s.restore()}}const Se={ShockWave:El,GravityField:Tl},nt={devices:[],removed:[],reset(){this.explosives=0,this.devices=[],this.removed=[]},explosives:0,getExplosivesCount(){return this.explosives},getAll(){return this.devices},add(t,e,s,i,r="ShockWave"){const a=Se[r]||Se.ShockWave,n=new a(t,e,s,i);return n.explosive===!0&&this.explosives++,this.devices.push(n),n},remove(t){const e=this.devices,s=e.indexOf(t);s>-1&&(e.splice(s,1),this.removed.push(t))},draw(t){t.globalCompositeOperation="lighter";const e=this.devices;for(let s=e.length-1;s>=0;s--){let i=e[s];i.checkToRemove()===!0?(i.explosive===!0&&this.explosives--,this.remove(i)):i.draw(t)}t.globalCompositeOperation=0}},Ol=t=>{let e=m.floor(Math.random()*7),s="";switch(e){case 0:s="#F9322D";break;case 1:s="#FF397F";break;case 2:s="#D541B7";break;case 3:s="#FF8931";break;case 4:s="#F9F95D";break;case 5:s="#21F8B6";break;case 6:s="#26CFCE";break;case 7:s="#3153CB";break}return s};let jl=0;const Y=m.randomFromTo,Bl=1e3/60;class As{constructor(e){this.type="particle",this.value=10,this.multiplier=1,this.setup(e)}init(){this.number=++jl,this.id=this.number}getDefaultSettings(){const e=xt.size,s=.005,i=.008,r=e.width*.12/Bl,a=Y(e.width*s,e.width*i),n=a*2;return{size:a,position:{x:Y(a+3,e.width-n-3),y:Y(a+3,e.height-n-3)},fillColor:Ol(),stroke:Y(3,5),direction:Y(-10,10),angle:Y(0,360),speed:Y(r/1.8,r)}}setup(e,s){s=s!==!1;let i=this.getDefaultSettings();e&&typeof e=="object"&&(i=Object.assign(i,e)),this.size=i.size,this.fullSize=this.size*2,this.position=i.position,this.fillColor=i.fillColor,this.stroke=i.stroke,this.direction=i.direction,this.speed=i.speed,this.angle=i.angle,s&&this.cachePath()}move(){this.updateByAngle()}updateByAngle(){this.updatePosition()}updateAngle(){const e=m.updateOrbitAngle(this.angle,this.speed);this.angle=e}checkWall(e){const s=this.position;(s.x+this.size>=e.width||s.x<=this.size)&&(this.angle=180-this.angle),(s.y+this.size>=e.height||s.y<=this.size)&&(this.angle=360-this.angle)}updatePosition(){const e=xt.size,s=m.getPositionByAngle(this.angle,this.speed),i=m.round,r=this.position;r.x=i(r.x+s.x),r.y=i(r.y+s.y),this.checkWall(e)}cachePath(){const e=Math.ceil(this.size*2),s=i=>{i.beginPath(),i.arc(e/2,e/2,this.size,0,vt,!0),i.fillStyle=this.fillColor,i.fill()};this.cache=at.add(s,e,e)}hasCollided(e){const s=this.position;let i=s.x-e.position.x,r=s.y-e.position.y,a=e.size+this.size;return i*i+r*r<=a*a}draw(e){e.drawImage(this.cache,this.position.x-this.size,this.position.y-this.size)}}class Dl extends As{constructor(e){super(e),this.type="pulse",this.value=20,this.multiplier=1.5,e||(e={}),e.size=8;const s="#FFF";e.fillColor=s,this.setup(e)}cachePath(){const e=this.size,s=e*2,i=r=>{const a=s/2;r.beginPath(),r.arc(a,a,e,0,vt,!0),r.fillStyle="rgba(255,255,255,.4)",r.fill(),r.beginPath(),r.arc(a,a,e/2,0,vt,!0),r.fillStyle=this.fillColor,r.fill()};this.cache=at.add(i,s,s)}}const Il={Particle:As,PulseParticle:Dl},W={particles:[],removed:[],reset(){this.particles=[],this.removed=[]},getAll(){return this.particles},add(t,e){t=t||"Particle";const s=Il[t],i=new s(e);return this.particles.push(i),i},remove(t){const e=this.particles.indexOf(t);e<0||(this.particles.splice(e,1),this.removed.push(t))}},Lt={},Rl=(t,e)=>({x:t,y:e});let $l=0;class Nl{constructor(e,s,i){this.number=++$l,this.id=this.number,this.position=Rl(e,s),this.size=20,this.fillColor="#FFFFFF",this.opacity=1,this.text="+"+i,this.value=i,this.distance=0,this.maxDistance=3,this.speed=.06,this.cachePath()}move(){this.distance+=this.speed,this.position.y-=this.distance}changeAlpha(){this.opacity-=.05}cachePath(){if(Lt[this.value]){this.cache=Lt[this.value];return}const e=40,s=60,i=r=>{r.font=this.size+"px titillium",r.fillStyle=this.fillColor,r.fillText(this.text,s/2,e/2)};this.cache=Lt[this.value]=at.add(i,s,e)}draw(e){const s=m.round(this.position.x),i=m.round(this.position.y),r=1-this.distance/this.maxDistance;e.save(),e.globalAlpha=r,e.drawImage(this.cache,s,i),e.restore()}}const Mt={gamePoints:[],removed:[],reset(){this.gamePoints=[],this.removed=[]},getAll(){return this.gamePoints},add(t,e,s){const i=new Nl(t,e,s);return this.gamePoints.push(i),i},remove(t){const e=this.gamePoints,s=e.indexOf(t);s>-1&&(e.splice(s,1),this.removed[this.removed.length]=t)},draw(t){t.beginPath();const e=this.gamePoints;for(let s=e.length-1;s>=0;s--){let i=e[s];m.round(i.distance)>=i.maxDistance?this.remove(i):(i.move(),i.draw(t))}t.closePath()}},_l=.001;class Ml{constructor(e,s,i,r,a,n){this.position={x:e,y:s},this.angle=i,this.size=m.randomFromTo(4,10),this.maxSize=this.size,this.fillColor=r,this.stroke=r,this.type="",this.speed=m.randomFromTo(1,5),this.cachePath()}updatePosition(){const e=m.getPositionByAngle(this.angle,this.speed),s=this.position;s.x+=e.x,s.y+=e.y,this.updateSize()}updateSize(){this.size-=.5}cachePath(){const e=this.totalSize=this.size*2;this.half=this.totalSize/2;const s=i=>{const r=e/2;i.globalAlpha=.7,i.beginPath(),i.arc(r,r,e,0,vt,!0),i.fillStyle=this.fillColor,i.fill(),i.globalAlpha=1};this.cache=at.add(s,e,e)}draw(e){if(this.updatePosition(),this.size<_l)return!1;const s=this.position,i=this.size/this.maxSize;e.save(),e.translate(s.x,s.y),e.scale(i,i),e.drawImage(this.cache,-this.half,-this.half),e.restore()}}const zl=()=>{let t=20;switch(C.graphics){case"low":t=12;break;case"high":t=30;break}return t};class Fl{constructor(e,s,i){g(this,"radiusRate",null);this.particleNumber=zl(),this.x=e,this.y=s,this.color=i,this.radius=0,this.maxRadius=30,this.speed=20,this.particles=[],this.removed=[],this.setupParticles()}setupParticles(){const e=this.particleNumber,s=360/e;for(let i=0;i<=e;i++){let r=s*i;this.addParticle(r)}this.radiusRate=this.maxRadius/this.speed}addParticle(e){const s=new Ml(this.x,this.y,e,this.color,this.maxRadius,this.speed);this.particles.push(s)}checkToRemove(){return this.radius>=this.maxRadius}updateRadius(){let e=this.radius;e+=this.radiusRate,e=m.round(e)}draw(e){this.updateRadius();const s=this.particles;for(let i=s.length-1;i>=0;i--){let r=s[i];if(r.draw(e)===!1){s.splice(i,1);let a=this.removed;a[a.length]=r}}}}const zt={sparks:[],removed:[],maxRadius:5,speed:10,reset(){this.sparks=[],this.removed=[]},add(t,e,s){const i=new Fl(t,e,s);this.sparks.push(i)},remove(t){const e=this.sparks,s=e.indexOf(t);if(s>-1){e.splice(s,1);let i=this.removed;i[i.length]=t}},updateRadius(t){t.checkToRemove()==!1?t.radius+=t.radiusRate:this.remove(t)},draw(t){const e=this.sparks;for(let s=e.length-1;s>=0;s--){let i=e[s];i&&(i.draw(t),this.updateRadius(i))}}},Wl={activeSounds:[],reset(){this.activeSounds=[]},getAll(){return this.activeSounds},add(t,e){if(C.audio===!0&&this.check(e)===!1){const s=new Audio(t),i={audio:s,type:e};return s.volume=.4,s.play(),this.activeSounds.push(i),i}return!1},check(t){return!1},remove(t){const e=this.activeSounds,s=e.indexOf(t);s>-1&&e.splice(s,1)}},Hl={addAnimation(t,e,s=0){if(!t)return;const i=t.classList;i.add(e),window.setTimeout(()=>i.remove(e),s)}};class Ul{constructor(){g(this,"level",null);g(this,"blowEmDelay",200);g(this,"blowEm",!1);g(this,"blowEmExtend",380);g(this,"playContainer",null);g(this,"originalDelay",1e3);g(this,"delay",1e3);g(this,"startDelay",null)}setLevel(e){this.reset(),this.setupParticles();const s=this.level;if(vs.set("lastLevel",s),e!==!0){const i=s.promptId;i&&this.showPrompt(i)}}showPrompt(e){new ks(50,()=>_t.showPrompt(e)).start()}changeLevel(e){this.level=e}interact(e,s){const i=this.level;if(i&&i.touch<i.touchLimit){const r=i.updateTouch();nt.add(e,s,"rgba(255,255,255,.9)",1,r.type)}}createDevice(e,s,i,r){nt.add(e,s,i,r),this.createSparks(e,s,i)}createSparks(e,s,i){zt.add(e,s,i)}createPoints(e,s,i){const r=this.level;r&&(C.graphics==="high"&&Mt.add(e,s,i),r.updateScore(1,i))}randomFromTo(e,s){return m.floor(Math.random()*(s-e+1)+e)}reset(){this.level.reset(),Wl.reset(),W.reset(),Mt.reset(),nt.reset(),zt.reset(),this.blowEm=!1,this.startDelay=null,this.isAtLimit=!1,this.delay=this.originalDelay}draw(e,s){}setupParticles(){this.reset();const e=this.level,s=e.particles;if(s&&typeof s=="object"){for(let i in s)if(A.hasOwnProp(s,i)){const r=s[i];for(let a=0;a<r;a++)W.add(i)}}else for(let i=0,r=e.quantity;i<r;i++)W.add()}checkToBlowEm(){const e=this.level;e.scoreNumber>=e.minimum&&(this.destroyAllParticles(),this.delay+=this.blowEmExtend,this.playContainer===null&&(this.playContainer=document.querySelector(".play-container")),Hl.addAnimation(this.playContainer,"shakePanel",600)),this.blowEm=!0}setupCompleteDelay(){return this.startDelay=this.startDelay||new Date,this.startDelay}checkLevelComplete(e){if(this.level.isAtLimit===!0&&nt.getExplosivesCount()<1||e<1){const s=this.setupCompleteDelay(),i=new Date-s;if(this.blowEm===!1&&i>=this.blowEmDelay)this.checkToBlowEm();else if(i>=this.delay)return W.reset(),!0}return!1}isComplete(e){return this.checkLevelComplete(e)}destroyAllParticles(){const e=W.getAll(),s=e.length;if(e)for(let i=s-1;i>=0;i--){const r=e[i];W.remove(r),this.createDevice(r.position.x,r.position.y,r.fillColor)}}}class Xl extends Ul{draw(e,s){nt.draw(e),zt.draw(e);const i=W.getAll();let r=i.length;if(r>0){let a=r-1;const n=nt.getAll(),l=n.length,o=l-1;do{const c=i[a];let u=!1,f=o;if(l>0)do{const L=n[f];if(c.hasCollided(L)===!0){let I;switch(u=!0,L.type){case"gravityField":L.orbitParticle(c);break;default:r--,W.remove(c),I=c.position,this.createDevice(I.x,I.y,c.fillColor,c.multiplier),this.createPoints(I.x-55,I.y-35,c.value)}break}}while(f--);u===!1&&c.move(),c.draw(e)}while(a--)}return C.graphics==="high"&&Mt.draw(e),this.isComplete(r)}}class ql extends Al{constructor(){super(...arguments);g(this,"controller",new Xl);g(this,"levels",[[1,28,40,40,1,65,"StartupPrompt","first"],[1,40,50,50,1,62,!1],[1,45,50,50,1,67,!1],[1,53,57,57,1,60,!1],[1,45,50,{Particle:49,PulseParticle:1},1,61,"PulseParticlePrompt"],[1,32,40,{Particle:39,PulseParticle:1},1,60,!1],[[1,1],29,35,{Particle:34,PulseParticle:1},1,62,"GravityFieldPrompt"],[[1,1],32,39,{Particle:38,PulseParticle:1},1,61,!1],[[1,1],28,35,{Particle:34,PulseParticle:1},1,60,!1],[[1,1],55,60,{Particle:59,PulseParticle:1},1,56,!1],[[2,1],72,80,{Particle:79,PulseParticle:1},1,56,"AddTwoPrompt","second"],[[2,1],63,70,{Particle:69,PulseParticle:1},1,56,!1],[[2,1],64,70,{Particle:69,PulseParticle:1},1,54,!1],[[1,2],67,72,{Particle:71,PulseParticle:1},1,53,!1],[[2,1],52,60,{Particle:59,PulseParticle:1},1,52,!1],[[2,1],60,65,{Particle:63,PulseParticle:2},1,52,!1],[[1,2],48,56,{Particle:54,PulseParticle:3},1,50,!1],[[2,1],46,52,{Particle:50,PulseParticle:2},1,50,!1],[[1,2],50,55,{Particle:52,PulseParticle:3},1,50,!1],[[2,1],30,48,{Particle:45,PulseParticle:3},1,48,!1],[[3,1],40,50,{Particle:48,PulseParticle:2},1,50,"AddThreePrompt","third"],[[2,2],40,55,{Particle:53,PulseParticle:2},1,49,!1],[[3,1],58,63,{Particle:61,PulseParticle:2},1,49,!1],[[1,3],62,68,{Particle:66,PulseParticle:2},1,49,!1],[[2,2],65,70,{Particle:68,PulseParticle:2},1,47,!1],[[3,1],25,38,{Particle:36,PulseParticle:2},1,47,!1],[[3,1],40,48,{Particle:46,PulseParticle:2},1,47,!1],[[2,2],32,45,{Particle:43,PulseParticle:2},1,45,!1],[[3,1],50,55,{Particle:53,PulseParticle:2},1,45,!1],[[4,1],52,60,{Particle:58,PulseParticle:2},1,45,"AddFourPrompt"],[[3,2],52,65,{Particle:63,PulseParticle:2},1,42,!1],[[3,2],60,68,{Particle:66,PulseParticle:2},1,42,!1],[[4,1],70,79,{Particle:77,PulseParticle:2},1,42,!1],[[4,1],56,64,{Particle:62,PulseParticle:2},1,44,!1],[[2,3],48,55,{Particle:53,PulseParticle:2},1,44,!1],[[4,1],46,54,{Particle:52,PulseParticle:2},1,44,!1],[[3,2],62,68,{Particle:66,PulseParticle:2},1,42,!1],[[3,2],46,50,{Particle:48,PulseParticle:2},1,42,!1],[[3,2],50,55,{Particle:53,PulseParticle:2},1,42,!1],[[4,1],44,48,{Particle:46,PulseParticle:2},1,40,!1]])}createLevel(s,i,r){const a=new xs(s,i[0],i[1],i[2],i[3],i[4],i[5],i[6],r);return a.setup(),a}}class Vl{constructor(){this.canvas=null,this.ctx=null}setup(){this.createBufferCanvas()}createBufferCanvas(){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.resize()}resize(e){const s=this.canvas;s.width=e.width,s.height=e.height}}const Yl=1e3,Ls=60;window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,Yl/Ls)};const Gl=window.requestAnimationFrame;window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){window.clearTimeout(t)};const Pe=(t,e)=>({width:t,height:e}),Kl=(t,e,s)=>({x:t,y:e,status:s});class Jl{constructor(e,s,i){g(this,"canvasBoundBox",null);g(this,"scaleRatio",1);this.game=i,this.targetSize=Pe(e,s),this.size=Pe(0,0),this.fps=Ls,this.canvas=null,this.context=null,this.levelController=null,this.mouse=Kl(0,0,"up"),this.animationId=!1,this.buffer=null}setup(){this.drawBind=this.draw.bind(this),this.setupEvents()}setCanvas(e){this.canvas=e,this.context=e.getContext("2d")}setupEvents(){this.setupMouse(),this.resize(),window.addEventListener("resize",this.resize.bind(this),!1);const e=this.mouseDown.bind(this),s=this.canvas;this.addEvent=()=>{s.addEventListener("mousedown",e,!1),s.addEventListener("touchstart",e,!1)},this.removeEvent=()=>{s.removeEventListener("mousedown",e,!1),s.removeEventListener("touchstart",e,!1)}}setupMouse(){const e=document,s=this.canvas,i=this.mousePosition.bind(this),r=this.mouseUp.bind(this);s.addEventListener("mousemove",i),e.addEventListener("mouseup",r),s.addEventListener("touchmove",i),e.addEventListener("touchend",r)}interact(e,s){this.levelController.interact(e,s)}getInteractPositions(e){const s=this.scaleRatio,i=this.canvasBoundBox,r=(l,o)=>({x:parseInt((l-i.left)*s),y:parseInt((o-i.top)*s)}),a=[],n=e.touches;if(n&&n.length){const l=n[n.length-1];a.push(r(l.pageX,l.pageY))}else{let l,o;l=e.x||e.clientX,o=e.y||e.clientY,a.push(r(l,o))}return a}getEventPosition(e){let s,i;const r=e.touches;if(r&&r.length){const u=r[0];s=u.pageX,i=u.pageY}else s=e.x||e.clientX,i=e.y||e.clientY;const a=this.scaleRatio,n=this.canvasBoundBox,l=parseInt((s-n.left)*a),o=parseInt((i-n.top)*a);let c=this.mouse;c.x=l,c.y=o}mousePosition(e){this.getEventPosition(e)}mouseDown(e){e.preventDefault(),e.stopPropagation();const s=this.getInteractPositions(e);for(let i=0,r=s.length;i<r;i++){let a=s[i];this.interact(a.x,a.y)}this.mouse.status="down"}mouseUp(){this.mouse.status="up"}getContainerSize(){const e={width:0,height:0},s=this.canvas.parentNode;if(s){const i=s.style,r=i.borderLeftWidth+i.borderRightWidth,a=i.paddingLeft+i.paddingRight,n=i.borderTopWidth+i.borderBottomWidth,l=i.paddingTop+i.paddingBottom;let o=0,c=0,u=0;i.boxSizing!=="border-box"?(c=s.clientWidth-(r+a),u=s.clientHeight-(n+l)):(c=s.clientWidth,u=s.clientHeight),e.width=c>o?c:o,e.height=u}return e}resize(){const e=this.getContainerSize();if(e.width>0){const s=this.canvas,i=this.targetSize;s.width=i.width,s.height=i.height,this.size={width:s.width,height:s.height},this.scale(e,s),this.canvasBoundBox=s.getBoundingClientRect()}}scale(e,s){const i=s.height,r=s.width,a=e.width,n=e.height,l=a/r,o=n/i,c=Math.min(l,o);s.style.width=r*c+"px",s.style.height=i*c+"px",this.scaleRatio=this.size.width/parseInt(s.style.width)}draw(){const e=this.context,s=this.size;e.clearRect(0,0,s.width,s.height),this.levelController.draw(e,this)===!0?(this.stopDraw(),this.game.levelSummary()):this.animationId=Gl(this.drawBind)}renderFromBuffer(e,s,i){const r=this.context;r.clearRect(0,0,e,s),r.drawImage(i.canvas,0,0)}startDraw(){typeof this.animationId<"u"&&(this.stopDraw(),this.draw())}stopDraw(){window.cancelAnimationFrame(this.animationId),this.animationId=null}setupBuffer(){this.buffer=new Vl,this.buffer.setup()}}let xe=!1;const Ql=()=>{if(xe)return;xe=!0;const t=document.body,e=["requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen"];for(const s of e)if(t[s]){t[s]().catch(i=>console.error(`Failed to enable fullscreen mode: ${i.message}`));break}},Zl=()=>{!screen||!screen.orientation||typeof screen.orientation.lock!="function"||screen.orientation.lock("landscape").then(()=>{console.log("Orientation locked successfully.")}).catch(t=>{console.error(`Failed to lock orientation: ${t.message}`)})};class to{constructor(e,s,i){this.stage=new Jl(e,s,this),this.app=i,S.setGame(this),_t.setGame(this),_t.setup()}getCurrentLevel(){return S.currentLevel}setCanvas(e){this.stage.setCanvas(e)}setup(){this.setupLevels()}setupStage(){this.stage.setup()}setupLevelPacks(){[new ql(this)].forEach(s=>{S.addLevelPack(s)})}setStageLevelController(e){this.stage.levelController=e}setupLevels(){this.setupLevelPacks(),S.setup()}startGame(){Ql(),Zl(),S.selectPrimaryLevel(),this.app.navigate("/play")}play(){this.app.navigate("/"),this.app.navigate("/play"),C.song="play-loop.mp3",this.startStage()}resume(){this.app.navigate("/play"),this.startStage()}pause(){this.stopStage()}retryLevel(){S.retryLevel(),this.play()}selectLevel(e){S.selectLevel(e),this.play()}nextLevel(){S.selectNextLevel(),this.play()}previousLevel(){S.selectPreviousLevel(),this.play()}resetCurrentLevel(){this.retryLevel()}levelSummary(){this.stopStage(),C.song="summary-slow-loop.mp3",this.app.navigate("/play/level-summary")}startDraw(){this.stage.startDraw()}stopDraw(){this.stage.stopDraw()}startStage(){const e=this.stage;e.addEvent(),e.startDraw()}stopStage(){const e=this.stage;e.removeEvent(),e.stopDraw()}}class eo{constructor(){g(this,"router",null);g(this,"appShell",null);this.setupRouter(),this.setupAppShell(),this.setupService()}setupService(){const e=window.location.protocol.replace(":","");if(!("serviceWorker"in navigator)||e==="http")return!1;navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(i=>{})}setupRouter(){const{baseUrl:e,title:s}=xt.router,i=this.router=V.router;i.setup(e,s),i.navigate("/")}navigate(e,s,i){this.router.navigate(e,s,i)}setupGame(){const e=xt.size,s=new to(e.width,e.height,this);return s.setup(),s}setupAppShell(){const e=ml({game:this.setupGame()});D.render(e,document.body)}}new eo;
